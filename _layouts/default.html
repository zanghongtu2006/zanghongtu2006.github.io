<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'zh-CN' }}">
  <head>
    <meta charset="utf-8" />
    <title>
      {% if page.title %}{{ page.title }} · {% endif %}{{ site.title }}
    </title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    {%- seo -%}
    <link
      rel="stylesheet"
      href="{{ '/assets/css/style.css' | relative_url }}"
    />
  </head>
  <body>
    <div class="site-wrapper">
      <header class="site-header">
        <div class="site-title">
          <a href="{{ '/' | relative_url }}">{{ site.title }}</a>
        </div>
        <nav class="top-nav">
          {% for item in site.nav %}
          <a href="{{ item.url | relative_url }}">{{ item.title }}</a>
          {% endfor %}
        </nav>
      </header>

      <main class="layout-3col">
        <!-- 左侧侧栏 -->
        <aside class="sidebar sidebar-left">
          <h3>Navigate</h3>
          <ul class="sidebar-list">
            {% for item in site.nav %}
            <li>
              <a href="{{ item.url | relative_url }}">{{ item.title }}</a>
            </li>
            {% endfor %}
          </ul>

          <h3>Categories</h3>
          <ul class="sidebar-list">
            {% assign cats = site.categories | sort %}
            {% assign cat_slugs = site.data.category_slugs %}

            {% for cat in cats %}
              {% assign cat_name  = cat[0] %}
              {% assign cat_count = cat[1].size %}

              {%- comment -%}
              优先从 _data/category_slugs.yml 里拿 slug（Python 生成的拼音）
              找不到时退回 Jekyll 自己的 slugify
              {%- endcomment -%}
              {% assign slug = cat_slugs[cat_name] %}
              {% if slug == nil %}
                {% assign slug = cat_name | slugify %}
              {% endif %}

              {% assign cat_url = '/categories-' | append: slug %}

              <li>
                <a href="{{ cat_url | relative_url }}">
                  {{ cat_name }} ({{ cat_count }})
                </a>
              </li>
            {% endfor %}
          </ul>
        </aside>

        <!-- 中间主内容 -->
        <section class="content">
          {{ content }}
        </section>

        <!-- 右侧侧栏 -->
        <aside class="sidebar sidebar-right">
          <h3>Archive</h3>
          <ul class="sidebar-list">
            {% assign grouped = site.posts | group_by_exp: 'post', 'post.date |
            date: "%Y-%m"' %} {% for group in grouped %} {% assign y = group.name
            | slice: 0, 4 %} {% assign m = group.name | slice: 5, 2 %}
            <li>
              {{ y }}-{{ m }} ({{ group.items | size }})
            </li>
            {% endfor %}
          </ul>

          <h3>Tags</h3>
          <div class="tag-cloud">
            {% assign tags = site.tags | sort %} {% for tag in tags %}
            <a
              class="tag"
              href="{{ '/tags/#' | append: tag[0] | slugify | relative_url }}"
            >
              {{ tag[0] }}
            </a>
            {% endfor %}
          </div>
        </aside>
      </main>

      <footer class="site-footer">
        <small>
          © {{ site.time | date: "%Y" }} {{ site.title }} · Powered by Jekyll
          &amp; GitHub Pages
        </small>
      </footer>
    </div>
  </body>
</html>
