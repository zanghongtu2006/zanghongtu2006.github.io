

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>创建模板: 概述 &mdash; Apache CloudStack 4.12.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
        <script type="text/javascript" src="../static/jquery.js"></script>
        <script type="text/javascript" src="../static/underscore.js"></script>
        <script type="text/javascript" src="../static/doctools.js"></script>
        <script type="text/javascript" src="../static/language_data.js"></script>
        <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="添加主机" href="hosts.html" />
    <link rel="prev" title="虚拟机" href="virtual_machines.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="../../latest/adminguide/templates.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "adminguide/templates"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache CloudStack
          

          
          </a>

          
            
            
            
              <div class="version">
                4.12.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conceptsandterminology/index.html">CloudStack 概念和术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickinstallationguide/qig.html">快速入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installguide/index.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">升级 CloudStack</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">使用手册</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#user-interface">用户界面</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#managing-accounts-users-and-domains">账户、用户和域</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-projects-to-organize-user-resources">用项目来管理用户资源</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#service-offerings">计算方案</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#setting-up-networking-for-users">设置用户网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-virtual-machines">虚拟机</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#working-with-templates">模板</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="templates.html#">创建模板: 概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#requirements-for-templates">模板创建要求</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#best-practices-for-templates">模板最佳实践</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#the-default-template">默认模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#private-and-public-templates">私有模板和公共模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#creating-a-template-from-an-existing-virtual-machine">从虚拟机创建模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#creating-a-template-from-a-snapshot">从快照创建模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#uploading-templates">Uploading 模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#vsphere-templates-and-isos">vSphere 模板 and ISOs</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#exporting-templates">导出模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#creating-a-linux-template">创建 Linux 系统模版</a><ul>
<li class="toctree-l4"><a class="reference internal" href="templates.html#system-preparation-for-linux">System preparation for Linux</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#creating-a-windows-template">创建 Windows 系统模版</a><ul>
<li class="toctree-l4"><a class="reference internal" href="templates.html#system-preparation-for-windows-server-2008-r2">System Preparation for Windows Server 2008 R2</a></li>
<li class="toctree-l4"><a class="reference internal" href="templates.html#system-preparation-for-windows-server-2003-r2">System Preparation for Windows Server 2003 R2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#importing-amazon-machine-images">Importing Amazon Machine Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#converting-a-hyper-v-vm-to-a-template">将 Hyper-V 虚拟机转成模版</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#adding-password-management-to-your-templates">给模板添加密码管理功能</a><ul>
<li class="toctree-l4"><a class="reference internal" href="templates.html#linux-os-installation">Linux OS 安装</a></li>
<li class="toctree-l4"><a class="reference internal" href="templates.html#windows-os-installation">Windows OS 安装</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="templates.html#deleting-templates">删除模版</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-hosts">主机</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-storage">存储</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-system-virtual-machines">系统虚拟机</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-usage">Working with Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#managing-networks-and-traffic">Managing Networks and Traffic</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#managing-the-cloud">管理云</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#system-reliability-and-availability">系统的可靠性和可用性</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tuning">调优</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#events-and-troubleshooting">Events and Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developersguide/index.html">开发者手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">插件使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">发行版本说明</a></li>
</ul>
<p class="caption"><span class="caption-text">其它:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/api.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Home">Apache CloudStack Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/">Apache CloudStack 官网</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache CloudStack 源码</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/cloudstack">Apache CloudStack on GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre 4.11 Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-administration.html">管理员手册</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-release-notes.html">发行版本说明</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CloudStack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">使用手册</a> &raquo;</li>
        
      <li>创建模板: 概述</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/cloudstack-documentation/blob/4.12.0.0/source/adminguide/templates.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>A template is a reusable configuration for virtual machines. When users
launch VMs, they can choose from a list of templates in CloudStack.</p>
<p>Specifically, a template is a virtual disk image that includes one of a
variety of operating systems, optional additional software such as
office applications, and settings such as access control to determine
who can use the template. Each template is associated with a particular
type of hypervisor, which is specified when the template is added to
CloudStack.</p>
<p>CloudStack ships with a default template. In order to present more
choices to users, CloudStack administrators and users can create
templates and add them to CloudStack.</p>
<div class="section" id="creating-templates-overview">
<h1>创建模板: 概述<a class="headerlink" href="templates.html#creating-templates-overview" title="Permalink to this headline">¶</a></h1>
<p>CloudStack ships with a default template for the CentOS operating
system. There are a variety of ways to add more templates.
Administrators and end users can add templates. The typical sequence of
events is:</p>
<ol class="arabic simple">
<li>Launch a VM instance that has the operating system you want. Make any
other desired configuration changes to the VM.</li>
<li>Stop the VM.</li>
<li>Convert the volume into a template.</li>
</ol>
<p>There are other ways to add templates to CloudStack. For example, you
can take a snapshot of the VM’s volume and create a template from the
snapshot, or import a VHD from another system into CloudStack.</p>
<p>The various techniques for creating templates are described in the next
few sections.</p>
</div>
<div class="section" id="requirements-for-templates">
<h1>模板创建要求<a class="headerlink" href="templates.html#requirements-for-templates" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>For XenServer, install PV drivers / Xen tools on each template that
you create. This will enable live migration and clean guest shutdown.</li>
<li>For vSphere, install VMware Tools on each template that you create.
This will enable console view to work properly.</li>
</ul>
</div>
<div class="section" id="best-practices-for-templates">
<h1>模板最佳实践<a class="headerlink" href="templates.html#best-practices-for-templates" title="Permalink to this headline">¶</a></h1>
<p>If you plan to use large templates (100 GB or larger), be sure you have
a 10-gigabit network to support the large templates. A slower network
can lead to timeouts and other errors when large templates are used.</p>
</div>
<div class="section" id="the-default-template">
<h1>默认模板<a class="headerlink" href="templates.html#the-default-template" title="Permalink to this headline">¶</a></h1>
<p>CloudStack includes a CentOS template. This template is downloaded by
the 二级存储虚拟机 after the primary and secondary storage are
configured. You can use this template in your production deployment or
you can delete it and use custom templates.</p>
<p>The root password for the default template is “password”.</p>
<p>A default template is provided for each of XenServer, KVM, and vSphere.
The templates that are downloaded depend on the hypervisor type that is
available in your cloud. Each template is approximately 2.5 GB physical
size.</p>
<p>The default template includes the standard iptables rules, which will
block most access to the template excluding ssh.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># iptables --list</span>
<span class="n">Chain</span> <span class="n">INPUT</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>
<span class="n">RH</span><span class="o">-</span><span class="n">Firewall</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">INPUT</span>  <span class="nb">all</span>  <span class="o">--</span>  <span class="n">anywhere</span>             <span class="n">anywhere</span>

<span class="n">Chain</span> <span class="n">FORWARD</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>
<span class="n">RH</span><span class="o">-</span><span class="n">Firewall</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">INPUT</span>  <span class="nb">all</span>  <span class="o">--</span>  <span class="n">anywhere</span>             <span class="n">anywhere</span>

<span class="n">Chain</span> <span class="n">OUTPUT</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>

<span class="n">Chain</span> <span class="n">RH</span><span class="o">-</span><span class="n">Firewall</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">INPUT</span> <span class="p">(</span><span class="mi">2</span> <span class="n">references</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>
<span class="n">ACCEPT</span>     <span class="nb">all</span>  <span class="o">--</span>  <span class="n">anywhere</span>             <span class="n">anywhere</span>
<span class="n">ACCEPT</span>     <span class="n">icmp</span> <span class="o">--</span>  <span class="n">anywhere</span>        <span class="n">anywhere</span>       <span class="n">icmp</span> <span class="nb">any</span>
<span class="n">ACCEPT</span>     <span class="n">esp</span>  <span class="o">--</span>  <span class="n">anywhere</span>        <span class="n">anywhere</span>
<span class="n">ACCEPT</span>     <span class="n">ah</span>   <span class="o">--</span>  <span class="n">anywhere</span>        <span class="n">anywhere</span>
<span class="n">ACCEPT</span>     <span class="n">udp</span>  <span class="o">--</span>  <span class="n">anywhere</span>        <span class="mf">224.0</span><span class="o">.</span><span class="mf">0.251</span>    <span class="n">udp</span> <span class="n">dpt</span><span class="p">:</span><span class="n">mdns</span>
<span class="n">ACCEPT</span>     <span class="n">udp</span>  <span class="o">--</span>  <span class="n">anywhere</span>        <span class="n">anywhere</span>       <span class="n">udp</span> <span class="n">dpt</span><span class="p">:</span><span class="n">ipp</span>
<span class="n">ACCEPT</span>     <span class="n">tcp</span>  <span class="o">--</span>  <span class="n">anywhere</span>        <span class="n">anywhere</span>       <span class="n">tcp</span> <span class="n">dpt</span><span class="p">:</span><span class="n">ipp</span>
<span class="n">ACCEPT</span>     <span class="nb">all</span>  <span class="o">--</span>  <span class="n">anywhere</span>        <span class="n">anywhere</span>       <span class="n">state</span> <span class="n">RELATED</span><span class="p">,</span><span class="n">ESTABLISHED</span>
<span class="n">ACCEPT</span>     <span class="n">tcp</span>  <span class="o">--</span>  <span class="n">anywhere</span>        <span class="n">anywhere</span>       <span class="n">state</span> <span class="n">NEW</span> <span class="n">tcp</span> <span class="n">dpt</span><span class="p">:</span><span class="n">ssh</span>
<span class="n">REJECT</span>     <span class="nb">all</span>  <span class="o">--</span>  <span class="n">anywhere</span>        <span class="n">anywhere</span>       <span class="n">reject</span><span class="o">-</span><span class="k">with</span> <span class="n">icmp</span><span class="o">-</span><span class="n">host</span><span class="o">-</span>
</pre></div>
</div>
</div>
<div class="section" id="private-and-public-templates">
<h1>私有模板和公共模板<a class="headerlink" href="templates.html#private-and-public-templates" title="Permalink to this headline">¶</a></h1>
<p>When a user creates a template, it can be designated private or public.</p>
<p>Private templates are only available to the user who created them. By
default, an uploaded template is private.</p>
<p>When a user marks a template as “public,” the template becomes available
to all users in all accounts in the user’s domain, as well as users in
any other domains that have access to the Zone where the template is
stored. This depends on whether the Zone, in turn, was defined as
private or public. A private Zone is assigned to a single domain, and a
public Zone is accessible to any domain. If a public template is created
in a private Zone, it is available only to users in the domain assigned
to that Zone. If a public template is created in a public Zone, it is
available to all users in all domains.</p>
</div>
<div class="section" id="creating-a-template-from-an-existing-virtual-machine">
<h1>从虚拟机创建模板<a class="headerlink" href="templates.html#creating-a-template-from-an-existing-virtual-machine" title="Permalink to this headline">¶</a></h1>
<p>Once you have at least one VM set up in the way you want, you can use it
as the prototype for other VMs.</p>
<ol class="arabic">
<li><p class="first">Create and start a virtual machine using any of the techniques given
in <a class="reference external" href="virtual_machines.html#creating-vms">“Creating VMs”</a>.</p>
</li>
<li><p class="first">Make any desired configuration changes on the running VM, then click
Stop.</p>
</li>
<li><p class="first">Wait for the VM to stop. When the status shows Stopped, go to the
next step.</p>
</li>
<li><p class="first">Go into “View Volumes” and select the Volume having the type “ROOT”.</p>
</li>
<li><p class="first">Click Create Template and provide the following:</p>
<ul>
<li><p class="first"><strong>Name and Display Text</strong>. These will be shown in the UI, so
choose something descriptive.</p>
</li>
<li><p class="first"><strong>OS Type</strong>. This helps CloudStack and the hypervisor perform
certain operations and make assumptions that improve the
performance of the guest. Select one of the following.</p>
<ul>
<li><p class="first">If the operating system of the stopped VM is listed, choose it.</p>
</li>
<li><p class="first">If the OS type of the stopped VM is not listed, choose Other.</p>
</li>
<li><p class="first">If you want to boot from this template in PV mode, choose Other
PV (32-bit) or Other PV (64-bit). This choice is available only
for XenServere:</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">Generally you should not choose an older version of the OS
than the version in the image. For example, choosing CentOS
5.4 to support a CentOS 6.2 image will in general not work.
In those cases you should choose Other.</p>
</div>
</li>
</ul>
</li>
<li><p class="first"><strong>Public</strong>. Choose Yes to make this template accessible to all
users of this CloudStack installation. The template will appear in
the Community 模板 list. See <a class="reference external" href="templates.html#private-and-public-templates">“Private and
Public 模板”</a>.</p>
</li>
<li><p class="first"><strong>Password Enabled</strong>. Choose Yes if your template has the
CloudStack password change script installed. See
<a class="reference internal" href="templates/_password.html#adding-password-management-to-templates"><span class="std std-ref">给模板添加密码管理功能</span></a>.</p>
</li>
</ul>
</li>
<li><p class="first">Click Add.</p>
</li>
</ol>
<p>The new template will be visible in the 模板 section when the
template creation process has been completed. The template is then
available when creating a new VM.</p>
</div>
<div class="section" id="creating-a-template-from-a-snapshot">
<h1>从快照创建模板<a class="headerlink" href="templates.html#creating-a-template-from-a-snapshot" title="Permalink to this headline">¶</a></h1>
<p>If you do not want to stop the VM in order to use the Create Template
menu item (as described in <a class="reference external" href="templates.html#creating-a-template-from-an-existing-virtual-machine">“Creating a Template from an Existing
Virtual Machine”</a>),
you can create a template directly from any snapshot through the
CloudStack UI.</p>
</div>
<div class="section" id="uploading-templates">
<h1>Uploading 模板<a class="headerlink" href="templates.html#uploading-templates" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="vsphere-templates-and-isos">
<h1>vSphere 模板 and ISOs<a class="headerlink" href="templates.html#vsphere-templates-and-isos" title="Permalink to this headline">¶</a></h1>
<p>If you are uploading a template that was created using vSphere Client,
be sure the OVA file does not contain an ISO. If it does, the deployment
of VMs from the template will fail.</p>
<p>模板 are uploaded based on a URL. HTTP is the supported access
protocol. 模板 are frequently large files. You can optionally gzip
them to decrease upload times.</p>
<p>To upload a template:</p>
<ol class="arabic">
<li><p class="first">In the left navigation bar, click 模板.</p>
</li>
<li><p class="first">Click Register Template.</p>
</li>
<li><p class="first">Provide the following:</p>
<ul>
<li><p class="first"><strong>Name and Description</strong>. These will be shown in the UI, so choose
something descriptive.</p>
</li>
<li><p class="first"><strong>URL</strong>. The 管理服务 will download the file from the
specified URL, such as <code class="docutils literal notranslate"><span class="pre">http://my.web.server/filename.vhd.gz</span></code>.</p>
</li>
<li><p class="first"><strong>Zone</strong>. Choose the zone where you want the template to be
available, or All Zones to make it available throughout
CloudStack.</p>
</li>
<li><p class="first"><strong>OS Type</strong>: This helps CloudStack and the hypervisor perform
certain operations and make assumptions that improve the
performance of the guest. Select one of the following:</p>
<ul>
<li><p class="first">If the operating system of the stopped VM is listed, choose it.</p>
</li>
<li><p class="first">If the OS type of the stopped VM is not listed, choose Other.</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">You should not choose an older version of the OS than the
version in the image. For example, choosing CentOS 5.4 to
support a CentOS 6.2 image will in general not work. In
those cases you should choose Other.</p>
</div>
</li>
</ul>
</li>
<li><p class="first"><strong>Hypervisor</strong>: The supported hypervisors are listed. Select the
desired one.</p>
</li>
<li><p class="first"><strong>Format</strong>. The format of the template upload file, such as VHD or
OVA.</p>
</li>
<li><p class="first"><strong>Password Enabled</strong>. Choose Yes if your template has the
CloudStack password change script installed.
See <a class="reference internal" href="templates/_password.html#adding-password-management-to-templates"><span class="std std-ref">给模板添加密码管理功能</span></a>.</p>
</li>
<li><p class="first"><strong>Extractable</strong>. Choose Yes if the template is available for
extraction. If this option is selected, end users can download a
full image of a template.</p>
</li>
<li><p class="first"><strong>Public</strong>. Choose Yes to make this template accessible to all
users of this CloudStack installation. The template will appear in
the Community 模板 list. See <a class="reference external" href="templates.html#private-and-public-templates">“Private and
Public 模板”</a>.</p>
</li>
<li><p class="first"><strong>Featured</strong>. Choose Yes if you would like this template to be
more prominent for users to select. The template will appear in
the Featured 模板 list. Only an administrator can make a
template Featured.</p>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="exporting-templates">
<h1>导出模板<a class="headerlink" href="templates.html#exporting-templates" title="Permalink to this headline">¶</a></h1>
<p>End users and Administrators may export templates from the CloudStack.
Navigate to the template in the UI and choose the Download function from
the Actions menu.</p>
</div>
<div class="section" id="creating-a-linux-template">
<h1>创建 Linux 系统模版<a class="headerlink" href="templates.html#creating-a-linux-template" title="Permalink to this headline">¶</a></h1>
<p>Linux templates should be prepared using this documentation in order to
prepare your linux VMs for template deployment. For ease of
documentation, the VM which you are configuring the template on will be
referred to as “Template Master”. This guide currently covers legacy
setups which do not take advantage of UserData and cloud-init and
assumes openssh-server is installed during installation.</p>
<p>An overview of the procedure is as follow:</p>
<ol class="arabic">
<li><p class="first">Upload your Linux ISO.</p>
<p>For more information, see <a class="reference external" href="virtual_machines.html#adding-an-iso">“Adding an
ISO”</a>.</p>
</li>
<li><p class="first">Create a VM Instance with this ISO.</p>
<p>For more information, see <a class="reference external" href="virtual_machines.html#creating-vms">“Creating
VMs”</a>.</p>
</li>
<li><p class="first">Prepare the Linux VM</p>
</li>
<li><p class="first">Create a template from the VM.</p>
<p>For more information, see <a class="reference external" href="templates.html#creating-a-template-from-an-existing-virtual-machine">“Creating a Template from an Existing
Virtual Machine”</a>.</p>
</li>
</ol>
<div class="section" id="system-preparation-for-linux">
<h2>System preparation for Linux<a class="headerlink" href="templates.html#system-preparation-for-linux" title="Permalink to this headline">¶</a></h2>
<p>The following steps will prepare a basic Linux installation for
templating.</p>
<ol class="arabic">
<li><p class="first"><strong>安装</strong></p>
<p>It is good practice to name your VM something generic during
installation, this will ensure components such as LVM do not appear
unique to a machine. It is recommended that the name of “localhost”
is used for installation.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For CentOS, it is necessary to take unique identification out of the
interface configuration file, for this edit
/etc/sysconfig/network-scripts/ifcfg-eth0 and change the content to
the following.</p>
</div>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DEVICE</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">Ethernet</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">dhcp</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
</pre></div>
</div>
<p>The next steps updates the packages on the Template Master.</p>
<ul>
<li><p class="first">Ubuntu</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">i</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">upgrade</span> <span class="o">-</span><span class="n">y</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">acpid</span> <span class="n">ntp</span>
<span class="n">reboot</span>
</pre></div>
</div>
</li>
<li><p class="first">CentOS</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifup</span> <span class="n">eth0</span>
<span class="n">yum</span> <span class="n">update</span> <span class="o">-</span><span class="n">y</span>
<span class="n">reboot</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first"><strong>Password management</strong></p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">If preferred, custom users (such as ones created during the Ubuntu
installation) should be removed. First ensure the root user account
is enabled by giving it a password and then login as root to continue.</p>
</div>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">passwd</span> <span class="n">root</span>
<span class="n">logout</span>
</pre></div>
</div>
<p>As root, remove any custom user accounts created during the
installation process.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deluser</span> <span class="n">myuser</span> <span class="o">--</span><span class="n">remove</span><span class="o">-</span><span class="n">home</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="templates/_password.html#adding-password-management-to-templates"><span class="std std-ref">给模板添加密码管理功能</span></a> for
instructions to setup the password management script, this will allow
CloudStack to change your root password from the web interface.</p>
</li>
<li><p class="first"><strong>Hostname Management</strong></p>
<p>CentOS configures the hostname by default on boot. Unfortunately
Ubuntu does not have this functionality, for Ubuntu installations use
the following steps.</p>
<ul>
<li><p class="first">Ubuntu</p>
<p>The hostname of a Templated VM is set by a custom script in
<cite>/etc/dhcp/dhclient-exit-hooks.d</cite>, this script first checks if the
current hostname is localhost, if true, it will get the host-name,
domain-name and fixed-ip from the DHCP lease file and use those
values to set the hostname and append the <cite>/etc/hosts</cite> file for
local hostname resolution. Once this script, or a user has changed
the hostname from localhost, it will no longer adjust system files
regardless of its new hostname. The script also recreates
openssh-server keys, which should have been deleted before
templating (shown below). Save the following script to
<cite>/etc/dhcp/dhclient-exit-hooks.d/sethostname</cite>, and adjust the
permissions.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/sh
# dhclient change hostname script for Ubuntu
oldhostname=$(hostname -s)
if [ $oldhostname = &#39;localhost&#39; ]
then
    sleep 10 # Wait for configuration to be written to disk
    hostname=$(cat /var/lib/dhcp/dhclient.eth0.leases  |  awk &#39; /host-name/ { host = $3 }  END { printf host } &#39; | sed     &#39;s/[&quot;;]//g&#39; )
    fqdn=&quot;$hostname.$(cat /var/lib/dhcp/dhclient.eth0.leases  |  awk &#39; /domain-name/ { domain = $3 }  END { printf     domain } &#39; | sed &#39;s/[&quot;;]//g&#39;)&quot;
    ip=$(cat /var/lib/dhcp/dhclient.eth0.leases  |  awk &#39; /fixed-address/ { lease = $2 }  END { printf lease } &#39; | sed     &#39;s/[&quot;;]//g&#39;)
    echo &quot;cloudstack-hostname: Hostname _localhost_ detected. Changing hostname and adding hosts.&quot;
    printf &quot; Hostname: $hostname\n FQDN: $fqdn\n IP: $ip&quot;
    # Update /etc/hosts
    awk -v i=&quot;$ip&quot; -v f=&quot;$fqdn&quot; -v h=&quot;$hostname&quot; &quot;/^127/{x=1} !/^127/ &amp;&amp; x { x=0; print i,f,h; } { print $0; }&quot; /etc/hosts &gt; /etc/hosts.dhcp.tmp
    mv /etc/hosts /etc/hosts.dhcp.bak
    mv /etc/hosts.dhcp.tmp /etc/hosts
    # Rename Host
    echo $hostname &gt; /etc/hostname
    hostname -b -F /etc/hostname
    echo $hostname &gt; /proc/sys/kernel/hostname
    # Recreate SSH2
    export DEBIAN_FRONTEND=noninteractive
    dpkg-reconfigure openssh-server
fi
### End of Script ###

chmod 774  /etc/dhcp/dhclient-exit-hooks.d/sethostname
</pre></div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The following steps should be run when you are ready to template
your Template Master. If the Template Master is rebooted during
these steps you will have to run all the steps again. At the end
of this process the Template Master should be shutdown and the
template created in order to create and deploy the final template.</p>
</div>
</li>
<li><p class="first"><strong>Remove the udev persistent device rules</strong></p>
<p>This step removes information unique to your Template Master such as
network MAC addresses, lease files and CD block devices, the files
are automatically generated on next boot.</p>
<ul>
<li><p class="first">Ubuntu</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">udev</span><span class="o">/</span><span class="n">rules</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="mi">70</span><span class="o">*</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dhcp</span><span class="o">/</span><span class="n">dhclient</span><span class="o">.*</span>
</pre></div>
</div>
</li>
<li><p class="first">CentOS</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">udev</span><span class="o">/</span><span class="n">rules</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="mi">70</span><span class="o">*</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dhclient</span><span class="o">/*</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first"><strong>Remove SSH Keys</strong></p>
<p>This step is to ensure all your Templated VMs do not have the same
SSH keys, which would decrease the security of the machines
dramatically.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/*</span><span class="n">key</span><span class="o">*</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Cleaning log files</strong></p>
<p>It is good practice to remove old logs from the Template Master.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">audit</span><span class="o">/</span><span class="n">audit</span><span class="o">.</span><span class="n">log</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">wtmp</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">logrotate</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">logrotate</span><span class="o">.</span><span class="n">conf</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/*-*</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/*.</span><span class="n">gz</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Setting hostname</strong></p>
<p>In order for the Ubuntu DHCP script to function and the CentOS
dhclient to set the VM hostname they both require the Template
Master’s hostname to be “localhost”, run the following commands to
change the hostname.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hostname</span> <span class="n">localhost</span>
<span class="n">echo</span> <span class="s2">&quot;localhost&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hostname</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Set user password to expire</strong></p>
<p>This step forces the user to change the password of the VM after the
template has been deployed.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">passwd</span> <span class="o">--</span><span class="n">expire</span> <span class="n">root</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Clearing User History</strong></p>
<p>The next step clears the bash commands you have just run.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">-</span><span class="n">c</span>
<span class="n">unset</span> <span class="n">HISTFILE</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Shutdown the VM</strong></p>
<p>Your now ready to shutdown your Template Master and create a
template!</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">halt</span> <span class="o">-</span><span class="n">p</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Create the template!</strong></p>
<p>You are now ready to create the template, for more information see
<a class="reference external" href="templates.html#creating-a-template-from-an-existing-virtual-machine">“Creating a Template from an Existing Virtual
Machine”</a>.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">Templated VMs for both Ubuntu and CentOS may require a reboot after
provisioning in order to pickup the hostname.</p>
</div>
</div>
</div>
<div class="section" id="creating-a-windows-template">
<h1>创建 Windows 系统模版<a class="headerlink" href="templates.html#creating-a-windows-template" title="Permalink to this headline">¶</a></h1>
<p>Windows templates must be prepared with Sysprep before they can be
provisioned on multiple machines. Sysprep allows you to create a generic
Windows template and avoid any possible SID conflicts.</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">(XenServer) Windows VMs running on XenServer require PV drivers, which
may be provided in the template or added after the VM is created. The
PV drivers are necessary for essential management functions such as
mounting additional volumes and ISO images, live migration, and
graceful shutdown.</p>
</div>
<p>An overview of the procedure is as follows:</p>
<ol class="arabic">
<li><p class="first">Upload your Windows ISO.</p>
<p>For more information, see <a class="reference external" href="virtual_machines.html#adding-an-iso">“Adding an
ISO”</a>.</p>
</li>
<li><p class="first">Create a VM Instance with this ISO.</p>
<p>For more information, see <a class="reference external" href="virtual_machines.html#creating-vms">“Creating
VMs”</a>.</p>
</li>
<li><p class="first">Follow the steps in Sysprep for Windows Server 2008 R2 (below) or
Sysprep for Windows Server 2003 R2, depending on your version of
Windows Server</p>
</li>
<li><p class="first">The preparation steps are complete. Now you can actually create the
template as described in Creating the Windows Template.</p>
</li>
</ol>
<div class="section" id="system-preparation-for-windows-server-2008-r2">
<h2>System Preparation for Windows Server 2008 R2<a class="headerlink" href="templates.html#system-preparation-for-windows-server-2008-r2" title="Permalink to this headline">¶</a></h2>
<p>For Windows 2008 R2, you run Windows System Image Manager to create a
custom sysprep response XML file. Windows System Image Manager is
installed as part of the Windows Automated 安装 Kit (AIK).
Windows AIK can be downloaded from <a class="reference external" href="http://www.microsoft.com/en-us/download/details.aspx?id=9085">Microsoft Download
Center</a>.</p>
<p>Use the following steps to run sysprep for Windows 2008 R2:</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">The steps outlined here are derived from the excellent guide by
Charity Shelbourne, originally published at <a class="reference external" href="http://blogs.technet.com/askcore/archive/2008/10/31/automating-the-oobe-process-during-windows-server-2008-sysprep-mini-setup.aspx">Windows Server 2008
Sysprep Mini-Setup.</a></p>
</div>
<ol class="arabic">
<li><p class="first">Download and install the Windows AIK</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">Windows AIK should not be installed on the Windows 2008 R2 VM you
just created. Windows AIK should not be part of the template you
create. It is only used to create the sysprep answer file.</p>
</div>
</li>
<li><p class="first">Copy the install.wim file in the \sources directory of the Windows
2008 R2 installation DVD to the hard disk. This is a very large file
and may take a long time to copy. Windows AIK requires the WIM file
to be writable.</p>
</li>
<li><p class="first">Start the Windows System Image Manager, which is part of the Windows
AIK.</p>
</li>
<li><p class="first">In the Windows Image pane, right click the Select a Windows image or
catalog file option to load the install.wim file you just copied.</p>
</li>
<li><p class="first">Select the Windows 2008 R2 Edition.</p>
<p>You may be prompted with a warning that the catalog file cannot be
opened. Click Yes to create a new catalog file.</p>
</li>
<li><p class="first">In the Answer File pane, right click to create a new answer file.</p>
</li>
<li><p class="first">Generate the answer file from the Windows System Image Manager using
the following steps:</p>
<ol class="arabic">
<li><p class="first">The first page you need to automate is the Language and Country or
Region Selection page. To automate this, expand Components in your
Windows Image pane, right-click and add the
Microsoft-Windows-International-Core setting to Pass 7 oobeSystem.
In your Answer File pane, configure the InputLocale, SystemLocale,
UILanguage, and UserLocale with the appropriate settings for your
language and country or region. Should you have a question about
any of these settings, you can right-click on the specific setting
and select Help. This will open the appropriate CHM help file with
more information, including examples on the setting you are
attempting to configure.</p>
<p><img alt="sysmanager.png" src="../images/sysmanager.png" /></p>
</li>
<li><p class="first">You need to automate the Software License Terms Selection page,
otherwise known as the End-User License Agreement (EULA). To do
this, expand the Microsoft-Windows-Shell-Setup component.
High-light the OOBE setting, and add the setting to the Pass 7
oobeSystem. In Settings, set HideEULAPage true.</p>
<p><img alt="software-license.png" src="../images/software-license.png" /></p>
</li>
<li><p class="first">Make sure the license key is properly set. If you use MAK key, you
can just enter the MAK key on the Windows 2008 R2 VM. You need not
input the MAK into the Windows System Image Manager. If you use
KMS host for activation you need not enter the Product Key.
Details of Windows Volume Activation can be found at
<a class="reference external" href="http://technet.microsoft.com/en-us/library/bb892849.aspx">http://technet.microsoft.com/en-us/library/bb892849.aspx</a></p>
</li>
<li><p class="first">You need to automate is the Change Administrator Password page.
Expand the Microsoft-Windows-Shell-Setup component (if it is not
still expanded), expand UserAccounts, right-click on
AdministratorPassword, and add the setting to the Pass 7
oobeSystem configuration pass of your answer file. Under Settings,
specify a password next to Value.</p>
<p><img alt="change-admin-password.png" src="../images/change-admin-password.png" /></p>
<p>You may read the AIK documentation and set many more options that
suit your deployment. The steps above are the minimum needed to
make Windows unattended setup work.</p>
</li>
</ol>
</li>
<li><p class="first">Save the answer file as unattend.xml. You can ignore the warning
messages that appear in the validation window.</p>
</li>
<li><p class="first">Copy the unattend.xml file into the c:\windows\system32\sysprep
directory of the Windows 2008 R2 Virtual Machine</p>
</li>
<li><p class="first">Once you place the unattend.xml file in
c:\windows\system32\sysprep directory, you run the sysprep tool as
follows:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">c</span><span class="p">:</span>\<span class="n">Windows</span>\<span class="n">System32</span>\<span class="n">sysprep</span>
<span class="n">sysprep</span><span class="o">.</span><span class="n">exe</span> <span class="o">/</span><span class="n">oobe</span> <span class="o">/</span><span class="n">generalize</span> <span class="o">/</span><span class="n">shutdown</span>
</pre></div>
</div>
<p>The Windows 2008 R2 VM will automatically shut down after sysprep is
complete.</p>
</li>
</ol>
</div>
<div class="section" id="system-preparation-for-windows-server-2003-r2">
<h2>System Preparation for Windows Server 2003 R2<a class="headerlink" href="templates.html#system-preparation-for-windows-server-2003-r2" title="Permalink to this headline">¶</a></h2>
<p>Earlier versions of Windows have a different sysprep tool. Follow these
steps for Windows Server 2003 R2.</p>
<ol class="arabic">
<li><p class="first">Extract the content of \support\tools\deploy.cab on the Windows
installation CD into a directory called c:\sysprep on the Windows
2003 R2 VM.</p>
</li>
<li><p class="first">Run c:\sysprep\setupmgr.exe to create the sysprep.inf file.</p>
<ol class="arabic simple">
<li>Select Create New to create a new Answer File.</li>
<li>Enter “Sysprep setup” for the Type of Setup.</li>
<li>Select the appropriate OS version and edition.</li>
<li>On the License Agreement screen, select “Yes fully automate the
installation”.</li>
<li>Provide your name and organization.</li>
<li>Leave display settings at default.</li>
<li>Set the appropriate time zone.</li>
<li>Provide your product key.</li>
<li>Select an appropriate license mode for your deployment</li>
<li>Select “Automatically generate computer name”.</li>
<li>Type a default administrator password. If you enable the password
reset feature, the users will not actually use this password. This
password will be reset by the instance manager after the guest
boots up.</li>
<li>Leave Network Components at “Typical Settings”.</li>
<li>Select the “WORKGROUP” option.</li>
<li>Leave Telephony options at default.</li>
<li>Select appropriate Regional Settings.</li>
<li>Select appropriate language settings.</li>
<li>Do not install printers.</li>
<li>Do not specify “Run Once commands”.</li>
<li>You need not specify an identification string.</li>
<li>Save the Answer File as c:\sysprep\sysprep.inf.</li>
</ol>
</li>
<li><p class="first">Run the following command to sysprep the image:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">:</span>\<span class="n">sysprep</span>\<span class="n">sysprep</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">reseal</span> <span class="o">-</span><span class="n">mini</span> <span class="o">-</span><span class="n">activated</span>
</pre></div>
</div>
<p>After this step the machine will automatically shut down</p>
</li>
</ol>
</div>
</div>
<div class="section" id="importing-amazon-machine-images">
<h1>Importing Amazon Machine Images<a class="headerlink" href="templates.html#importing-amazon-machine-images" title="Permalink to this headline">¶</a></h1>
<p>The following procedures describe how to import an Amazon Machine Image
(AMI) into CloudStack when using the XenServer hypervisor.</p>
<p>Assume you have an AMI file and this file is called CentOS_6.2_x64.
Assume further that you are working on a CentOS host. If the AMI is a
Fedora image, you need to be working on a Fedora host initially.</p>
<p>You need to have a XenServer host with a file-based storage repository
(either a local ext3 SR or an NFS SR) to convert to a VHD once the image
file has been customized on the Centos/Fedora host.</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">When copying and pasting a command, be sure the command has pasted as
a single line before executing. Some document viewers may introduce
unwanted line breaks in copied text.</p>
</div>
<p>To import an AMI:</p>
<ol class="arabic">
<li><p class="first">Set up loopback on image file:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mkdir -p /mnt/loop/centos62</span>
<span class="c1"># mount -o loop  CentOS_6.2_x64 /mnt/loop/centos54</span>
</pre></div>
</div>
</li>
<li><p class="first">Install the kernel-xen package into the image. This downloads the PV
kernel and ramdisk to the image.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum -c /mnt/loop/centos54/etc/yum.conf --installroot=/mnt/loop/centos62/ -y install kernel-xen</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a grub entry in /boot/grub/grub.conf.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mkdir -p /mnt/loop/centos62/boot/grub</span>
<span class="c1"># touch /mnt/loop/centos62/boot/grub/grub.conf</span>
<span class="c1"># echo &quot;&quot; &gt; /mnt/loop/centos62/boot/grub/grub.conf</span>
</pre></div>
</div>
</li>
<li><p class="first">Determine the name of the PV kernel that has been installed into the
image.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cd /mnt/loop/centos62</span>
<span class="c1"># ls lib/modules/</span>
<span class="mf">2.6</span><span class="o">.</span><span class="mf">16.33</span><span class="o">-</span><span class="n">xenU</span>  <span class="mf">2.6</span><span class="o">.</span><span class="mi">16</span><span class="o">-</span><span class="n">xenU</span>  <span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.15</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5xen</span>  <span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.6</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5</span><span class="o">.</span><span class="n">centos</span><span class="o">.</span><span class="n">plus</span>  <span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="n">xenU</span><span class="o">-</span><span class="n">ec2</span><span class="o">-</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span>  <span class="mf">2.6</span><span class="o">.</span><span class="mf">21.7</span><span class="o">-</span><span class="mf">2.</span><span class="n">fc8xen</span>  <span class="mf">2.6</span><span class="o">.</span><span class="mi">31</span><span class="o">-</span><span class="mi">302</span><span class="o">-</span><span class="n">ec2</span>
<span class="c1"># ls boot/initrd*</span>
<span class="n">boot</span><span class="o">/</span><span class="n">initrd</span><span class="o">-</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.6</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5</span><span class="o">.</span><span class="n">centos</span><span class="o">.</span><span class="n">plus</span><span class="o">.</span><span class="n">img</span> <span class="n">boot</span><span class="o">/</span><span class="n">initrd</span><span class="o">-</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.15</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5xen</span><span class="o">.</span><span class="n">img</span>
<span class="c1"># ls boot/vmlinuz*</span>
<span class="n">boot</span><span class="o">/</span><span class="n">vmlinuz</span><span class="o">-</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.15</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5xen</span>  <span class="n">boot</span><span class="o">/</span><span class="n">vmlinuz</span><span class="o">-</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.6</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5</span><span class="o">.</span><span class="n">centos</span><span class="o">.</span><span class="n">plus</span>  <span class="n">boot</span><span class="o">/</span><span class="n">vmlinuz</span><span class="o">-</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="n">xenU</span><span class="o">-</span><span class="n">ec2</span><span class="o">-</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span>  <span class="n">boot</span><span class="o">/</span><span class="n">vmlinuz</span><span class="o">-</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">21</span><span class="o">-</span><span class="mf">2952.</span><span class="n">fc8xen</span>
</pre></div>
</div>
<p>Xen kernels/ramdisk always end with “xen”. For the kernel version you
choose, there has to be an entry for that version under lib/modules,
there has to be an initrd and vmlinuz corresponding to that. Above,
the only kernel that satisfies this condition is
2.6.18-164.15.1.el5xen.</p>
</li>
<li><p class="first">Based on your findings, create an entry in the grub.conf file. Below
is an example entry.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">=</span><span class="mi">0</span>
<span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
<span class="n">hiddenmenu</span>
<span class="n">title</span> <span class="n">CentOS</span> <span class="p">(</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.15</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5xen</span><span class="p">)</span>
   <span class="n">root</span> <span class="p">(</span><span class="n">hd0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">kernel</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">vmlinuz</span><span class="o">-</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.15</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5xen</span> <span class="n">ro</span> <span class="n">root</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">xvda</span>
   <span class="n">initrd</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">initrd</span><span class="o">-</span><span class="mf">2.6</span><span class="o">.</span><span class="mi">18</span><span class="o">-</span><span class="mf">164.15</span><span class="o">.</span><span class="mf">1.</span><span class="n">el5xen</span><span class="o">.</span><span class="n">img</span>
</pre></div>
</div>
</li>
<li><p class="first">Edit etc/fstab, changing “sda1” to “xvda” and changing “sdb” to
“xvdb”.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cat etc/fstab</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">xvda</span>  <span class="o">/</span>         <span class="n">ext3</span>    <span class="n">defaults</span>        <span class="mi">1</span> <span class="mi">1</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">xvdb</span>  <span class="o">/</span><span class="n">mnt</span>      <span class="n">ext3</span>    <span class="n">defaults</span>        <span class="mi">0</span> <span class="mi">0</span>
<span class="n">none</span>       <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">pts</span>  <span class="n">devpts</span>  <span class="n">gid</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="mi">620</span>  <span class="mi">0</span> <span class="mi">0</span>
<span class="n">none</span>       <span class="o">/</span><span class="n">proc</span>     <span class="n">proc</span>    <span class="n">defaults</span>        <span class="mi">0</span> <span class="mi">0</span>
<span class="n">none</span>       <span class="o">/</span><span class="n">sys</span>      <span class="n">sysfs</span>   <span class="n">defaults</span>        <span class="mi">0</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">Enable login via the console. The default console device in a
XenServer system is xvc0. Ensure that etc/inittab and etc/securetty
have the following lines respectively:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># grep xvc0 etc/inittab</span>
<span class="n">co</span><span class="p">:</span><span class="mi">2345</span><span class="p">:</span><span class="n">respawn</span><span class="p">:</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">agetty</span> <span class="n">xvc0</span> <span class="mi">9600</span> <span class="n">vt100</span><span class="o">-</span><span class="n">nav</span>
<span class="c1"># grep xvc0 etc/securetty</span>
<span class="n">xvc0</span>
</pre></div>
</div>
</li>
<li><p class="first">Ensure the ramdisk supports PV disk and PV network. Customize this
for the kernel version you have determined above.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># chroot /mnt/loop/centos54</span>
<span class="c1"># cd /boot/</span>
<span class="c1"># mv initrd-2.6.18-164.15.1.el5xen.img initrd-2.6.18-164.15.1.el5xen.img.bak</span>
<span class="c1"># mkinitrd -f /boot/initrd-2.6.18-164.15.1.el5xen.img --with=xennet --preload=xenblk --omit-scsi-modules 2.6.18-164.15.1.el5xen</span>
</pre></div>
</div>
</li>
<li><p class="first">Change the password.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># passwd</span>
<span class="n">Changing</span> <span class="n">password</span> <span class="k">for</span> <span class="n">user</span> <span class="n">root</span><span class="o">.</span>
<span class="n">New</span> <span class="n">UNIX</span> <span class="n">password</span><span class="p">:</span>
<span class="n">Retype</span> <span class="n">new</span> <span class="n">UNIX</span> <span class="n">password</span><span class="p">:</span>
<span class="n">passwd</span><span class="p">:</span> <span class="nb">all</span> <span class="n">authentication</span> <span class="n">tokens</span> <span class="n">updated</span> <span class="n">successfully</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p class="first">Exit out of chroot.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># exit</span>
</pre></div>
</div>
</li>
<li><p class="first">Check <cite>etc/ssh/sshd_config</cite> for lines allowing ssh login using a
password.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># egrep &quot;PermitRootLogin|PasswordAuthentication&quot; /mnt/loop/centos54/etc/ssh/sshd_config</span>
<span class="n">PermitRootLogin</span> <span class="n">yes</span>
<span class="n">PasswordAuthentication</span> <span class="n">yes</span>
</pre></div>
</div>
</li>
<li><p class="first">If you need the template to be enabled to reset passwords from the
CloudStack UI or API, install the password change script into the
image at this point. See <a class="reference internal" href="templates/_password.html#adding-password-management-to-templates"><span class="std std-ref">给模板添加密码管理功能</span></a>.</p>
</li>
<li><p class="first">Unmount and delete loopback mount.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># umount /mnt/loop/centos54</span>
<span class="c1"># losetup -d /dev/loop0</span>
</pre></div>
</div>
</li>
<li><p class="first">Copy the image file to your XenServer host’s file-based storage
repository. In the example below, the Xenserver is “xenhost”. This
XenServer has an NFS repository whose uuid is
a9c5b8c8-536b-a193-a6dc-51af3e5ff799.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># scp CentOS_6.2_x64 xenhost:/var/run/sr-mount/a9c5b8c8-536b-a193-a6dc-51af3e5ff799/</span>
</pre></div>
</div>
</li>
<li><p class="first">Log in to the Xenserver and create a VDI the same size as the image.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@xenhost</span> <span class="o">~</span><span class="p">]</span><span class="c1"># cd /var/run/sr-mount/a9c5b8c8-536b-a193-a6dc-51af3e5ff799</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@xenhost</span> <span class="n">a9c5b8c8</span><span class="o">-</span><span class="mi">536</span><span class="n">b</span><span class="o">-</span><span class="n">a193</span><span class="o">-</span><span class="n">a6dc</span><span class="o">-</span><span class="mi">51</span><span class="n">af3e5ff799</span><span class="p">]</span><span class="c1">#  ls -lh CentOS_6.2_x64</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">10</span><span class="n">G</span> <span class="n">Mar</span> <span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">49</span> <span class="n">CentOS_6</span><span class="o">.</span><span class="mi">2</span><span class="n">_x64</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@xenhost</span> <span class="n">a9c5b8c8</span><span class="o">-</span><span class="mi">536</span><span class="n">b</span><span class="o">-</span><span class="n">a193</span><span class="o">-</span><span class="n">a6dc</span><span class="o">-</span><span class="mi">51</span><span class="n">af3e5ff799</span><span class="p">]</span><span class="c1"># xe vdi-create virtual-size=10GiB sr-uuid=a9c5b8c8-536b-a193-a6dc-51af3e5ff799 type=user name-label=&quot;Centos 6.2 x86_64&quot;</span>
<span class="n">cad7317c</span><span class="o">-</span><span class="mi">258</span><span class="n">b</span><span class="o">-</span><span class="mi">4</span><span class="n">ef7</span><span class="o">-</span><span class="n">b207</span><span class="o">-</span><span class="n">cdf0283a7923</span>
</pre></div>
</div>
</li>
<li><p class="first">Import the image file into the VDI. This may take 10–20 minutes.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@xenhost</span> <span class="n">a9c5b8c8</span><span class="o">-</span><span class="mi">536</span><span class="n">b</span><span class="o">-</span><span class="n">a193</span><span class="o">-</span><span class="n">a6dc</span><span class="o">-</span><span class="mi">51</span><span class="n">af3e5ff799</span><span class="p">]</span><span class="c1"># xe vdi-import filename=CentOS_6.2_x64 uuid=cad7317c-258b-4ef7-b207-cdf0283a7923</span>
</pre></div>
</div>
</li>
<li><p class="first">Locate a the VHD file. This is the file with the VDI’s UUID as its
name. Compress it and upload it to your web server.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@xenhost</span> <span class="n">a9c5b8c8</span><span class="o">-</span><span class="mi">536</span><span class="n">b</span><span class="o">-</span><span class="n">a193</span><span class="o">-</span><span class="n">a6dc</span><span class="o">-</span><span class="mi">51</span><span class="n">af3e5ff799</span><span class="p">]</span><span class="c1"># bzip2 -c cad7317c-258b-4ef7-b207-cdf0283a7923.vhd &gt; CentOS_6.2_x64.vhd.bz2</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@xenhost</span> <span class="n">a9c5b8c8</span><span class="o">-</span><span class="mi">536</span><span class="n">b</span><span class="o">-</span><span class="n">a193</span><span class="o">-</span><span class="n">a6dc</span><span class="o">-</span><span class="mi">51</span><span class="n">af3e5ff799</span><span class="p">]</span><span class="c1"># scp CentOS_6.2_x64.vhd.bz2 webserver:/var/www/html/templates/</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="converting-a-hyper-v-vm-to-a-template">
<h1>将 Hyper-V 虚拟机转成模版<a class="headerlink" href="templates.html#converting-a-hyper-v-vm-to-a-template" title="Permalink to this headline">¶</a></h1>
<p>To convert a Hyper-V VM to a XenServer-compatible CloudStack template,
you will need a standalone XenServer host with an attached NFS VHD SR.
Use whatever XenServer version you are using with CloudStack, but use
XenCenter 5.6 FP1 or SP2 (it is backwards compatible to 5.6).
Additionally, it may help to have an attached NFS ISO SR.</p>
<p>For Linux VMs, you may need to do some preparation in Hyper-V before
trying to get the VM to work in XenServer. Clone the VM and work on the
clone if you still want to use the VM in Hyper-V. Uninstall Hyper-V
Integration Components and check for any references to device names in
/etc/fstab:</p>
<ol class="arabic simple">
<li>From the linux_ic/drivers/dist directory, run make uninstall (where
“linux_ic” is the path to the copied Hyper-V Integration Components
files).</li>
<li>Restore the original initrd from backup in /boot/ (the backup is
named *.backup0).</li>
<li>Remove the “hdX=noprobe” entries from /boot/grub/menu.lst.</li>
<li>Check /etc/fstab for any partitions mounted by device name. Change
those entries (if any) to mount by LABEL or UUID. You can get that
information with the blkid command.</li>
</ol>
<p>The next step is make sure the VM is not running in Hyper-V, then get
the VHD into XenServer. There are two options for doing this.</p>
<p>Option one:</p>
<ol class="arabic simple">
<li>Import the VHD using XenCenter. In XenCenter, go to Tools&gt;Virtual
Appliance Tools&gt;Disk Image Import.</li>
<li>Choose the VHD, then click Next.</li>
<li>Name the VM, choose the NFS VHD SR under Storage, enable “Run
操作系统 Fixups” and choose the NFS ISO SR.</li>
<li>Click Next, then Finish. A VM should be created.</li>
</ol>
<p>Option two:</p>
<ol class="arabic simple">
<li>Run XenConvert, under From choose VHD, under To choose XenServer.
Click Next.</li>
<li>Choose the VHD, then click Next.</li>
<li>Input the XenServer host info, then click Next.</li>
<li>Name the VM, then click Next, then Convert. A VM should be created.</li>
</ol>
<p>Once you have a VM created from the Hyper-V VHD, prepare it using the
following steps:</p>
<ol class="arabic simple">
<li>Boot the VM, uninstall Hyper-V Integration Services, and reboot.</li>
<li>Install XenServer Tools, then reboot.</li>
<li>Prepare the VM as desired. For example, run sysprep on Windows VMs.
See <a class="reference external" href="templates.html#creating-a-windows-template">“Creating a Windows
Template”</a>.</li>
</ol>
<p>Either option above will create a VM in HVM mode. This is fine for
Windows VMs, but Linux VMs may not perform optimally. Converting a Linux
VM to PV mode will require additional steps and will vary by
distribution.</p>
<ol class="arabic simple">
<li>Shut down the VM and copy the VHD from the NFS storage to a web
server; for example, mount the NFS share on the web server and copy
it, or from the XenServer host use sftp or scp to upload it to the
web server.</li>
<li>In CloudStack, create a new template using the following values:<ul>
<li>URL. Give the URL for the VHD</li>
<li>OS Type. Use the appropriate OS. For PV mode on CentOS, choose
Other PV (32-bit) or Other PV (64-bit). This choice is available
only for XenServer.</li>
<li>Hypervisor. XenServer</li>
<li>Format. VHD</li>
</ul>
</li>
</ol>
<p>The template will be created, and you can create instances from it.</p>
</div>
<div class="section" id="adding-password-management-to-your-templates">
<span id="adding-password-management-to-templates"></span><h1>给模板添加密码管理功能<a class="headerlink" href="templates.html#adding-password-management-to-your-templates" title="Permalink to this headline">¶</a></h1>
<p>CloudStack provides an optional password reset feature that allows users
to set a temporary admin or root password as well as reset the existing
admin or root password from the CloudStack UI.</p>
<p>To enable the Reset Password feature, you will need to download an
additional script to patch your template. When you later upload the
template into CloudStack, you can specify whether reset admin/root
password feature should be enabled for this template.</p>
<p>The password management feature works always resets the account password
on instance boot. The script does an HTTP call to the virtual router to
retrieve the account password that should be set. As long as the virtual
router is accessible the guest will have access to the account password
that should be used. When the user requests a password reset the
management server generates and sends a new password to the virtual
router for the account. Thus an instance reboot is necessary to effect
any password changes.</p>
<p>If the script is unable to contact the virtual router during instance
boot it will not set the password but boot will continue normally.</p>
<div class="section" id="linux-os-installation">
<h2>Linux OS 安装<a class="headerlink" href="templates.html#linux-os-installation" title="Permalink to this headline">¶</a></h2>
<p>Use the following steps to begin the Linux OS installation:</p>
<ol class="arabic">
<li><p class="first">Download the latest version of the cloud-set-guest-password script from the repository:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/apache/cloudstack/blob/master/setup/bindir/cloud-set-guest-password.in">https://github.com/apache/cloudstack/blob/master/setup/bindir/cloud-set-guest-password.in</a></li>
</ul>
</li>
<li><p class="first">Rename the file:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mv</span> <span class="n">cloud</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">password</span><span class="o">.</span><span class="ow">in</span> <span class="n">cloud</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">password</span>
</pre></div>
</div>
</li>
<li><p class="first">Copy this file to /etc/init.d.</p>
<p>On some Linux distributions, copy the file to <code class="docutils literal notranslate"><span class="pre">/etc/rc.d/init.d</span></code>.</p>
</li>
<li><p class="first">Run the following command to make the script executable:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">cloud</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">password</span>
</pre></div>
</div>
</li>
<li><p class="first">Depending on the Linux distribution, continue with the appropriate
step.</p>
<p>On Fedora, CentOS/RHEL, and Debian, run:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chkconfig</span> <span class="o">--</span><span class="n">add</span> <span class="n">cloud</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">password</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="windows-os-installation">
<h2>Windows OS 安装<a class="headerlink" href="templates.html#windows-os-installation" title="Permalink to this headline">¶</a></h2>
<p>Download the installer, CloudInstanceManager.msi, from the <a class="reference external" href="http://sourceforge.net/projects/cloudstack/files/Password%20Management%20Scripts/CloudInstanceManager.msi/download">Download
page</a>
and run the installer in the newly created Windows VM.</p>
</div>
</div>
<div class="section" id="deleting-templates">
<h1>删除模版<a class="headerlink" href="templates.html#deleting-templates" title="Permalink to this headline">¶</a></h1>
<p>模板 may be deleted. In general, when a template spans multiple
Zones, only the copy that is selected for deletion will be deleted; the
same template in other Zones will not be deleted. The provided CentOS
template is an exception to this. If the provided CentOS template is
deleted, it will be deleted from all Zones.</p>
<p>When templates are deleted, the VMs instantiated from them will continue
to run. However, new VMs cannot be created based on the deleted
template.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hosts.html" class="btn btn-neutral float-right" title="添加主机" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="virtual_machines.html" class="btn btn-neutral float-left" title="虚拟机" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Foundation
      
        <span class="commit">
          Revision <code>af137188</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 4.12.0.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="http://docs.cloudstack.apache.org/en/master/">master</a></dd>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../../4.13.0.0/index.html">4.13.0.0</a></dd>
        
          <dd><a href="../index.html">4.12.0.0</a></dd>
        
          <dd><a href="../../4.11.3.0/index.html">4.11.3.0</a></dd>
        
          <dd><a href="../../4.11.2.0/index.html">4.11.2.0</a></dd>
        
          <dd><a href="../../4.11.1.0/index.html">4.11.1.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/cloudstack-documentation/downloads/htmlzip/4.12.0.0/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/cloudstack-documentation/?fromdocs=cloudstack-documentation">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/cloudstack-documentation/?fromdocs=cloudstack-documentation">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>