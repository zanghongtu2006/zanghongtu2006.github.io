

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quick Installation Guide &mdash; Apache CloudStack 4.13.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installation Guide" href="../installguide/index.html" />
    <link rel="prev" title="Introduction" href="../conceptsandterminology/storage_setup.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="../../latest/quickinstallationguide/qig.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "quickinstallationguide/qig"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache CloudStack
          

          
          </a>

          
            
            
            
              <div class="version">
                4.13.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conceptsandterminology/index.html">CloudStack Concepts and Terminology</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="qig.html#">Quick Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="qig.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="qig.html#what-exactly-are-we-building">What exactly are we building?</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#high-level-overview-of-the-process">High level overview of the process</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="qig.html#environment">Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="qig.html#operating-system">Operating System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="qig.html#configuring-the-network">Configuring the network</a></li>
<li class="toctree-l4"><a class="reference internal" href="qig.html#hostname">Hostname</a></li>
<li class="toctree-l4"><a class="reference internal" href="qig.html#selinux">SELinux</a></li>
<li class="toctree-l4"><a class="reference internal" href="qig.html#ntp">NTP</a></li>
<li class="toctree-l4"><a class="reference internal" href="qig.html#configuring-the-cloudstack-package-repository">Configuring the CloudStack Package Repository</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#nfs">NFS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="qig.html#management-server-installation">Management Server Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="qig.html#database-installation-and-configuration">Database Installation and Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#mysql-connector-installation">MySQL connector Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#system-template-setup">System Template Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="qig.html#kvm-setup-and-installation">KVM Setup and Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="qig.html#id1">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#id2">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#kvm-configuration">KVM Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="qig.html#qemu-configuration">QEMU Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="qig.html#libvirt-configuration">Libvirt Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="qig.html#kvm-configuration-complete">KVM configuration complete</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="qig.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="qig.html#ui-access">UI Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#setting-up-a-zone">Setting up a Zone</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#pod-configuration">Pod Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="qig.html#cluster">Cluster</a><ul>
<li class="toctree-l4"><a class="reference internal" href="qig.html#primary-storage">Primary Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="qig.html#secondary-storage">Secondary Storage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installguide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">Upgrading CloudStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adminguide/index.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developersguide/index.html">Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Home">Apache CloudStack Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/">Apache CloudStack web site</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache CloudStack Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/cloudstack">Apache CloudStack on GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre 4.11 Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-administration.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-release-notes.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CloudStack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Quick Installation Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/cloudstack-documentation/blob/4.13.0.0/source/quickinstallationguide/qig.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quick-installation-guide">
<h1>Quick Installation Guide<a class="headerlink" href="qig.html#quick-installation-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="qig.html#overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-exactly-are-we-building">
<h3>What exactly are we building?<a class="headerlink" href="qig.html#what-exactly-are-we-building" title="Permalink to this headline">¶</a></h3>
<p>Infrastructure-as-a-Service (IaaS) clouds can be a complex thing to build, and
by definition they have a plethora of options, which often lead to confusion
for even experienced admins who are newcomers to building cloud platforms. The
goal for this runbook is to provide a straightforward set of instructions to
get you up and running with CloudStack with a minimum amount of trouble.</p>
</div>
<div class="section" id="high-level-overview-of-the-process">
<h3>High level overview of the process<a class="headerlink" href="qig.html#high-level-overview-of-the-process" title="Permalink to this headline">¶</a></h3>
<p>This runbook will focus on building a CloudStack cloud using KVM on CentOS
7.5 with NFS storage on a flat layer-2 network utilizing layer-3 network
isolation (aka Security Groups), and doing it all on a single piece of
hardware.</p>
<p>KVM, or Kernel-based Virtual Machine is a virtualization technology for the
Linux kernel. KVM supports native virtualization atop processors with hardware
virtualization extensions.</p>
<p>Security Groups act as distributed firewalls that control access to a group of
virtual machines.</p>
</div>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="qig.html#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>To complete this runbook you’ll need the following items:</p>
<ol class="arabic simple">
<li>At least one computer which supports and has enabled hardware virtualization.</li>
<li>An <a class="reference external" href="http://mirrors.kernel.org/centos/7/isos/x86_64/">CentOS 7.5 x86_64 install ISO, on bootable media</a></li>
<li>A /24 network with the gateway being at xxx.xxx.xxx.1, no DHCP should be on
this network and none of the computers running CloudStack will have a
dynamic address. Again this is done for the sake of simplicity.</li>
</ol>
</div>
</div>
<div class="section" id="environment">
<h2>Environment<a class="headerlink" href="qig.html#environment" title="Permalink to this headline">¶</a></h2>
<p>Before you begin , you need to prepare the environment before you install
CloudStack. We will go over the steps to prepare now.</p>
<div class="section" id="operating-system">
<h3>Operating System<a class="headerlink" href="qig.html#operating-system" title="Permalink to this headline">¶</a></h3>
<p>Using the CentOS 7.5 x86_64 install ISO, you’ll need to install CentOS 7
on your hardware. The defaults will generally be acceptable for this
installation. You may want to configure network configuration during
setup - either using the guidelines below, or using a standard access
configuration which we will modify later.</p>
<p>Once this installation is complete, you’ll want to gain access to your
server - through SSH (if network is configured) or connected peripherals.
Note that you should not allow remote root logins in a production
environment, so be sure to turn off this feature once the installation
and configuration is complete.</p>
<p>If your network interface was configured to grant the server internet
access, it is always wise to update the system before starting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum -y upgrade</span>
</pre></div>
</div>
<div class="section" id="configuring-the-network">
<span id="conf-network"></span><h4>Configuring the network<a class="headerlink" href="qig.html#configuring-the-network" title="Permalink to this headline">¶</a></h4>
<p>Unless you have configured it during install, which will not be covered by
this guide, the network interface will not come up on your hardware and you
will need to configure it to work in your environment. Since we specified
that there will be no DHCP server in this environment we will be manually
configuring your network interface.</p>
<p>Before going any further, make sure that “brctl” is installed and available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum install bridge-utils -y</span>
</pre></div>
</div>
<p>Connecting via the console you should login as root. We will start by creating
the bridge that Cloudstack will use for networking. Create and open
/etc/sysconfig/network-scripts/ifcfg-cloudbr0 and add the following settings:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">IP Addressing - Throughout this document we are assuming that you will have
a /24 network for your CloudStack implementation. This can be any RFC 1918
network. However, we are assuming that you will match the machine address
that we are using. Thus we may use 172.16.10.2 and because you might be
using the 192.168.55.0/24 network you would use 192.168.55.2</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DEVICE</span><span class="o">=</span><span class="n">cloudbr0</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">Bridge</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">static</span>
<span class="n">IPV6INIT</span><span class="o">=</span><span class="n">no</span>
<span class="n">IPV6_AUTOCONF</span><span class="o">=</span><span class="n">no</span>
<span class="n">DELAY</span><span class="o">=</span><span class="mi">5</span>
<span class="n">IPADDR</span><span class="o">=</span><span class="mf">172.16</span><span class="o">.</span><span class="mf">10.2</span>
<span class="n">GATEWAY</span><span class="o">=</span><span class="mf">172.16</span><span class="o">.</span><span class="mf">10.1</span>
<span class="n">NETMASK</span><span class="o">=</span><span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
<span class="n">DNS1</span><span class="o">=</span><span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span>
<span class="n">DNS2</span><span class="o">=</span><span class="mf">8.8</span><span class="o">.</span><span class="mf">4.4</span>
<span class="n">STP</span><span class="o">=</span><span class="n">yes</span>
<span class="n">USERCTL</span><span class="o">=</span><span class="n">no</span>
<span class="n">NM_CONTROLLED</span><span class="o">=</span><span class="n">no</span>
</pre></div>
</div>
<p>Save the configuration and exit. We will then edit the interface so that it
makes use of this bridge.</p>
<p>Open the configuration file of your interface and configure it as follows:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Interface name used as example only. Replace eth0 with your default ethernet interface name.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TYPE</span><span class="o">=</span><span class="n">Ethernet</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">none</span>
<span class="n">DEFROUTE</span><span class="o">=</span><span class="n">yes</span>
<span class="n">NAME</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">BRIDGE</span><span class="o">=</span><span class="n">cloudbr0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should not use the Hardware Address (aka the MAC address, or UUID) from our
example for your configuration. It is network interface specific, so you
should keep the address already provided in the UUID directive.</p>
</div>
<p>Now that we have the configuration files properly set up, we need to run a few
commands to start up the network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl enable network</span>

<span class="c1"># systemctl restart network</span>
</pre></div>
</div>
<p>Note that if you were connected through SSH, you will be temporarily (~5 seconds depending on hardware) disconnected. If the disconnection lasts, there was an error in configuration.</p>
</div>
<div class="section" id="hostname">
<span id="conf-hostname"></span><h4>Hostname<a class="headerlink" href="qig.html#hostname" title="Permalink to this headline">¶</a></h4>
<p>CloudStack requires that the hostname be properly set. If you used the default
options in the installation, then your hostname is currently set to
localhost.localdomain. To test this we will run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostname --fqdn</span>
</pre></div>
</div>
<p>At this point it will likely return:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">localhost</span>
</pre></div>
</div>
<p>To rectify this situation - we’ll set the hostname by editing the /etc/hosts
file so that it follows a similar format to this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="n">localhost</span> <span class="n">localhost</span><span class="o">.</span><span class="n">localdomain</span> <span class="n">localhost4</span> <span class="n">localhost4</span><span class="o">.</span><span class="n">localdomain4</span>
<span class="p">::</span><span class="mi">1</span> <span class="n">localhost</span> <span class="n">localhost</span><span class="o">.</span><span class="n">localdomain</span> <span class="n">localhost6</span> <span class="n">localhost6</span><span class="o">.</span><span class="n">localdomain6</span>
<span class="mf">172.16</span><span class="o">.</span><span class="mf">10.2</span> <span class="n">srvr1</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">priv</span>
</pre></div>
</div>
<p>After you’ve modified that file, go ahead and restart the network using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl restart network</span>
</pre></div>
</div>
<p>Now recheck with the hostname –fqdn command and ensure that it returns a FQDN
response</p>
</div>
<div class="section" id="selinux">
<span id="conf-selinux"></span><h4>SELinux<a class="headerlink" href="qig.html#selinux" title="Permalink to this headline">¶</a></h4>
<p>At the moment, for CloudStack to work properly SELinux must be set to
permissive. We want to both configure this for future boots and modify it in
the current running system.</p>
<p>To configure SELinux to be permissive in the running system we need to run the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># setenforce 0</span>
</pre></div>
</div>
<p>To ensure that it remains in that state we need to configure the file
/etc/selinux/config to reflect the permissive state, as shown in this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file controls the state of SELinux on the system.</span>
<span class="c1"># SELINUX= can take one of these three values:</span>
<span class="c1"># enforcing - SELinux security policy is enforced.</span>
<span class="c1"># permissive - SELinux prints warnings instead of enforcing.</span>
<span class="c1"># disabled - No SELinux policy is loaded.</span>
<span class="n">SELINUX</span><span class="o">=</span><span class="n">permissive</span>
<span class="c1"># SELINUXTYPE= can take one of these two values:</span>
<span class="c1"># targeted - Targeted processes are protected,</span>
<span class="c1"># mls - Multi Level Security protection.</span>
<span class="n">SELINUXTYPE</span><span class="o">=</span><span class="n">targeted</span>
</pre></div>
</div>
</div>
<div class="section" id="ntp">
<span id="conf-ntp"></span><h4>NTP<a class="headerlink" href="qig.html#ntp" title="Permalink to this headline">¶</a></h4>
<p>NTP configuration is a necessity for keeping all of the clocks in your cloud
servers in sync. However, NTP is not installed by default. So we’ll install
and and configure NTP at this stage. Installation is accomplished as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum -y install ntp</span>
</pre></div>
</div>
<p>The actual default configuration is fine for our purposes, so we merely need
to enable it and set it to start on boot as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl enable ntpd</span>
<span class="c1"># systemctl start ntpd</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-cloudstack-package-repository">
<span id="qigconf-pkg-repo"></span><h4>Configuring the CloudStack Package Repository<a class="headerlink" href="qig.html#configuring-the-cloudstack-package-repository" title="Permalink to this headline">¶</a></h4>
<p>We need to configure the machine to use a CloudStack package repository.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Apache CloudStack official releases are source code. As such there are
no ‘official’ binaries available. The full installation guide describes how
to take the source release and generate RPMs and and yum repository. This
guide attempts to keep things as simple as possible, and thus we are using
one of the community-provided yum repositories. Furthermore, this example
assumes a 4.11 Cloudstack install - substitute versions as needed.</p>
</div>
<p>To add the CloudStack repository, create /etc/yum.repos.d/cloudstack.repo and
insert the following information.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">cloudstack</span><span class="p">]</span>
<span class="n">name</span><span class="o">=</span><span class="n">cloudstack</span>
<span class="n">baseurl</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">cloudstack</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="mf">4.11</span><span class="o">/</span>
<span class="n">enabled</span><span class="o">=</span><span class="mi">1</span>
<span class="n">gpgcheck</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nfs">
<h3>NFS<a class="headerlink" href="qig.html#nfs" title="Permalink to this headline">¶</a></h3>
<p>Our configuration is going to use NFS for both primary and secondary storage.
We are going to go ahead and setup two NFS shares for those purposes. We’ll
start out by installing nfs-utils.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum -y install nfs-utils</span>
</pre></div>
</div>
<p>We now need to configure NFS to serve up two different shares. This is handled
comparatively easily in the /etc/exports file. You should ensure that it has
the following content:</p>
<pre class="literal-block">
/export/secondary *(rw,async,no_root_squash,no_subtree_check)
/export/primary *(rw,async,no_root_squash,no_subtree_check)
</pre>
<p>You will note that we specified two directories that don’t exist (yet) on the
system. We’ll go ahead and create those directories and set permissions
appropriately on them with the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mkdir -p /export/primary</span>
<span class="c1"># mkdir /export/secondary</span>
</pre></div>
</div>
<p>CentOS 7.x releases use NFSv4 by default. NFSv4 requires that domain setting
matches on all clients. In our case, the domain is cloud.priv, so ensure that
the domain setting in /etc/idmapd.conf is uncommented and set as follows:
Domain = cloud.priv</p>
<p>Now you’ll need to add the configuration values at the bottom in the file
/etc/sysconfig/nfs (or merely uncomment and set them)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCKD_TCPPORT</span><span class="o">=</span><span class="mi">32803</span>
<span class="n">LOCKD_UDPPORT</span><span class="o">=</span><span class="mi">32769</span>
<span class="n">MOUNTD_PORT</span><span class="o">=</span><span class="mi">892</span>
<span class="n">RQUOTAD_PORT</span><span class="o">=</span><span class="mi">875</span>
<span class="n">STATD_PORT</span><span class="o">=</span><span class="mi">662</span>
<span class="n">STATD_OUTGOING_PORT</span><span class="o">=</span><span class="mi">2020</span>
</pre></div>
</div>
<p>Now we need to disable the firewall, so that it will not block connections.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Configuration of the firewall on CentOS7 is beyond the purview of this
guide.</p>
</div>
<p>To do so, simply use the following two commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl stop firewalld</span>
<span class="c1"># systemctl disable firewalld</span>
</pre></div>
</div>
<p>We now need to configure the nfs service to start on boot and actually start
it on the host by executing the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl enable rpcbind</span>
<span class="c1"># systemctl enable nfs</span>
<span class="c1"># systemctl start rpcbind</span>
<span class="c1"># systemctl start nfs</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="management-server-installation">
<h2>Management Server Installation<a class="headerlink" href="qig.html#management-server-installation" title="Permalink to this headline">¶</a></h2>
<p>We’re going to install the CloudStack management server and surrounding tools.</p>
<div class="section" id="database-installation-and-configuration">
<h3>Database Installation and Configuration<a class="headerlink" href="qig.html#database-installation-and-configuration" title="Permalink to this headline">¶</a></h3>
<p>We’ll start with installing MySQL and configuring some options to ensure it
runs well with CloudStack.</p>
<p>First, as CentOS 7 no longer provides the MySQL binaries, we need to add a repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span>
<span class="c1"># rpm -ivh mysql-community-release-el7-5.noarch.rpm</span>
<span class="c1"># yum -y update</span>
</pre></div>
</div>
<p>Install by running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum -y install mysql-server</span>
</pre></div>
</div>
<p>With MySQL now installed we need to make a few configuration changes to
/etc/my.cnf. Specifically we need to add the following options to the [mysqld]
section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">innodb_rollback_on_timeout</span><span class="o">=</span><span class="mi">1</span>
<span class="n">innodb_lock_wait_timeout</span><span class="o">=</span><span class="mi">600</span>
<span class="n">max_connections</span><span class="o">=</span><span class="mi">350</span>
<span class="n">log</span><span class="o">-</span><span class="nb">bin</span><span class="o">=</span><span class="n">mysql</span><span class="o">-</span><span class="nb">bin</span>
<span class="n">binlog</span><span class="o">-</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;ROW&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Ubuntu 16.04 and later, make sure you specify a <code class="docutils literal notranslate"><span class="pre">server-id</span></code> in your <code class="docutils literal notranslate"><span class="pre">.cnf</span></code> file for binary logging. Set the     <code class="docutils literal notranslate"><span class="pre">server-id</span></code> according to your database setup.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">server</span><span class="o">-</span><span class="nb">id</span><span class="o">=</span><span class="n">master</span><span class="o">-</span><span class="mi">01</span>
<span class="n">innodb_rollback_on_timeout</span><span class="o">=</span><span class="mi">1</span>
<span class="n">innodb_lock_wait_timeout</span><span class="o">=</span><span class="mi">600</span>
<span class="n">max_connections</span><span class="o">=</span><span class="mi">350</span>
<span class="n">log</span><span class="o">-</span><span class="nb">bin</span><span class="o">=</span><span class="n">mysql</span><span class="o">-</span><span class="nb">bin</span>
<span class="n">binlog</span><span class="o">-</span><span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;ROW&#39;</span>
</pre></div>
</div>
<p>Now that MySQL is properly configured we can start it and configure it to
start on boot as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl enable mysqld</span>
<span class="c1"># systemctl start mysqld</span>
</pre></div>
</div>
</div>
<div class="section" id="mysql-connector-installation">
<h3>MySQL connector Installation<a class="headerlink" href="qig.html#mysql-connector-installation" title="Permalink to this headline">¶</a></h3>
<p>Install Python MySQL connector using the official MySQL packages repository.
Create the file <code class="docutils literal notranslate"><span class="pre">/etc/yum.repos.d/mysql.repo</span></code> with the following content:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[mysql-connectors-community]
name=MySQL Community connectors
baseurl=http://repo.mysql.com/yum/mysql-connectors-community/el/$releasever/$basearch/
enabled=1
gpgcheck=1
</pre></div>
</div>
<p>Import GPG public key from MySQL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rpm</span> <span class="o">--</span><span class="kn">import</span> <span class="nn">http</span><span class="p">:</span><span class="o">//</span><span class="n">repo</span><span class="o">.</span><span class="n">mysql</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">mysql</span>
</pre></div>
</div>
<p>Install mysql-connector</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span>
</pre></div>
</div>
</div>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="qig.html#installation" title="Permalink to this headline">¶</a></h3>
<p>We are now going to install the management server. We do that by executing the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum -y install cloudstack-management</span>
</pre></div>
</div>
<p>With the application itself installed we can now setup the database, we’ll do
that with the following command and options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cloudstack-setup-databases cloud:password@localhost --deploy-as=root</span>
</pre></div>
</div>
<p>When this process is finished, you should see a message like “CloudStack has
successfully initialized the database.”</p>
<p>Now that the database has been created, we can take the final step in setting
up the management server by issuing the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cloudstack-setup-management</span>
</pre></div>
</div>
<p>If the servlet container is Tomcat7 the argument –tomcat7 must be used.</p>
</div>
<div class="section" id="system-template-setup">
<h3>System Template Setup<a class="headerlink" href="qig.html#system-template-setup" title="Permalink to this headline">¶</a></h3>
<p>CloudStack uses a number of system VMs to provide functionality for accessing
the console of virtual machines, providing various networking services, and
managing various aspects of storage. This step will acquire those system
images ready for deployment when we bootstrap your cloud.</p>
<p>Now we need to download the system VM template and deploy that to the share we
just mounted. The management server includes a script to properly manipulate
the system VMs images.</p>
<pre class="literal-block">
/usr/share/cloudstack-common/scripts/storage/secondary/cloud-install-sys-tmplt -m /export/secondary -u <a class="reference external" href="http://download.cloudstack.org/systemvm/4.11/systemvmtemplate-4.11.2-kvm.qcow2.bz2">http://download.cloudstack.org/systemvm/4.11/systemvmtemplate-4.11.2-kvm.qcow2.bz2</a> -h kvm -F
</pre>
<p>That concludes our setup of the management server. We still need to configure
CloudStack, but we will do that after we get our hypervisor set up.</p>
</div>
</div>
<div class="section" id="kvm-setup-and-installation">
<h2>KVM Setup and Installation<a class="headerlink" href="qig.html#kvm-setup-and-installation" title="Permalink to this headline">¶</a></h2>
<p>KVM is the hypervisor we’ll be using - we will recover the initial setup which
has already been done on the hypervisor host and cover installation of the
agent software, you can use the same steps to add additional KVM nodes to your
CloudStack environment.</p>
<div class="section" id="id1">
<h3>Prerequisites<a class="headerlink" href="qig.html#id1" title="Permalink to this headline">¶</a></h3>
<p>We explicitly are using the management server as a compute node as well, which
means that we have already performed many of the prerequisite steps when
setting up the management server, but we will list them here for clarity.
Those steps are:</p>
<p><a class="reference internal" href="qig.html#conf-network"><span class="std std-ref">Configuring the network</span></a></p>
<p><a class="reference internal" href="qig.html#conf-hostname"><span class="std std-ref">Hostname</span></a></p>
<p><a class="reference internal" href="qig.html#conf-selinux"><span class="std std-ref">SELinux</span></a></p>
<p><a class="reference internal" href="qig.html#conf-ntp"><span class="std std-ref">NTP</span></a></p>
<p><a class="reference internal" href="qig.html#qigconf-pkg-repo"><span class="std std-ref">Configuring the CloudStack Package Repository</span></a></p>
<p>You shouldn’t need to do that for the management server, of course, but any
additional hosts will need for you to complete the above steps.</p>
</div>
<div class="section" id="id2">
<h3>Installation<a class="headerlink" href="qig.html#id2" title="Permalink to this headline">¶</a></h3>
<p>Installation of the KVM agent is trivial with just a single command, but
afterwards we’ll need to configure a few things.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum -y install cloudstack-agent</span>
</pre></div>
</div>
</div>
<div class="section" id="kvm-configuration">
<h3>KVM Configuration<a class="headerlink" href="qig.html#kvm-configuration" title="Permalink to this headline">¶</a></h3>
<p>We have two different parts of KVM to configure, libvirt, and QEMU.</p>
<div class="section" id="qemu-configuration">
<h4>QEMU Configuration<a class="headerlink" href="qig.html#qemu-configuration" title="Permalink to this headline">¶</a></h4>
<p>KVM configuration is relatively simple at only a single item. We need to edit
the QEMU VNC configuration. This is done by editing /etc/libvirt/qemu.conf and
ensuring the following line is present and uncommented.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vnc_listen</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>
</pre></div>
</div>
</div>
<div class="section" id="libvirt-configuration">
<h4>Libvirt Configuration<a class="headerlink" href="qig.html#libvirt-configuration" title="Permalink to this headline">¶</a></h4>
<p>CloudStack uses libvirt for managing virtual machines. Therefore it is vital
that libvirt is configured correctly. Libvirt is a dependency of cloud-agent
and should already be installed.</p>
<ol class="arabic">
<li><p class="first">In order to have live migration working libvirt has to listen for unsecured
TCP connections. We also need to turn off libvirts attempt to use Multicast
DNS advertising. Both of these settings are in /etc/libvirt/libvirtd.conf</p>
<p>Set the following paramaters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">listen_tls</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">listen_tcp</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">tcp_port</span> <span class="o">=</span> <span class="s2">&quot;16509&quot;</span>
<span class="n">auth_tcp</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
<span class="n">mdns_adv</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">Turning on “listen_tcp” in libvirtd.conf is not enough, we have to change
the parameters as well we also need to modify /etc/sysconfig/libvirtd:</p>
<p>Uncomment the following line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#LIBVIRTD_ARGS=&quot;--listen&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart libvirt</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># systemctl restart libvirtd</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="kvm-configuration-complete">
<h4>KVM configuration complete<a class="headerlink" href="qig.html#kvm-configuration-complete" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>For the sake of completeness you should check if KVM is running OK on your machine:</dt>
<dd><div class="first last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># lsmod | grep kvm</span>
<span class="n">kvm_intel</span>              <span class="mi">55496</span>  <span class="mi">0</span>
<span class="n">kvm</span>                   <span class="mi">337772</span>  <span class="mi">1</span> <span class="n">kvm_intel</span>
</pre></div>
</div>
</dd>
</dl>
<p>That concludes our installation and configuration of KVM, and we’ll now move
to using the CloudStack UI for the actual configuration of our cloud.</p>
</div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="qig.html#configuration" title="Permalink to this headline">¶</a></h2>
<p>As we noted before we will be using security groups to provide isolation and
by default that implies that we’ll be using a flat layer-2 network. It also
means that the simplicity of our setup means that we can use the quick
installer.</p>
<div class="section" id="ui-access">
<h3>UI Access<a class="headerlink" href="qig.html#ui-access" title="Permalink to this headline">¶</a></h3>
<p>To get access to CloudStack’s web interface, merely point your browser to
<a class="reference external" href="http://172.16.10.2:8080/client">http://172.16.10.2:8080/client</a> The default username is ‘admin’, and the
default password is ‘password’. You should see a splash screen that allows you
to choose several options for setting up CloudStack. You should choose the
Continue with Basic Setup option.</p>
<p>You should now see a prompt requiring you to change the password for the admin
user. Please do so.</p>
</div>
<div class="section" id="setting-up-a-zone">
<h3>Setting up a Zone<a class="headerlink" href="qig.html#setting-up-a-zone" title="Permalink to this headline">¶</a></h3>
<p>A zone is the largest organization entity in CloudStack - and we’ll be
creating one, this should be the screen that you see in front of you now. And
for us there are 5 pieces of information that we need.</p>
<ol class="arabic simple">
<li>Name - we will set this to the ever-descriptive ‘Zone1’ for our cloud.</li>
<li>Public DNS 1 - we will set this to <code class="docutils literal notranslate"><span class="pre">8.8.8.8</span></code> for our cloud.</li>
<li>Public DNS 2 - we will set this to <code class="docutils literal notranslate"><span class="pre">8.8.4.4</span></code> for our cloud.</li>
<li>Internal DNS1 - we will also set this to <code class="docutils literal notranslate"><span class="pre">8.8.8.8</span></code> for our cloud.</li>
<li>Internal DNS2 - we will also set this to <code class="docutils literal notranslate"><span class="pre">8.8.4.4</span></code> for our cloud.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">CloudStack distinguishes between internal and public DNS. Internal DNS is
assumed to be capable of resolving internal-only hostnames, such as your
NFS server’s DNS name. Public DNS is provided to the guest VMs to resolve
public IP addresses. You can enter the same DNS server for both types, but
if you do so, you must make sure that both internal and public IP addresses
can route to the DNS server. In our specific case we will not use any names
for resources internally, and we have indeed them set to look to the same
external resource so as to not add a namerserver setup to our list of
requirements.</p>
</div>
</div>
<div class="section" id="pod-configuration">
<h3>Pod Configuration<a class="headerlink" href="qig.html#pod-configuration" title="Permalink to this headline">¶</a></h3>
<p>Now that we’ve added a Zone, the next step that comes up is a prompt for
information regading a pod. Which is looking for several items.</p>
<ol class="arabic simple">
<li>Name - We’ll use <code class="docutils literal notranslate"><span class="pre">Pod1</span></code> for our cloud.</li>
<li>Gateway - We’ll use <code class="docutils literal notranslate"><span class="pre">172.16.10.1</span></code> as our gateway</li>
<li>Netmask - We’ll use <code class="docutils literal notranslate"><span class="pre">255.255.255.0</span></code></li>
<li>Start/end reserved system IPs - we will use <code class="docutils literal notranslate"><span class="pre">172.16.10.10-172.16.10.20</span></code></li>
<li>Guest gateway - We’ll use <code class="docutils literal notranslate"><span class="pre">172.16.10.1</span></code></li>
<li>Guest netmask - We’ll use <code class="docutils literal notranslate"><span class="pre">255.255.255.0</span></code></li>
<li>Guest start/end IP - We’ll use <code class="docutils literal notranslate"><span class="pre">172.16.10.30-172.16.10.200</span></code></li>
</ol>
</div>
<div class="section" id="cluster">
<h3>Cluster<a class="headerlink" href="qig.html#cluster" title="Permalink to this headline">¶</a></h3>
<p>Now that we’ve added a Zone, we need only add a few more items for configuring
the cluster.</p>
<ol class="arabic simple">
<li>Name - We’ll use <code class="docutils literal notranslate"><span class="pre">Cluster1</span></code></li>
<li>Hypervisor - Choose <code class="docutils literal notranslate"><span class="pre">KVM</span></code></li>
</ol>
<p>You should be prompted to add the first host to your cluster at this point.
Only a few bits of information are needed.</p>
<ol class="arabic simple">
<li>Hostname - we’ll use the IP address <code class="docutils literal notranslate"><span class="pre">172.16.10.2</span></code> since we didn’t set up a
DNS server.</li>
<li>Username - we’ll use <code class="docutils literal notranslate"><span class="pre">root</span></code></li>
<li>Password - enter the operating system password for the root user</li>
</ol>
<div class="section" id="primary-storage">
<h4>Primary Storage<a class="headerlink" href="qig.html#primary-storage" title="Permalink to this headline">¶</a></h4>
<p>With your cluster now setup - you should be prompted for primary storage
information. Choose NFS as the storage type and then enter the following
values in the fields:</p>
<ol class="arabic simple">
<li>Name - We’ll use <code class="docutils literal notranslate"><span class="pre">Primary1</span></code></li>
<li>Server - We’ll be using the IP address <code class="docutils literal notranslate"><span class="pre">172.16.10.2</span></code></li>
<li>Path - Well define <code class="docutils literal notranslate"><span class="pre">/export/primary</span></code> as the path we are using</li>
</ol>
</div>
<div class="section" id="secondary-storage">
<h4>Secondary Storage<a class="headerlink" href="qig.html#secondary-storage" title="Permalink to this headline">¶</a></h4>
<p>If this is a new zone, you’ll be prompted for secondary storage information -
populate it as follows:</p>
<ol class="arabic simple">
<li>NFS server - We’ll use the IP address <code class="docutils literal notranslate"><span class="pre">172.16.10.2</span></code></li>
<li>Path - We’ll use <code class="docutils literal notranslate"><span class="pre">/export/secondary</span></code></li>
</ol>
<p>Now, click Launch and your cloud should begin setup - it may take several
minutes depending on your internet connection speed for setup to finalize.</p>
<p>That’s it, you are done with installation of your Apache CloudStack cloud.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../installguide/index.html" class="btn btn-neutral float-right" title="Installation Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../conceptsandterminology/storage_setup.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Foundation
      
        <span class="commit">
          Revision <code>29a3d9e2</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 4.13.0.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="http://docs.cloudstack.apache.org/en/master/">master</a></dd>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../index.html">4.13.0.0</a></dd>
        
          <dd><a href="../../4.12.0.0/index.html">4.12.0.0</a></dd>
        
          <dd><a href="../../4.11.3.0/index.html">4.11.3.0</a></dd>
        
          <dd><a href="../../4.11.2.0/index.html">4.11.2.0</a></dd>
        
          <dd><a href="../../4.11.1.0/index.html">4.11.1.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/cloudstack-documentation/downloads/htmlzip/4.13.0.0/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/cloudstack-documentation/?fromdocs=cloudstack-documentation">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/cloudstack-documentation/?fromdocs=cloudstack-documentation">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>