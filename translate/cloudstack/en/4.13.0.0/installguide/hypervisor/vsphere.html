

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Host VMware vSphere Installation &mdash; Apache CloudStack 4.13.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Host Citrix XenServer Installation" href="xenserver.html" />
    <link rel="prev" title="Host LXC Installation" href="lxc.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="../../../latest/installguide/hypervisor/vsphere.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "installguide/hypervisor/vsphere"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Apache CloudStack
          

          
          </a>

          
            
            
            
              <div class="version">
                4.13.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../conceptsandterminology/index.html">CloudStack Concepts and Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickinstallationguide/qig.html">Quick Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Installation Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#building-from-source">Building from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#general-installation">General Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#configuration">Configuration</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#hypervisor-setup">Hypervisor Setup</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="hyperv.html">Host Hyper-V Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="kvm.html">Host KVM Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="lxc.html">Host LXC Installation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="vsphere.html#">Host VMware vSphere Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#system-requirements-for-vsphere-hosts">System Requirements for vSphere Hosts</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#preparation-checklist-for-vmware">Preparation Checklist for VMware</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#vsphere-installation-steps">vSphere Installation Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#esxi-host-setup">ESXi Host setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#physical-host-networking">Physical Host Networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#configuring-a-vsphere-cluster-with-nexus-1000v-virtual-switch">Configuring a vSphere Cluster with Nexus 1000v Virtual Switch</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#configuring-a-vmware-datacenter-with-vmware-distributed-virtual-switch">Configuring a VMware Datacenter with VMware Distributed Virtual Switch</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#storage-preparation-for-vsphere-iscsi-only">Storage Preparation for vSphere (iSCSI only)</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#add-hosts-or-configure-clusters-vsphere">Add Hosts or Configure Clusters (vSphere)</a></li>
<li class="toctree-l4"><a class="reference internal" href="vsphere.html#applying-hotfixes-to-a-vmware-vsphere-host">Applying Hotfixes to a VMware vSphere Host</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="xenserver.html">Host Citrix XenServer Installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#optional-installation">Optional Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrading/index.html">Upgrading CloudStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../adminguide/index.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developersguide/index.html">Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releasenotes/index.html">Release Notes</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Home">Apache CloudStack Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/">Apache CloudStack web site</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache CloudStack Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/cloudstack">Apache CloudStack on GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre 4.11 Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../../../../projects/cloudstack-installation">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../../projects/cloudstack-administration">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../../projects/cloudstack-release-notes">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache CloudStack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Installation Guide</a> &raquo;</li>
        
      <li>Host VMware vSphere Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/cloudstack-documentation/blob/4.13.0.0/source/installguide/hypervisor/vsphere.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="host-vmware-vsphere-installation">
<h1>Host VMware vSphere Installation<a class="headerlink" href="vsphere.html#host-vmware-vsphere-installation" title="Permalink to this headline">¶</a></h1>
<p>If you want to use the VMware vSphere hypervisor to run guest virtual
machines, install vSphere on the host(s) in your cloud.</p>
<div class="section" id="system-requirements-for-vsphere-hosts">
<h2>System Requirements for vSphere Hosts<a class="headerlink" href="vsphere.html#system-requirements-for-vsphere-hosts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="software-requirements">
<h3>Software requirements:<a class="headerlink" href="vsphere.html#software-requirements" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">vSphere and vCenter, versions 4.1, 5.0, 5.1 or 5.5.</p>
<p>vSphere Standard is recommended. Note however that customers need to
consider the CPU constraints in place with vSphere licensing. See
<a class="reference external" href="http://www.vmware.com/files/pdf/vsphere_pricing.pdf">http://www.vmware.com/files/pdf/vsphere_pricing.pdf</a>
and discuss with your VMware sales representative.</p>
<p>vCenter Server Standard is recommended.</p>
</li>
<li><p class="first">Be sure all the hotfixes provided by the hypervisor vendor are
applied. Track the release of hypervisor patches through your
hypervisor vendor’s support channel, and apply patches as soon as
possible after they are released. CloudStack will not track or notify
you of required hypervisor patches. It is essential that your hosts
are completely up to date with the provided hypervisor patches. The
hypervisor vendor is likely to refuse to support any system that is
not up to date with patches.</p>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Apply All Necessary Hotfixes. The lack of up-do-date hotfixes can lead to
data corruption and lost VMs.</p>
</div>
</div>
<div class="section" id="hardware-requirements">
<h3>Hardware requirements:<a class="headerlink" href="vsphere.html#hardware-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The host must be certified as compatible with vSphere. See the VMware
Hardware Compatibility Guide at
<a class="reference external" href="http://www.vmware.com/resources/compatibility/search.php">http://www.vmware.com/resources/compatibility/search.php</a>.</li>
<li>All hosts must be 64-bit and must support HVM (Intel-VT or AMD-V
enabled).</li>
<li>All hosts within a cluster must be homogenous. That means the CPUs
must be of the same type, count, and feature flags.</li>
<li>64-bit x86 CPU (more cores results in better performance)</li>
<li>Hardware virtualization support required</li>
<li>4 GB of memory</li>
<li>36 GB of local disk</li>
<li>At least 1 NIC</li>
<li>Statically allocated IP Address</li>
</ul>
</div>
<div class="section" id="vcenter-server-requirements">
<h3>vCenter Server requirements:<a class="headerlink" href="vsphere.html#vcenter-server-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Processor - 2 CPUs 2.0GHz or higher Intel or AMD x86 processors.
Processor requirements may be higher if the database runs on the same
machine.</li>
<li>Memory - 3GB RAM. RAM requirements may be higher if your database
runs on the same machine.</li>
<li>Disk storage - 2GB. Disk requirements may be higher if your database
runs on the same machine.</li>
<li>Microsoft SQL Server 2005 Express disk requirements. The bundled
database requires up to 2GB free disk space to decompress the
installation archive.</li>
<li>Networking - 1Gbit or 10Gbit.</li>
</ul>
<p>For more information, see <a class="reference external" href="http://pubs.vmware.com/vsp40/wwhelp/wwhimpl/js/html/wwhelp.htm#href=install/c_vc_hw.html">“vCenter Server and the vSphere Client Hardware
Requirements”</a>.</p>
</div>
<div class="section" id="other-requirements">
<h3>Other requirements:<a class="headerlink" href="vsphere.html#other-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>VMware vCenter Standard Edition 4.1, 5.0, 5.1 or 5.5 must be installed and
available to manage the vSphere hosts.</li>
<li>vCenter must be configured to use the standard port 443 so that it
can communicate with the CloudStack Management Server.</li>
<li>You must re-install VMware ESXi if you are going to re-use a host
from a previous install.</li>
<li>CloudStack requires VMware vSphere 4.1, 5.0, 5.1 or 5.5. VMware vSphere 4.0 is
not supported.</li>
<li>All hosts must be 64-bit and must support HVM (Intel-VT or AMD-V
enabled). All hosts within a cluster must be homogeneous. That means
the CPUs must be of the same type, count, and feature flags.</li>
<li>The CloudStack management network must not be configured as a
separate virtual network. The CloudStack management network is the
same as the vCenter management network, and will inherit its
configuration. See <a class="reference internal" href="vsphere.html#configure-vcenter-management-network"><span class="std std-ref">Configure vCenter Management Network</span></a>.</li>
<li>CloudStack requires ESXi and vCenter. ESX is not supported.</li>
<li>Ideally all resources used for CloudStack must be used for CloudStack only.
CloudStack should not share instance of ESXi or storage with other
management consoles. Do not share the same storage volumes that will
be used by CloudStack with a different set of ESXi servers that are
not managed by CloudStack.</li>
<li>Put all target ESXi hypervisors in dedicated clusters in a separate Datacenter
in vCenter.</li>
<li>Ideally clusters that will be managed by CloudStack should not contain
any other VMs. Do not run the management server or vCenter on
the cluster that is designated for CloudStack use. Create a separate
cluster for use of CloudStack and make sure that they are no VMs in
this cluster.</li>
<li>All of the required VLANs must be trunked into all network switches that
are connected to the ESXi hypervisor hosts. These would include the
VLANs for Management, Storage, vMotion, and guest VLANs. The guest
VLAN (used in Advanced Networking; see Network Setup) is a contiguous
range of VLANs that will be managed by CloudStack.</li>
</ul>
</div>
</div>
<div class="section" id="preparation-checklist-for-vmware">
<h2>Preparation Checklist for VMware<a class="headerlink" href="vsphere.html#preparation-checklist-for-vmware" title="Permalink to this headline">¶</a></h2>
<p>For a smoother installation, gather the following information before you
start:</p>
<ul class="simple">
<li>Information listed in <a class="reference internal" href="vsphere.html#vcenter-checklist"><span class="std std-ref">vCenter Checklist</span></a></li>
<li>Information listed in <a class="reference internal" href="vsphere.html#networking-checklist-for-vmware"><span class="std std-ref">Networking Checklist for VMware</span></a></li>
</ul>
<div class="section" id="vcenter-checklist">
<span id="id1"></span><h3>vCenter Checklist<a class="headerlink" href="vsphere.html#vcenter-checklist" title="Permalink to this headline">¶</a></h3>
<p>You will need the following information about vCenter.</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">vCenter Requirement</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vCenter User</td>
<td>This user must have admin privileges.</td>
</tr>
<tr class="row-odd"><td>vCenter User Password</td>
<td>Password for the above user.</td>
</tr>
<tr class="row-even"><td>vCenter Datacenter Name</td>
<td>Name of the datacenter.</td>
</tr>
<tr class="row-odd"><td>vCenter Cluster Name</td>
<td>Name of the cluster.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="networking-checklist-for-vmware">
<span id="id2"></span><h3>Networking Checklist for VMware<a class="headerlink" href="vsphere.html#networking-checklist-for-vmware" title="Permalink to this headline">¶</a></h3>
<p>You will need the following information about your VLANs.</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN Information</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ESXi VLAN</td>
<td>VLAN on which all your ESXi hypervisors reside.</td>
</tr>
<tr class="row-odd"><td>ESXI VLAN IP Address</td>
<td>IP Address Range in the ESXi VLAN. One address per Virtual Router is used from this range.</td>
</tr>
<tr class="row-even"><td>ESXi VLAN IP Gateway</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>ESXi VLAN Netmask</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Management Server VLAN</td>
<td>VLAN on which the CloudStack Management server is installed.</td>
</tr>
<tr class="row-odd"><td>Public VLAN</td>
<td>VLAN for the Public Network.</td>
</tr>
<tr class="row-even"><td>Public VLAN Gateway</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Public VLAN Netmask</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Public VLAN IP Address Range</td>
<td>Range of Public IP Addresses available for CloudStack use. These
addresses will be used for virtual router on CloudStack to route private
traffic to external networks.</td>
</tr>
<tr class="row-odd"><td>VLAN Range for Customer use</td>
<td>A contiguous range of non-routable VLANs. One VLAN will be assigned for
each customer.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="vsphere-installation-steps">
<h2>vSphere Installation Steps<a class="headerlink" href="vsphere.html#vsphere-installation-steps" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">If you haven’t already, you’ll need to download and purchase vSphere
from the VMware Website
(<a class="reference external" href="https://www.vmware.com/tryvmware/index.php?p=vmware-vsphere&amp;lp=1">https://www.vmware.com/tryvmware/index.php?p=vmware-vsphere&amp;lp=1</a>)
and install it by following the VMware vSphere Installation Guide.</p>
</li>
<li><p class="first">Following installation, perform the following configuration, which
are described in the next few sections:</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="84%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Required</th>
<th class="head">Optional</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ESXi host setup</td>
<td>NIC bonding</td>
</tr>
<tr class="row-odd"><td>Configure host physical networking,virtual switch, vCenter Management Network, and extended port range</td>
<td>Multipath storage</td>
</tr>
<tr class="row-even"><td>Prepare storage for iSCSI</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Configure clusters in vCenter and add hosts to them, or add hosts without clusters to vCenter</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
<div class="section" id="esxi-host-setup">
<h2>ESXi Host setup<a class="headerlink" href="vsphere.html#esxi-host-setup" title="Permalink to this headline">¶</a></h2>
<p>All ESXi hosts should have CPU hardware virtualization support enabled in
the BIOS. Please note hardware virtualization support is not enabled by
default on most servers.</p>
</div>
<div class="section" id="physical-host-networking">
<h2>Physical Host Networking<a class="headerlink" href="vsphere.html#physical-host-networking" title="Permalink to this headline">¶</a></h2>
<p>You should have a plan for cabling the vSphere hosts. Proper network
configuration is required before adding a vSphere host to CloudStack. To
configure an ESXi host, you can use vClient to add it as standalone host
to vCenter first. Once you see the host appearing in the vCenter
inventory tree, click the host node in the inventory tree, and navigate
to the Configuration tab.</p>
<p><img alt="vspherephysicalnetwork.png: vSphere client" src="../../_images/vmware-physical-network.png" /></p>
<p>In the host configuration tab, click the “Hardware/Networking” link to
bring up the networking configuration page as above.</p>
<div class="section" id="configure-virtual-switch">
<h3>Configure Virtual Switch<a class="headerlink" href="vsphere.html#configure-virtual-switch" title="Permalink to this headline">¶</a></h3>
<p>During the initial installation of an ESXi host a default virtual switch
vSwitch0 is created. You may need to create additional vSwiches depending
on your required architecture. CloudStack requires all ESXi hosts in the cloud
to use consistently named virtual switches. If
you change the default virtual switch name, you will need to configure
one or more CloudStack configuration variables as well.</p>
<div class="section" id="separating-traffic">
<h4>Separating Traffic<a class="headerlink" href="vsphere.html#separating-traffic" title="Permalink to this headline">¶</a></h4>
<p>CloudStack allows you to configure three separate networks per ESXi host.
CloudStack identifies these networks by the name of the vSwitch
they are connected to. The networks for configuration are public (for
traffic to/from the public internet), guest (for guest-guest traffic),
and private (for management and usually storage traffic). You can use
the default virtual switch for all three, or create one or two other
vSwitches for those traffic types.</p>
<p>If you want to separate traffic in this way you should first create and
configure vSwitches in vCenter according to the vCenter instructions.
Take note of the vSwitch names you have used for each traffic type. You
will configure CloudStack to use these vSwitches.</p>
</div>
<div class="section" id="increasing-ports">
<h4>Increasing Ports<a class="headerlink" href="vsphere.html#increasing-ports" title="Permalink to this headline">¶</a></h4>
<p>By default a virtual switch on ESXi hosts is created with 56 ports. We
recommend setting it to 4088, the maximum number of ports allowed. To do
that, click the “Properties…” link for virtual switch (note this is
not the Properties link for Networking).</p>
<p><img alt="vsphereincreaseports.png: vSphere client" src="../../_images/vmware-increase-ports.png" /></p>
<p>In vSwitch properties dialog, select the vSwitch and click Edit. You
should see the following dialog:</p>
<p><img alt="vspherevswitchproperties.png: vSphere client" src="../../_images/vmware-vswitch-properties.png" /></p>
<p>In this dialog, you can change the number of switch ports. After you’ve
done that, ESXi hosts are required to reboot in order for the setting to
take effect.</p>
</div>
</div>
<div class="section" id="configure-vcenter-management-network">
<span id="id3"></span><h3>Configure vCenter Management Network<a class="headerlink" href="vsphere.html#configure-vcenter-management-network" title="Permalink to this headline">¶</a></h3>
<p>In the vSwitch properties dialog box, you may see a vCenter management
network. This same network will also be used as the CloudStack
management network. CloudStack requires the vCenter management network
to be configured properly. Select the management network item in the
dialog, then click Edit.</p>
<p><img alt="vspheremgtnetwork.png: vSphere client" src="../../_images/vmware-mgt-network-properties.png" /></p>
<p>Make sure the following values are set:</p>
<ul class="simple">
<li>VLAN ID set to the desired ID</li>
<li>vMotion enabled.</li>
<li>Management traffic enabled.</li>
</ul>
<p>If the ESXi hosts have multiple VMKernel ports, and ESXi is not using
the default value “Management Network” as the management network name,
you must follow these guidelines to configure the management network
port group so that CloudStack can find it:</p>
<ul class="simple">
<li>Use one label for the management network port across all ESXi hosts.</li>
<li>In the CloudStack UI, go to Configuration - Global Settings and set
vmware.management.portgroup to the management network label from the
ESXi hosts.</li>
</ul>
</div>
<div class="section" id="extend-port-range-for-cloudstack-console-proxy">
<h3>Extend Port Range for CloudStack Console Proxy<a class="headerlink" href="vsphere.html#extend-port-range-for-cloudstack-console-proxy" title="Permalink to this headline">¶</a></h3>
<p>(Applies only to VMware vSphere version 4.x)</p>
<p>You need to extend the range of firewall ports that the console proxy
works with on the hosts. This is to enable the console proxy to work
with VMware-based VMs. The default additional port range is 59000-60000.
To extend the port range, log in to the VMware ESX service console on
each host and run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esxcfg</span><span class="o">-</span><span class="n">firewall</span> <span class="o">-</span><span class="n">o</span> <span class="mi">59000</span><span class="o">-</span><span class="mi">60000</span><span class="p">,</span><span class="n">tcp</span><span class="p">,</span><span class="ow">in</span><span class="p">,</span><span class="n">vncextras</span>
<span class="n">esxcfg</span><span class="o">-</span><span class="n">firewall</span> <span class="o">-</span><span class="n">o</span> <span class="mi">59000</span><span class="o">-</span><span class="mi">60000</span><span class="p">,</span><span class="n">tcp</span><span class="p">,</span><span class="n">out</span><span class="p">,</span><span class="n">vncextras</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-nic-bonding-for-vsphere">
<h3>Configure NIC Bonding for vSphere<a class="headerlink" href="vsphere.html#configure-nic-bonding-for-vsphere" title="Permalink to this headline">¶</a></h3>
<p>NIC bonding on vSphere hosts may be done according to the vSphere
installation guide.</p>
</div>
</div>
<div class="section" id="configuring-a-vsphere-cluster-with-nexus-1000v-virtual-switch">
<span id="id4"></span><h2>Configuring a vSphere Cluster with Nexus 1000v Virtual Switch<a class="headerlink" href="vsphere.html#configuring-a-vsphere-cluster-with-nexus-1000v-virtual-switch" title="Permalink to this headline">¶</a></h2>
<p>CloudStack supports Cisco Nexus 1000v dvSwitch (Distributed Virtual
Switch) for virtual network configuration in a VMware vSphere
environment. This section helps you configure a vSphere cluster with
Nexus 1000v virtual switch in a VMware vCenter environment. For
information on creating a vSphere cluster, see
<a class="reference external" href="vsphere.html#vmware-vsphere-installation-and-configuration">“VMware vSphere Installation and Configuration”</a></p>
<div class="section" id="about-cisco-nexus-1000v-distributed-virtual-switch">
<h3>About Cisco Nexus 1000v Distributed Virtual Switch<a class="headerlink" href="vsphere.html#about-cisco-nexus-1000v-distributed-virtual-switch" title="Permalink to this headline">¶</a></h3>
<p>The Cisco Nexus 1000V virtual switch is a software-based virtual machine
access switch for VMware vSphere environments. It can span multiple
hosts running VMware ESXi 4.0 and later. A Nexus virtual switch consists
of two components: the Virtual Supervisor Module (VSM) and the Virtual
Ethernet Module (VEM). The VSM is a virtual appliance that acts as the
switch’s supervisor. It controls multiple VEMs as a single network
device. The VSM is installed independent of the VEM and is deployed in
redundancy mode as pairs or as a standalone appliance. The VEM is
installed on each VMware ESXi server to provide packet-forwarding
capability. It provides each virtual machine with dedicated switch
ports. This VSM-VEM architecture is analogous to a physical Cisco
switch’s supervisor (standalone or configured in high-availability mode)
and multiple linecards architecture.</p>
<p>Nexus 1000v switch uses vEthernet port profiles to simplify network
provisioning for virtual machines. There are two types of port profiles:
Ethernet port profile and vEthernet port profile. The Ethernet port
profile is applied to the physical uplink ports-the NIC ports of the
physical NIC adapter on an ESXi server. The vEthernet port profile is
associated with the virtual NIC (vNIC) that is plumbed on a guest VM on
the ESXi server. The port profiles help the network administrators
define network policies which can be reused for new virtual machines.
The Ethernet port profiles are created on the VSM and are represented as
port groups on the vCenter server.</p>
</div>
<div class="section" id="prerequisites-and-guidelines">
<h3>Prerequisites and Guidelines<a class="headerlink" href="vsphere.html#prerequisites-and-guidelines" title="Permalink to this headline">¶</a></h3>
<p>This section discusses prerequisites and guidelines for using Nexus
virtual switch in CloudStack. Before configuring Nexus virtual switch,
ensure that your system meets the following requirements:</p>
<ul class="simple">
<li>A cluster of servers (ESXi 4.1 or later) is configured in the
vCenter.</li>
<li>Each cluster managed by CloudStack is the only cluster in its vCenter
datacenter.</li>
<li>A Cisco Nexus 1000v virtual switch is installed to serve the
datacenter that contains the vCenter cluster. This ensures that
CloudStack doesn’t have to deal with dynamic migration of virtual
adapters or networks across other existing virtual switches. See
<a class="reference external" href="http://www.cisco.com/en/US/docs/switches/datacenter/nexus1000/sw/4_2_1_s_v_1_5_1/install_upgrade/vsm_vem/guide/n1000v_installupgrade.html">Cisco Nexus 1000V Installation and Upgrade Guide</a>
for guidelines on how to install the Nexus 1000v VSM and VEM modules.</li>
<li>The Nexus 1000v VSM is not deployed on a vSphere host that is managed
by CloudStack.</li>
<li>When the maximum number of VEM modules per VSM instance is reached,
an additional VSM instance is created before introducing any more
ESXi hosts. The limit is 64 VEM modules for each VSM instance.</li>
<li>CloudStack expects that the Management Network of the ESXi host is
configured on the standard vSwitch and searches for it in the
standard vSwitch. Therefore, ensure that you do not migrate the
management network to Nexus 1000v virtual switch during
configuration.</li>
<li>All information given in <a class="reference internal" href="vsphere.html#nexus-vswift-preconf"><span class="std std-ref">Nexus 1000v Virtual Switch Preconfiguration</span></a></li>
</ul>
</div>
<div class="section" id="nexus-1000v-virtual-switch-preconfiguration">
<span id="nexus-vswift-preconf"></span><h3>Nexus 1000v Virtual Switch Preconfiguration<a class="headerlink" href="vsphere.html#nexus-1000v-virtual-switch-preconfiguration" title="Permalink to this headline">¶</a></h3>
<div class="section" id="preparation-checklist">
<h4>Preparation Checklist<a class="headerlink" href="vsphere.html#preparation-checklist" title="Permalink to this headline">¶</a></h4>
<p>For a smoother configuration of Nexus 1000v switch, gather the following
information before you start:</p>
<ul class="simple">
<li>vCenter credentials</li>
<li>Nexus 1000v VSM IP address</li>
<li>Nexus 1000v VSM Credentials</li>
<li>Ethernet port profile names</li>
</ul>
</div>
<div class="section" id="vcenter-credentials-checklist">
<h4>vCenter Credentials Checklist<a class="headerlink" href="vsphere.html#vcenter-credentials-checklist" title="Permalink to this headline">¶</a></h4>
<p>You will need the following information about vCenter:</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="25%" />
<col width="8%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Nexus vSwitch Requirements</th>
<th class="head">Value</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vCenter IP</td>
<td>&#160;</td>
<td>The IP address of the vCenter.</td>
</tr>
<tr class="row-odd"><td>Secure HTTP Port Number</td>
<td>443</td>
<td>Port 443 is configured by default; however, you can change the port if needed.</td>
</tr>
<tr class="row-even"><td>vCenter User ID</td>
<td>&#160;</td>
<td>The vCenter user with administrator-level privileges. The vCenter User ID is
required when you configure the virtual switch in CloudStack.</td>
</tr>
<tr class="row-odd"><td>vCenter Password</td>
<td>&#160;</td>
<td>The password for the vCenter user specified above. The password for this
vCenter user is required when you configure the switch in CloudStack.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="network-configuration-checklist">
<h4>Network Configuration Checklist<a class="headerlink" href="vsphere.html#network-configuration-checklist" title="Permalink to this headline">¶</a></h4>
<p>The following information specified in the Nexus Configure Networking
screen is displayed in the Details tab of the Nexus dvSwitch in the
CloudStack UI:</p>
<p><strong>Control Port Group VLAN ID</strong>
The VLAN ID of the Control Port Group. The control VLAN is used for
communication between the VSM and the VEMs.</p>
<p><strong>Management Port Group VLAN ID</strong>
The VLAN ID of the Management Port Group. The management VLAN corresponds to
the mgmt0 interface that is used to establish and maintain the connection
between the VSM and VMware vCenter Server.</p>
<p><strong>Packet Port Group VLAN ID</strong>
The VLAN ID of the Packet Port Group. The packet VLAN forwards relevant data
packets from the VEMs to the VSM.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The VLANs used for control, packet, and management port groups can be the
same.</p>
</div>
<p>For more information, see <a class="reference external" href="http://www.cisco.com/en/US/docs/switches/datacenter/nexus1000/sw/4_2_1_s_v_1_4_b/getting_started/configuration/guide/n1000v_gsg.pdf">Cisco Nexus 1000V Getting Started Guide</a>.</p>
</div>
<div class="section" id="vsm-configuration-checklist">
<h4>VSM Configuration Checklist<a class="headerlink" href="vsphere.html#vsm-configuration-checklist" title="Permalink to this headline">¶</a></h4>
<p>You will need the following VSM configuration parameters:</p>
<p><strong>Admin Name and Password</strong>
The admin name and password to connect to the VSM appliance. You must specify
these credentials while configuring Nexus virtual switch.</p>
<p><strong>Management IP Address</strong>
This is the IP address of the VSM appliance. This is the IP address you
specify in the virtual switch IP Address field while configuting Nexus virtual
switch.</p>
<p><strong>SSL</strong>
Should be set to Enable.Always enable SSL. SSH is usually enabled by default
during the VSM installation. However, check whether the SSH connection to the
VSM is working, without which CloudStack failes to connect to the VSM.</p>
</div>
<div class="section" id="creating-a-port-profile">
<h4>Creating a Port Profile<a class="headerlink" href="vsphere.html#creating-a-port-profile" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Whether you create a Basic or Advanced zone configuration, ensure
that you always create an Ethernet port profile on the VSM after you
install it and before you create the zone.<ul>
<li>The Ethernet port profile created to represent the physical
network or networks used by an Advanced zone configuration trunk
all the VLANs including guest VLANs, the VLANs that serve the
native VLAN, and the packet/control/data/management VLANs of the
VSM.</li>
<li>The Ethernet port profile created for a Basic zone configuration
does not trunk the guest VLANs because the guest VMs do not get
their own VLANs provisioned on their network interfaces in a Basic
zone.</li>
</ul>
</li>
<li>An Ethernet port profile configured on the Nexus 1000v virtual switch
should not use in its set of system VLANs, or any of the VLANs
configured or intended to be configured for use towards VMs or VM
resources in the CloudStack environment.</li>
<li>You do not have to create any vEthernet port profiles – CloudStack
does that during VM deployment.</li>
<li>Ensure that you create required port profiles to be used by
CloudStack for different traffic types of CloudStack, such as
Management traffic, Guest traffic, Storage traffic, and Public
traffic. The physical networks configured during zone creation should
have a one-to-one relation with the Ethernet port profiles.</li>
</ul>
<p><img alt="vmwarenexusportprofile.png: vSphere client" src="../../_images/vmware-nexus-port-profile.png" /></p>
<p>For information on creating a port profile, see <a class="reference external" href="http://www.cisco.com/en/US/docs/switches/datacenter/nexus1000/sw/4_2_1_s_v_1_4_a/port_profile/configuration/guide/n1000v_port_profile.html">Cisco Nexus 1000V Port
Profile Configuration Guide</a>.</p>
</div>
<div class="section" id="assigning-physical-nic-adapters">
<h4>Assigning Physical NIC Adapters<a class="headerlink" href="vsphere.html#assigning-physical-nic-adapters" title="Permalink to this headline">¶</a></h4>
<p>Assign ESXi host’s physical NIC adapters, which correspond to each
physical network, to the port profiles. In each ESXi host that is part
of the vCenter cluster, observe the physical networks assigned to each
port profile and note down the names of the port profile for future use.
This mapping information helps you when configuring physical networks
during the zone configuration on CloudStack. These Ethernet port profile
names are later specified as VMware Traffic Labels for different traffic
types when configuring physical networks during the zone configuration.
For more information on configuring physical networks, see
<a class="reference internal" href="vsphere.html#configuring-a-vsphere-cluster-with-nexus-1000v-virtual-switch"><span class="std std-ref">Configuring a vSphere Cluster with Nexus 1000v Virtual Switch</span></a>.</p>
</div>
<div class="section" id="adding-vlan-ranges">
<h4>Adding VLAN Ranges<a class="headerlink" href="vsphere.html#adding-vlan-ranges" title="Permalink to this headline">¶</a></h4>
<p>Determine the public VLAN, System VLAN, and Guest VLANs to be used by
the CloudStack. Ensure that you add them to the port profile database.
Corresponding to each physical network, add the VLAN range to port
profiles. In the VSM command prompt, run the switchport trunk allowed
vlan&lt;range&gt; command to add the VLAN ranges to the port profile.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">switchport</span> <span class="n">trunk</span> <span class="n">allowed</span> <span class="n">vlan</span> <span class="mi">1</span><span class="p">,</span><span class="mi">140</span><span class="o">-</span><span class="mi">147</span><span class="p">,</span><span class="mi">196</span><span class="o">-</span><span class="mi">203</span>
</pre></div>
</div>
<p>In this example, the allowed VLANs added are 1, 140-147, and 196-203</p>
<p>You must also add all the public and private VLANs or VLAN ranges to the
switch. This range is the VLAN range you specify in your zone.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before you run the vlan command, ensure that the configuration mode is
enabled in Nexus 1000v virtual switch.</p>
</div>
<p>For example:</p>
<p>If you want the VLAN 200 to be used on the switch, run the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vlan</span> <span class="mi">200</span>
</pre></div>
</div>
<p>If you want the VLAN range 1350-1750 to be used on the switch, run the
following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vlan</span> <span class="mi">1350</span><span class="o">-</span><span class="mi">1750</span>
</pre></div>
</div>
<p>Refer to Cisco Nexus 1000V Command Reference of specific product
version.</p>
</div>
</div>
<div class="section" id="enabling-nexus-virtual-switch-in-cloudstack">
<h3>Enabling Nexus Virtual Switch in CloudStack<a class="headerlink" href="vsphere.html#enabling-nexus-virtual-switch-in-cloudstack" title="Permalink to this headline">¶</a></h3>
<p>To make a CloudStack deployment Nexus enabled, you must set the
vmware.use.nexus.vswitch parameter true by using the Global Settings
page in the CloudStack UI. Unless this parameter is set to “true” and
restart the management server, you cannot see any UI options specific to
Nexus virtual switch, and CloudStack ignores the Nexus virtual switch
specific parameters specified in the AddTrafficTypeCmd,
UpdateTrafficTypeCmd, and AddClusterCmd API calls.</p>
<p>Unless the CloudStack global parameter “vmware.use.nexus.vswitch” is set
to “true”, CloudStack by default uses VMware standard vSwitch for
virtual network infrastructure. In this release, CloudStack doesn’t
support configuring virtual networks in a deployment with a mix of
standard vSwitch and Nexus 1000v virtual switch. The deployment can have
either standard vSwitch or Nexus 1000v virtual switch.</p>
</div>
<div class="section" id="configuring-nexus-1000v-virtual-switch-in-cloudstack">
<h3>Configuring Nexus 1000v Virtual Switch in CloudStack<a class="headerlink" href="vsphere.html#configuring-nexus-1000v-virtual-switch-in-cloudstack" title="Permalink to this headline">¶</a></h3>
<p>You can configure Nexus dvSwitch by adding the necessary resources while
the zone is being created.</p>
<p><img alt="vmwarenexusaddcluster.png: vmware nexus add cluster" src="../../_images/vmware-nexus-add-cluster.png" /></p>
<p>After the zone is created, if you want to create an additional cluster
along with Nexus 1000v virtual switch in the existing zone, use the Add
Cluster option. For information on creating a cluster, see
<a class="reference external" href="http://docs.cloudstack.apache.org/en/4.13.0.0/installguide/hypervisor/configuration.html#add-cluster-vsphere">“Add Cluster: vSphere”</a>.</p>
<p>In both these cases, you must specify the following parameters to
configure Nexus virtual switch:</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameters</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Cluster Name</td>
<td>Enter the name of the cluster you created in vCenter. For example,”cloud.cluster”.</td>
</tr>
<tr class="row-odd"><td>vCenter Host</td>
<td>Enter the host name or the IP address of the vCenter host where you have deployed the Nexus virtual switch.</td>
</tr>
<tr class="row-even"><td>vCenter User name</td>
<td>Enter the username that CloudStack should use to connect to vCenter. This user must have all administrative privileges.</td>
</tr>
<tr class="row-odd"><td>vCenter Password</td>
<td>Enter the password for the user named above.</td>
</tr>
<tr class="row-even"><td>vCenter Datacenter</td>
<td>Enter the vCenter datacenter that the cluster is in. For example, “cloud.dc.VM”.</td>
</tr>
<tr class="row-odd"><td>Nexus dvSwitch IP Address</td>
<td>The IP address of the VSM component of the Nexus 1000v virtual switch.</td>
</tr>
<tr class="row-even"><td>Nexus dvSwitch Username</td>
<td>The admin name to connect to the VSM appliance.</td>
</tr>
<tr class="row-odd"><td>Nexus dvSwitch Password</td>
<td>The corresponding password for the admin user specified above.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="removing-nexus-virtual-switch">
<h3>Removing Nexus Virtual Switch<a class="headerlink" href="vsphere.html#removing-nexus-virtual-switch" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">In the vCenter datacenter that is served by the Nexus virtual switch,
ensure that you delete all the hosts in the corresponding cluster.</p>
</li>
<li><p class="first">Log in with Admin permissions to the CloudStack administrator UI.</p>
</li>
<li><p class="first">In the left navigation bar, select Infrastructure.</p>
</li>
<li><p class="first">In the Infrastructure page, click View all under Clusters.</p>
</li>
<li><p class="first">Select the cluster where you want to remove the virtual switch.</p>
</li>
<li><p class="first">In the dvSwitch tab, click the name of the virtual switch.</p>
</li>
<li><p class="first">In the Details page, click Delete Nexus dvSwitch icon.
<img alt="DeleteButton.png: button to delete dvSwitch" src="../../_images/delete-button.png" /></p>
<p>Click Yes in the confirmation dialog box.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="configuring-a-vmware-datacenter-with-vmware-distributed-virtual-switch">
<h2>Configuring a VMware Datacenter with VMware Distributed Virtual Switch<a class="headerlink" href="vsphere.html#configuring-a-vmware-datacenter-with-vmware-distributed-virtual-switch" title="Permalink to this headline">¶</a></h2>
<p>CloudStack supports VMware vNetwork Distributed Switch (VDS) for virtual
network configuration in a VMware vSphere environment. This section
helps you configure VMware VDS in a CloudStack deployment. Each vCenter
server instance can support up to 128 VDS instances and each VDS
instance can manage up to 500 VMware hosts.</p>
<div class="section" id="about-vmware-distributed-virtual-switch">
<h3>About VMware Distributed Virtual Switch<a class="headerlink" href="vsphere.html#about-vmware-distributed-virtual-switch" title="Permalink to this headline">¶</a></h3>
<p>VMware VDS is an aggregation of host-level virtual switches on a VMware
vCenter server. VDS abstracts the configuration of individual virtual
switches that span across a large number of hosts, and enables
centralized provisioning, administration, and monitoring for your entire
datacenter from a centralized interface. In effect, a VDS acts as a
single virtual switch at the datacenter level and manages networking for
a number of hosts in a datacenter from a centralized VMware vCenter
server. Each VDS maintains network runtime state for VMs as they move
across multiple hosts, enabling inline monitoring and centralized
firewall services. A VDS can be deployed with or without Virtual
Standard Switch and a Nexus 1000V virtual switch.</p>
</div>
<div class="section" id="id5">
<h3>Prerequisites and Guidelines<a class="headerlink" href="vsphere.html#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>VMware VDS is supported only on Public and Guest traffic in
CloudStack.</li>
<li>VMware VDS does not support multiple VDS per traffic type. If a user
has many VDS switches, only one can be used for Guest traffic and
another one for Public traffic.</li>
<li>Additional switches of any type can be added for each cluster in the
same zone. While adding the clusters with different switch type,
traffic labels is overridden at the cluster level.</li>
<li>Management and Storage network does not support VDS. Therefore, use
Standard Switch for these networks.</li>
<li>When you remove a guest network, the corresponding dvportgroup will
not be removed on the vCenter. You must manually delete them on the
vCenter.</li>
</ul>
</div>
<div class="section" id="id6">
<h3>Preparation Checklist<a class="headerlink" href="vsphere.html#id6" title="Permalink to this headline">¶</a></h3>
<p>For a smoother configuration of VMware VDS, note down the VDS name you
have added in the datacenter before you start:</p>
<p><img alt="vds-name.png: Name of the dvSwitch as specified in the vCenter." src="../../_images/vds-name.png" /></p>
<p>Use this VDS name in the following:</p>
<ul>
<li><p class="first">The switch name in the Edit traffic label dialog while configuring a
public and guest traffic during zone creation.</p>
<p>During a zone creation, ensure that you select VMware vNetwork
Distributed Virtual Switch when you configure guest and public
traffic type.</p>
<p><img alt="traffic-type.png" src="../../_images/traffic-type.png" /></p>
</li>
<li><p class="first">The Public Traffic vSwitch Type field when you add a VMware
VDS-enabled cluster.</p>
</li>
<li><p class="first">The switch name in the traffic label while updating the switch type
in a zone.</p>
</li>
</ul>
<p>Traffic label format in the last case is
[[“Name of vSwitch/dvSwitch/EthernetPortProfile”][,”VLAN ID”[,”vSwitch Type”]]]</p>
<p>The possible values for traffic labels are:</p>
<ul class="simple">
<li>empty string</li>
<li>dvSwitch0</li>
<li>dvSwitch0,200</li>
<li>dvSwitch1,300,vmwaredvs</li>
<li>myEthernetPortProfile,,nexusdvs</li>
<li>dvSwitch0,,vmwaredvs</li>
</ul>
<p>The three fields to fill in are:</p>
<ul>
<li><p class="first">Name of the virtual / distributed virtual switch at vCenter.</p>
<p>The default value depends on the type of virtual switch:</p>
<p><strong>vSwitch0</strong>: If type of virtual switch is VMware vNetwork Standard virtual
switch</p>
<p><strong>dvSwitch0</strong>: If type of virtual switch is VMware vNetwork Distributed
virtual switch</p>
<p><strong>epp0</strong>: If type of virtual switch is Cisco Nexus 1000v Distributed
virtual switch</p>
</li>
<li><p class="first">VLAN ID to be used for this traffic wherever applicable.</p>
<p>This field would be used for only public traffic as of now. In case of
guest traffic this field would be ignored and could be left empty for guest
traffic. By default empty string would be assumed which translates to
untagged VLAN for that specific traffic type.</p>
</li>
<li><p class="first">Type of virtual switch. Specified as string.</p>
<p>Possible valid values are vmwaredvs, vmwaresvs, nexusdvs.</p>
<p><strong>vmwaresvs</strong>: Represents VMware vNetwork Standard virtual switch</p>
<p><strong>vmwaredvs</strong>: Represents VMware vNetwork distributed virtual switch</p>
<p><strong>nexusdvs</strong>: Represents Cisco Nexus 1000v distributed virtual switch.</p>
<p>If nothing specified (left empty), zone-level default virtual switchwould
be defaulted, based on the value of global parameter you specify.</p>
<p>Following are the global configuration parameters:</p>
<p><strong>vmware.use.dvswitch</strong>: Set to true to enable any kind (VMware DVS and
Cisco Nexus 1000v) of distributed virtual switch in a CloudStack
deployment. If set to false, the virtual switch that can be used in that
CloudStack deployment is Standard virtual switch.</p>
<p><strong>vmware.use.nexus.vswitch</strong>: This parameter is ignored if
vmware.use.dvswitch is set to false. Set to true to enable Cisco Nexus
1000v distributed virtual switch in a CloudStack deployment.</p>
</li>
</ul>
</div>
<div class="section" id="enabling-virtual-distributed-switch-in-cloudstack">
<h3>Enabling Virtual Distributed Switch in CloudStack<a class="headerlink" href="vsphere.html#enabling-virtual-distributed-switch-in-cloudstack" title="Permalink to this headline">¶</a></h3>
<p>To make a CloudStack deployment VDS enabled, set the vmware.use.dvswitch
parameter to true by using the Global Settings page in the CloudStack UI
and restart the Management Server. Unless you enable the
vmware.use.dvswitch parameter, you cannot see any UI options specific to
VDS, and CloudStack ignores the VDS-specific parameters that you
specify. Additionally, CloudStack uses VDS for virtual network
infrastructure if the value of vmware.use.dvswitch parameter is true and
the value of vmware.use.nexus.dvswitch parameter is false. Another
global parameter that defines VDS configuration is
vmware.ports.per.dvportgroup. This is the default number of ports per
VMware dvPortGroup in a VMware environment. Default value is 256. This
number directly associated with the number of guest network you can
create.</p>
<p>CloudStack supports orchestration of virtual networks in a deployment
with a mix of Virtual Distributed Switch, Standard Virtual Switch and
Nexus 1000v Virtual Switch.</p>
</div>
<div class="section" id="configuring-distributed-virtual-switch-in-cloudstack">
<h3>Configuring Distributed Virtual Switch in CloudStack<a class="headerlink" href="vsphere.html#configuring-distributed-virtual-switch-in-cloudstack" title="Permalink to this headline">¶</a></h3>
<p>You can configure VDS by adding the necessary resources while a zone is
created.</p>
<p>Alternatively, at the cluster level, you can create an additional
cluster with VDS enabled in the existing zone. Use the Add Cluster
option. For information as given in <a class="reference external" href="http://docs.cloudstack.apache.org/en/4.13.0.0/installguide/hypervisor/configuration.html#add-cluster-vsphere">“Add Cluster: vSphere”</a>.</p>
<p>In both these cases, you must specify the following parameters to
configure VDS:</p>
<p><img alt="dvSwitchConfig.png: Configuring dvSwitch" src="../../_images/dvswitchconfig.png" /></p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameters Description</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Cluster Name</td>
<td>Enter the name of the cluster you created in vCenter. For example, “cloudcluster”.</td>
</tr>
<tr class="row-odd"><td>vCenter Host</td>
<td>Enter the name or the IP address of the vCenter host where you have deployed the VMware VDS.</td>
</tr>
<tr class="row-even"><td>vCenter User name</td>
<td>Enter the username that CloudStack should use to connect to vCenter. This user must have all administrative privileges.</td>
</tr>
<tr class="row-odd"><td>vCenter Password</td>
<td>Enter the password for the user named above.</td>
</tr>
<tr class="row-even"><td>vCenter Datacenter</td>
<td>Enter the vCenter datacenter that the cluster is in. For example, “clouddcVM”.</td>
</tr>
<tr class="row-odd"><td>Override Public Traffic</td>
<td>Enable this option to override the zone-wide public traffic for the cluster you are creating.</td>
</tr>
<tr class="row-even"><td>Public Traffic vSwitch Type</td>
<td>This option is displayed only if you enable the Override Public Traffic option. Select VMware vNetwork Distributed Virtual Switch. If the vmware.use.dvswitch global parameter is true, the default option will be VMware vNetwork Distributed Virtual Switch.</td>
</tr>
<tr class="row-odd"><td>Public Traffic vSwitch Name</td>
<td>Name of virtual switch to be used for the public traffic.</td>
</tr>
<tr class="row-even"><td>Override Guest Traffic</td>
<td>Enable the option to override the zone-wide guest traffic for the cluster you are creating.</td>
</tr>
<tr class="row-odd"><td>Guest Traffic vSwitch Type</td>
<td>This option is displayed only if you enable the Override Guest Traffic option. Select VMware vNetwork Distributed Virtual Switch. If the vmware.use.dvswitch global parameter is true, the default option will be VMware vNetwork Distributed Virtual Switch.</td>
</tr>
<tr class="row-even"><td>Guest Traffic vSwitch Name</td>
<td>Name of virtual switch to be used for guest traffic.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="storage-preparation-for-vsphere-iscsi-only">
<h2>Storage Preparation for vSphere (iSCSI only)<a class="headerlink" href="vsphere.html#storage-preparation-for-vsphere-iscsi-only" title="Permalink to this headline">¶</a></h2>
<p>Use of iSCSI requires preparatory work in vCenter. You must add an iSCSI
target and create an iSCSI datastore.</p>
<p>If you are using NFS, skip this section.</p>
<div class="section" id="enable-iscsi-initiator-for-esxi-hosts">
<h3>Enable iSCSI initiator for ESXi hosts<a class="headerlink" href="vsphere.html#enable-iscsi-initiator-for-esxi-hosts" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">In vCenter, go to hosts and Clusters/Configuration, and click Storage
Adapters link. You will see:</p>
<p><img alt="vmwareiscsiinitiator.png: iscsi initiator" src="../../_images/vmware-iscsi-initiator.png" /></p>
</li>
<li><p class="first">Select iSCSI software adapter and click Properties.</p>
<p><img alt="vmwareiscsiinitiatorproperties.png: iscsi initiator properties" src="../../_images/vmware-iscsi-initiator-properties.png" /></p>
</li>
<li><p class="first">Click the Configure… button.</p>
<p><img alt="vmwareiscsigeneral.png: iscsi general" src="../../_images/vmware-iscsi-general.png" /></p>
</li>
<li><p class="first">Check Enabled to enable the initiator.</p>
</li>
<li><p class="first">Click OK to save.</p>
</li>
</ol>
</div>
<div class="section" id="add-iscsi-target">
<h3>Add iSCSI target<a class="headerlink" href="vsphere.html#add-iscsi-target" title="Permalink to this headline">¶</a></h3>
<p>Under the properties dialog, add the iSCSI target info:</p>
<p><img alt="vmwareiscsitargetadd.png: iscsi target add" src="../../_images/vmware-iscsi-target-add.png" /></p>
<p>Repeat these steps for all ESXi hosts in the cluster.</p>
</div>
<div class="section" id="create-an-iscsi-datastore">
<h3>Create an iSCSI datastore<a class="headerlink" href="vsphere.html#create-an-iscsi-datastore" title="Permalink to this headline">¶</a></h3>
<p>You should now create a VMFS datastore. Follow these steps to do so:</p>
<ol class="arabic simple">
<li>Select Home/Inventory/Datastores.</li>
<li>Right click on the datacenter node.</li>
<li>Choose Add Datastore… command.</li>
<li>Follow the wizard to create a iSCSI datastore.</li>
</ol>
<p>This procedure should be done on one host in the cluster. It is not
necessary to do this on all hosts.</p>
<p><img alt="vmwareiscsidatastore.png: iscsi datastore" src="../../_images/vmware-iscsi-datastore.png" /></p>
</div>
<div class="section" id="multipathing-for-vsphere-optional">
<h3>Multipathing for vSphere (Optional)<a class="headerlink" href="vsphere.html#multipathing-for-vsphere-optional" title="Permalink to this headline">¶</a></h3>
<p>Storage multipathing on vSphere nodes may be done according to the
vSphere installation guide.</p>
</div>
</div>
<div class="section" id="add-hosts-or-configure-clusters-vsphere">
<h2>Add Hosts or Configure Clusters (vSphere)<a class="headerlink" href="vsphere.html#add-hosts-or-configure-clusters-vsphere" title="Permalink to this headline">¶</a></h2>
<p>Use vCenter to create a vCenter cluster and add your desired hosts to
the cluster. You will later add the entire cluster to CloudStack. (see
<a class="reference external" href="http://docs.cloudstack.apache.org/en/4.13.0.0/installguide/hypervisor/configuration.html#add-cluster-vsphere">“Add Cluster: vSphere”</a>).</p>
</div>
<div class="section" id="applying-hotfixes-to-a-vmware-vsphere-host">
<h2>Applying Hotfixes to a VMware vSphere Host<a class="headerlink" href="vsphere.html#applying-hotfixes-to-a-vmware-vsphere-host" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Disconnect the VMware vSphere cluster from CloudStack. It should
remain disconnected long enough to apply the hotfix on the host.</p>
<ol class="arabic">
<li><p class="first">Log in to the CloudStack UI as root.</p>
<p>See <a class="reference internal" href="../../adminguide/ui.html#log-in-to-ui"><span class="std std-ref">Log In to the UI</span></a></p>
</li>
<li><p class="first">Navigate to the VMware cluster, click Actions, and select
Unmanage.</p>
</li>
<li><p class="first">Watch the cluster status until it shows Unmanaged.</p>
</li>
</ol>
</li>
<li><p class="first">Perform the following on each of the ESXi hosts in the cluster:</p>
<ol class="arabic simple">
<li>Move each of the ESXi hosts in the cluster to maintenance mode.</li>
<li>Ensure that all the VMs are migrated to other hosts in that
cluster.</li>
<li>If there is only one host in that cluster, shutdown all the VMs
and move the host into maintenance mode.</li>
<li>Apply the patch on the ESXi host.</li>
<li>Restart the host if prompted.</li>
<li>Cancel the maintenance mode on the host.</li>
</ol>
</li>
<li><p class="first">Reconnect the cluster to CloudStack:</p>
<ol class="arabic">
<li><p class="first">Log in to the CloudStack UI as root.</p>
</li>
<li><p class="first">Navigate to the VMware cluster, click Actions, and select Manage.</p>
</li>
<li><p class="first">Watch the status to see that all the hosts come up. It might take
several minutes for the hosts to come up.</p>
<p>Alternatively, verify the host state is properly synchronized and
updated in the CloudStack database.</p>
</li>
</ol>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="xenserver.html" class="btn btn-neutral float-right" title="Host Citrix XenServer Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lxc.html" class="btn btn-neutral float-left" title="Host LXC Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Foundation
      
        <span class="commit">
          Revision <code>29a3d9e2</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 4.13.0.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="http://docs.cloudstack.apache.org/en/master/">master</a></dd>
        
          <dd><a href="../../../../index.html">latest</a></dd>
        
          <dd><a href="../../index.html">4.13.0.0</a></dd>
        
          <dd><a href="../../../4.12.0.0/index.html">4.12.0.0</a></dd>
        
          <dd><a href="../../../4.11.3.0/index.html">4.11.3.0</a></dd>
        
          <dd><a href="../../../4.11.2.0/index.html">4.11.2.0</a></dd>
        
          <dd><a href="../../../4.11.1.0/index.html">4.11.1.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/cloudstack-documentation/downloads/htmlzip/4.13.0.0/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/cloudstack-documentation/?fromdocs=cloudstack-documentation">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/cloudstack-documentation/?fromdocs=cloudstack-documentation">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>