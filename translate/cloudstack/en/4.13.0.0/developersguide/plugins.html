

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>插件 &mdash; Apache CloudStack 4.13.0.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Allocators" href="alloc.html" />
    <link rel="prev" title="开发者指南" href="dev.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="../../latest/developersguide/plugins.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "developersguide/plugins"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache CloudStack
          

          
          </a>

          
            
            
            
              <div class="version">
                4.13.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conceptsandterminology/index.html">CloudStack 概念和术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickinstallationguide/qig.html">快速安装向导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installguide/index.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">升级 CloudStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adminguide/index.html">使用手册</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">开发者手册</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="developer_guide.html">CloudStack 安装 from GIT repo for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev.html">开发者指南</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="plugins.html#">插件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="plugins.html#storage-plugins">存储插件</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#overview-of-how-to-write-a-storage-plugin">概述 of How to Write a Storage Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#implementing-datastoredriver">Implementing DataStoreDriver</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#implementing-datastorelifecycle">Implementing DataStoreLifecycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#implementing-datastoreprovider">Implementing DataStoreProvider</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#implementing-vmsnapshotstrategy">Implementing VMSnapshotStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#place-the-jar-file-in-the-right-directory">Place the .jar File in the Right Directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#edit-configuration-files">Edit Configuration Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#minimum-required-interfaces">Minimum Required Interfaces</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plugins.html#third-party-ui-plugins">第三方 UI 插件</a><ul>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#how-to-write-a-plugin-overview">How to Write a Plugin: 概述</a></li>
<li class="toctree-l4"><a class="reference internal" href="plugins.html#how-to-write-a-plugin-implementation-details">How to Write a Plugin: Implementation Details</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="alloc.html">Allocators</a></li>
<li class="toctree-l2"><a class="reference internal" href="ansible.html">使用 Ansible 部署 CloudStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="get_help.html">获得帮助</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">插件使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">发行版本说明</a></li>
</ul>
<p class="caption"><span class="caption-text">其它:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/api.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Home">Apache CloudStack Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/">Apache CloudStack web site</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache CloudStack Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/cloudstack">Apache CloudStack on GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre 4.11 Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-administration.html">管理员手册</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-release-notes.html">发行版本说明</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CloudStack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">开发者手册</a> &raquo;</li>
        
      <li>插件</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/cloudstack-documentation/blob/4.13.0.0/source/developersguide/plugins.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="plugins">
<h1>插件<a class="headerlink" href="plugins.html#plugins" title="Permalink to this headline">¶</a></h1>
<div class="section" id="storage-plugins">
<h2>存储插件<a class="headerlink" href="plugins.html#storage-plugins" title="Permalink to this headline">¶</a></h2>
<p>This section gives an outline of how to implement a plugin to integrate
a third-party storage provider. For details and an example, you will
need to read the code.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Example code is available at: <cite>plugins/storage/volume/sample</cite></p>
</div>
<p>Third party storage providers can integrate with CloudStack to provide
either primary storage or secondary storage. For example, CloudStack
provides plugins for Amazon Simple Storage Service (S3) or OpenStack
Object Storage (Swift). The S3 plugin can be used for any object storage
that supports the Amazon S3 interface.</p>
<p>Additional third party object storages that do not support the S3
interface can be integrated with CloudStack by writing plugin software that
uses the object storage plugin framework. Several new interfaces are
available so that storage providers can develop vendor-specific plugins
based on well-defined contracts that can be seamlessly managed by
CloudStack.</p>
<p>Artifacts such as templates, ISOs and snapshots are kept in storage
which CloudStack refers to as secondary storage. To improve scalability and
performance, as when a number of hosts access secondary storage
concurrently, object storage can be used for secondary storage. Object
storage can also provide built-in high availability capability. When
using object storage, access to secondary storage data can be made
available across multiple zones in a region. This is a huge benefit, as
it is no longer necessary to copy templates, snapshots etc. across zones
as would be needed in an environment using only zone-based NFS storage.</p>
<p>The user enables a storage plugin through the UI. A new dialog box
choice is offered to select the storage provider. Depending on which
provider is selected, additional input fields may appear so that the
user can provide the additional details required by that provider, such
as a user name and password for a third-party storage account.</p>
<div class="section" id="overview-of-how-to-write-a-storage-plugin">
<h3>概述 of How to Write a Storage Plugin<a class="headerlink" href="plugins.html#overview-of-how-to-write-a-storage-plugin" title="Permalink to this headline">¶</a></h3>
<p>To add a third-party storage option to CloudStack, follow these general
steps (explained in more detail later in this section):</p>
<ol class="arabic simple">
<li>Implement the following interfaces in Java:<ul>
<li>DataStoreDriver</li>
<li>DataStoreLifecycle</li>
<li>DataStoreProvider</li>
<li>VMSnapshotStrategy (if you want to customize the VM snapshot
functionality)</li>
</ul>
</li>
<li>Hardcode your plugin’s required additional input fields into the code
for the Add 二级存储 or Add 主存储 dialog box.</li>
<li>Place your .jar file in <cite>plugins/storage/volume/</cite> or
<cite>plugins/storage/image/</cite>.</li>
<li>Edit <cite>/client/tomcatconf/componentContext.xml.in</cite>.</li>
<li>Edit <cite>client/pom.xml</cite>.</li>
</ol>
</div>
<div class="section" id="implementing-datastoredriver">
<h3>Implementing DataStoreDriver<a class="headerlink" href="plugins.html#implementing-datastoredriver" title="Permalink to this headline">¶</a></h3>
<p>DataStoreDriver contains the code that CloudStack will use to provision the
object store, when needed.</p>
<p>You must implement the following methods:</p>
<ul class="simple">
<li>getTO()</li>
<li>getStoreTO()</li>
<li>createAsync()</li>
<li>deleteAsync()</li>
</ul>
<p>The following methods are optional:</p>
<ul class="simple">
<li>resize()</li>
<li>canCopy() is optional. If you set it to true, then you must implement
copyAsync().</li>
</ul>
</div>
<div class="section" id="implementing-datastorelifecycle">
<h3>Implementing DataStoreLifecycle<a class="headerlink" href="plugins.html#implementing-datastorelifecycle" title="Permalink to this headline">¶</a></h3>
<p>DataStoreLifecycle contains the code to manage the storage operations
for ongoing use of the storage. Several operations are needed, like
create, maintenance mode, delete, etc.</p>
<p>You must implement the following methods:</p>
<ul class="simple">
<li>initialize()</li>
<li>maintain()</li>
<li>cancelMaintain()</li>
<li>deleteDataStore()</li>
<li>Implement one of the attach*() methods depending on what scope you
want the storage to have: attachHost(), attachCluster(), or attachZone().</li>
</ul>
</div>
<div class="section" id="implementing-datastoreprovider">
<h3>Implementing DataStoreProvider<a class="headerlink" href="plugins.html#implementing-datastoreprovider" title="Permalink to this headline">¶</a></h3>
<p>DataStoreProvider contains the main code of the data store.</p>
<p>You must implement the following methods:</p>
<ul class="simple">
<li>getDatastoreLifeCycle()</li>
<li>getDataStoreDriver()</li>
<li>getTypes(). Returns one or more types of storage for which this data
store provider can be used. For secondary object storage, return
IMAGE, and for a Secondary Staging Store, return ImageCache.</li>
<li>configure(). First initialize the lifecycle implementation and the
driver implementation, then call registerDriver() to register the new
object store provider instance with CloudStack.</li>
<li>getName(). Returns the unique name of your provider; for example,
this can be used to get the name to display in the UI.</li>
</ul>
<p>The following methods are optional:</p>
<ul class="simple">
<li>getHostListener() is optional; it’s for monitoring the status of the host.</li>
</ul>
</div>
<div class="section" id="implementing-vmsnapshotstrategy">
<h3>Implementing VMSnapshotStrategy<a class="headerlink" href="plugins.html#implementing-vmsnapshotstrategy" title="Permalink to this headline">¶</a></h3>
<p>VMSnapshotStrategy has the following methods:</p>
<ul class="simple">
<li>takeVMSnapshot()</li>
<li>deleteVMSnapshot()</li>
<li>revertVMSnapshot()</li>
<li>canHandle(). For a given VM snapshot, tells whether this
implementation of VMSnapshotStrategy can handle it.</li>
</ul>
</div>
<div class="section" id="place-the-jar-file-in-the-right-directory">
<h3>Place the .jar File in the Right Directory<a class="headerlink" href="plugins.html#place-the-jar-file-in-the-right-directory" title="Permalink to this headline">¶</a></h3>
<p>For a secondary storage plugin, place your .jar file here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span><span class="o">/</span><span class="n">storage</span><span class="o">/</span><span class="n">image</span><span class="o">/</span>
</pre></div>
</div>
<p>For a primary storage plugin, place your .jar file here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span><span class="o">/</span><span class="n">storage</span><span class="o">/</span><span class="n">volume</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="edit-configuration-files">
<h3>Edit Configuration Files<a class="headerlink" href="plugins.html#edit-configuration-files" title="Permalink to this headline">¶</a></h3>
<p>First, edit the following file tell CloudStack to include your .jar file.
Add a line to this file to tell the CloudStack 管理服务 that it
now has a dependency on your code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">/</span><span class="n">pom</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>Place some facts about your code in the following file so CloudStack can
run it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="n">tomcatconf</span><span class="o">/</span><span class="n">componentContext</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span><span class="ow">in</span>
</pre></div>
</div>
<p>In the section “Deployment configurations of various adapters,” add
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;bean&gt;id=”some unique ID” class=”package name of your implementation of DataStoreProvider”&lt;/bean&gt;
</pre></div>
</div>
<p>In the section “Storage Providers,” add this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;property name=”providers”&gt;
   &lt;ref local=”same ID from the bean tag&#39;s id attribute”&gt;
&lt;/property&gt;
</pre></div>
</div>
</div>
<div class="section" id="minimum-required-interfaces">
<h3>Minimum Required Interfaces<a class="headerlink" href="plugins.html#minimum-required-interfaces" title="Permalink to this headline">¶</a></h3>
<p>The classes, interfaces, and methods used by CloudStack from the Amazon Web
Services (AWS) Java SDK are listed in this section. An object storage
that supports the S3 interface is minimally required to support the
below in order to be compatible with CloudStack.</p>
<div class="section" id="interface-amazons3">
<h4>Interface AmazonS3<a class="headerlink" href="plugins.html#interface-amazons3" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/AmazonS3.html">http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/AmazonS3.html</a></p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Modifier and
Type</th>
<th class="head">Method and Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Bucket</td>
<td><p class="first">createBucket(String&nbsp;bucketName)</p>
<p class="last">Creates a new Amazon S3 bucket with the specified name
in the default (US) region, Region.US_Standard.</p>
</td>
</tr>
<tr class="row-odd"><td>void</td>
<td><p class="first">deleteObject(String&nbsp;bucketName, String&nbsp;key)</p>
<p class="last">Deletes the specified object in the specified bucket.</p>
</td>
</tr>
<tr class="row-even"><td>ObjectMetadata</td>
<td><p class="first">getObject(GetObjectRequest&nbsp;getObjectRequest,
File&nbsp;destinationFile)</p>
<p class="last">Gets the object metadata for the object stored in
Amazon S3 under the specified bucket and key, and saves
the object contents to the specified file.</p>
</td>
</tr>
<tr class="row-odd"><td>S3Object</td>
<td><p class="first">getObject(String&nbsp;bucketName, String&nbsp;key)</p>
<p class="last">Gets the object stored in Amazon S3 under the specified
bucket and key.</p>
</td>
</tr>
<tr class="row-even"><td>URL</td>
<td><p class="first">generatePresignedUrl(String&nbsp;bucketName, String&nbsp;key,
Date&nbsp;expiration, HttpMethod&nbsp;method)</p>
<p class="last">Returns a pre-signed URL for accessing an Amazon S3
resource.</p>
</td>
</tr>
<tr class="row-odd"><td>void</td>
<td><p class="first">deleteBucket(String&nbsp;bucketName)</p>
<p class="last">Deletes the specified bucket.</p>
</td>
</tr>
<tr class="row-even"><td>List&lt;Bucket&gt;</td>
<td><p class="first">listBuckets()</p>
<p class="last">Returns a list of all Amazon S3 buckets that the
authenticated sender of the request owns.</p>
</td>
</tr>
<tr class="row-odd"><td>ObjectListing</td>
<td><p class="first">listObjects(String&nbsp;bucketName, String&nbsp;prefix)</p>
<p class="last">Returns a list of summary information about the objects
in the specified bucket.</p>
</td>
</tr>
<tr class="row-even"><td>PutObjectResult</td>
<td><p class="first">putObject(PutObjectRequest&nbsp;putObjectRequest)</p>
<p class="last">Uploads a new object to the specified Amazon S3 bucket.</p>
</td>
</tr>
<tr class="row-odd"><td>PutObjectResult</td>
<td><p class="first">putObject(String&nbsp;bucketName, String&nbsp;key, File&nbsp;file)</p>
<p class="last">Uploads the specified file to Amazon S3 under the
specified bucket and key name.</p>
</td>
</tr>
<tr class="row-even"><td>PutObjectResult</td>
<td><p class="first">putObject(String&nbsp;bucketName, String&nbsp;key,
InputStream&nbsp;input, ObjectMetadata&nbsp;metadata)</p>
<p class="last">Uploads the specified input stream and object metadata
to Amazon S3 under the specified bucket and key name.</p>
</td>
</tr>
<tr class="row-odd"><td>void</td>
<td><p class="first">setEndpoint(String&nbsp;endpoint)</p>
<p class="last">Overrides the default endpoint for this client.</p>
</td>
</tr>
<tr class="row-even"><td>void</td>
<td><p class="first">setObjectAcl(String&nbsp;bucketName, String&nbsp;key,
CannedAccessControlList&nbsp;acl)</p>
<p class="last">Sets the CannedAccessControlList for the specified
object in Amazon S3 using one of the pre-configured
CannedAccessControlLists.</p>
</td>
</tr>
</tbody>
</table>
<p><em>Class TransferManager</em></p>
<p><a class="reference external" href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/transfer/TransferManager.html">http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/transfer/TransferManager.html</a></p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Modifier and
Type</th>
<th class="head">Method and Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Upload</td>
<td><p class="first">upload(PutObjectRequest&nbsp;putObjectRequest)</p>
<p class="last">Schedules a new transfer to upload data to Amazon S3.</p>
</td>
</tr>
</tbody>
</table>
<p><em>Class PutObjectRequest</em></p>
<p><a class="reference external" href="http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/PutObjectRequest.html">http://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/PutObjectRequest.html</a></p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Modifier and
Type</th>
<th class="head">Method and Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Upload</td>
<td><p class="first">upload(PutObjectRequest&nbsp;putObjectRequest)</p>
<p class="last">Schedules a new transfer to upload data to Amazon S3.</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="third-party-ui-plugins">
<h2>第三方 UI 插件<a class="headerlink" href="plugins.html#third-party-ui-plugins" title="Permalink to this headline">¶</a></h2>
<p>Using the new third-party plugin framework, you can write and install
extensions to CloudStack. The installed and enabled plugins will appear in
the UI alongside the other features. The code for the plugin is simply
placed in a special directory within CloudStack’s installed code at any
time after CloudStack installation. The new plugin appears only when it is
enabled by the cloud administrator.</p>
<div class="figure align-center">
<img alt="New plugin button in CloudStack navbar" src="../_images/plugin_intro.jpg" />
</div>
<p>The left navigation bar of the CloudStack UI has a new 插件 button to
help you work with UI plugins.</p>
<div class="section" id="how-to-write-a-plugin-overview">
<h3>How to Write a Plugin: 概述<a class="headerlink" href="plugins.html#how-to-write-a-plugin-overview" title="Permalink to this headline">¶</a></h3>
<p>The basic procedure for writing a plugin is:</p>
<ol class="arabic">
<li><p class="first">Write the code and create the other files needed. You will need the
plugin code itself (in Javascript), a thumbnail image, the plugin
listing, and a CSS file.</p>
<div class="figure align-center">
<img alt="Write the plugin code" src="../_images/plugin1.jpg" />
</div>
<p>All UI plugins have the following set of files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--</span> <span class="n">cloudstack</span><span class="o">/</span>
  <span class="o">+--</span> <span class="n">ui</span><span class="o">/</span>
    <span class="o">+--</span> <span class="n">plugins</span><span class="o">/</span>
      <span class="o">+--</span> <span class="n">csMyFirstPlugin</span><span class="o">/</span>
        <span class="o">+--</span> <span class="n">config</span><span class="o">.</span><span class="n">js</span>            <span class="o">--&gt;</span> <span class="n">Plugin</span> <span class="n">metadata</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">vendor</span> <span class="n">URL</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="p">)</span>
        <span class="o">+--</span> <span class="n">icon</span><span class="o">.</span><span class="n">png</span>             <span class="o">--&gt;</span> <span class="n">Icon</span><span class="p">,</span> <span class="n">shown</span> <span class="n">on</span> <span class="n">side</span> <span class="n">nav</span> <span class="n">bar</span> <span class="ow">and</span> <span class="n">plugin</span> <span class="n">listing</span>
                                     <span class="p">(</span><span class="n">should</span> <span class="n">be</span> <span class="n">square</span><span class="p">,</span> <span class="ow">and</span> <span class="o">~</span><span class="mi">50</span><span class="n">x50px</span><span class="p">)</span>
        <span class="o">+--</span> <span class="n">csMyFirstPlugin</span><span class="o">.</span><span class="n">css</span>  <span class="o">--&gt;</span> <span class="n">CSS</span> <span class="n">file</span><span class="p">,</span> <span class="n">loaded</span> <span class="n">automatically</span> <span class="n">when</span> <span class="n">plugin</span> <span class="n">loads</span>
        <span class="o">+--</span> <span class="n">csMyFirstPlugin</span><span class="o">.</span><span class="n">js</span>   <span class="o">--&gt;</span> <span class="n">Main</span> <span class="n">JS</span> <span class="n">file</span><span class="p">,</span> <span class="n">containing</span> <span class="n">plugin</span> <span class="n">code</span>
</pre></div>
</div>
<p>The same files must also be present at
<cite>/tomcat/webapps/client/plugins</cite>.</p>
</li>
<li><p class="first">The CloudStack administrator adds the folder containing your plugin code
under the CloudStack PLUGINS folder.</p>
<div class="figure align-center">
<img alt="The plugin code is placed in the PLUGINS folder" src="../_images/plugin2.jpg" />
</div>
</li>
<li><p class="first">The administrator also adds the name of your plugin to the plugin.js
file in the PLUGINS folder.</p>
<div class="figure align-center">
<img alt="The plugin name is added to `plugin.js` in the PLUGINS folder" src="../_images/plugin3.jpg" />
</div>
</li>
<li><p class="first">The next time the user refreshes the UI in the browser, your plugin
will appear in the left navigation bar.</p>
<div class="figure align-center">
<img alt="The plugin appears in the UI" src="../_images/plugin4.jpg" />
</div>
</li>
</ol>
</div>
<div class="section" id="how-to-write-a-plugin-implementation-details">
<h3>How to Write a Plugin: Implementation Details<a class="headerlink" href="plugins.html#how-to-write-a-plugin-implementation-details" title="Permalink to this headline">¶</a></h3>
<p>This section requires an understanding of JavaScript and the CloudStack
API. You don’t need knowledge of specific frameworks for this tutorial
(jQuery, etc.), since the CloudStack UI handles the front-end rendering for
you.</p>
<p>There is much more to the CloudStack UI framework than can be described
here. The UI is very flexible to handle many use cases, so there are
countless options and variations. The best reference right now is to
read the existing code for the main UI, which is in the /ui folder.
插件 are written in a very similar way to the main UI.</p>
<ol class="arabic">
<li><p class="first"><strong>Create the directory to hold your plugin.</strong></p>
<p>All plugins are composed of set of required files in the directory
/ui/plugins/pluginID, where pluginID is a short name for your
plugin. It’s recommended that you prefix your folder name (for
example, bfMyPlugin) to avoid naming conflicts with other people’s
plugins.</p>
<p>In this example, the plugin is named csMyFirstPlugin.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd cloudstack/ui/plugins
$ mkdir csMyFirstPlugin
$ ls -l

total 8
drwxr-xr-x  2 bgregory  staff   68 Feb 11 14:44 csMyFirstPlugin
-rw-r--r--  1 bgregory  staff  101 Feb 11 14:26 plugins.js
</pre></div>
</div>
</li>
<li><p class="first"><strong>Change to your new plugin directory.</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd csMyFirstPlugin
</pre></div>
</div>
</li>
<li><p class="first"><strong>Set up the listing.</strong></p>
<p>Add the file <cite>config.js</cite>, using your favorite editor.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vi config.js
</pre></div>
</div>
<p>Add the following content to config.js. This information will be
displayed on the plugin listing page in the UI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">cloudStack</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cloudStack</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">csMyFirstPlugin</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">title</span><span class="p">:</span> <span class="s1">&#39;My first plugin&#39;</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="s1">&#39;Tutorial plugin&#39;</span><span class="p">,</span>
    <span class="n">externalLink</span><span class="p">:</span> <span class="s1">&#39;http://www.cloudstack.org/&#39;</span><span class="p">,</span>
    <span class="n">authorName</span><span class="p">:</span> <span class="s1">&#39;Test Plugin Developer&#39;</span><span class="p">,</span>
    <span class="n">authorEmail</span><span class="p">:</span> <span class="s1">&#39;plugin.developer@example.com&#39;</span>
  <span class="p">};</span>
<span class="p">}(</span><span class="n">cloudStack</span><span class="p">));</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Add a new main section.</strong></p>
<p>Add the file csMyFirstPlugin.js, using your favorite editor.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vi csMyFirstPlugin.js
</pre></div>
</div>
<p>Add the following content to csMyFirstPlugin.js:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(function (cloudStack) {
  cloudStack.plugins.csMyFirstPlugin = function(plugin) {
    plugin.ui.addSection({
      id: &#39;csMyFirstPlugin&#39;,
      title: &#39;My Plugin&#39;,
      preFilter: function(args) {
        return isAdmin();
      },
      show: function() {
        return $(&#39;&lt;div&gt;&#39;).html(&#39;Content will go here&#39;);
      }
    });
  };
}(cloudStack));
</pre></div>
</div>
</li>
<li><p class="first"><strong>Register the plugin.</strong></p>
<p>You now have the minimal content needed to run the plugin, so you
can activate the plugin in the UI by adding it to plugins.js. First,
edit the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd cloudstack/ui/plugins
$ vi plugins.js
</pre></div>
</div>
<p>Now add the following to plugins.js:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(function($, cloudStack) {
  cloudStack.plugins = [
    &#39;csMyFirstPlugin&#39;
  ];
}(jQuery, cloudStack));
</pre></div>
</div>
</li>
<li><p class="first"><strong>Check the plugin in the UI.</strong></p>
<p>First, copy all the plugin code that you have created so far to
<cite>/tomcat/webapps/client/plugins</cite>. Then refresh the browser and click
插件 in the side navigation bar. You should see your new plugin.</p>
</li>
<li><p class="first"><strong>Make the plugin do something.</strong></p>
<p>Right now, you just have placeholder content in the new plugin. It’s
time to add real code. In this example, you will write a basic list
view, which renders data from an API call. You will list all virtual
machines owned by the logged-in user. To do this, replace the ‘show’
function in the plugin code with a ‘listView’ block, containing the
required syntax for a list view. To get the data, use the
listVirtualMachines API call. Without any parameters, it will return
VMs only for your active user. Use the provided ‘apiCall’ helper
method to handle the server call. Of course, you are free to use any
other method for making the AJAX call (for example, jQuery’s $.ajax
method).</p>
<p>First, open your plugin’s JavaScript source file in your favorite
editor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd csMyFirstPlugin
$ vi csMyFirstPlugin.js
</pre></div>
</div>
<p>Add the following code in csMyFirstPlugin.js:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">function</span> <span class="p">(</span><span class="n">cloudStack</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cloudStack</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">csMyFirstPlugin</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">plugin</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">plugin</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">addSection</span><span class="p">({</span>
      <span class="nb">id</span><span class="p">:</span> <span class="s1">&#39;csMyFirstPlugin&#39;</span><span class="p">,</span>
      <span class="n">title</span><span class="p">:</span> <span class="s1">&#39;My Plugin&#39;</span><span class="p">,</span>
      <span class="n">preFilter</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">isAdmin</span><span class="p">();</span>
      <span class="p">},</span>

      <span class="o">//</span> <span class="n">Render</span> <span class="n">page</span> <span class="k">as</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">view</span>
      <span class="n">listView</span><span class="p">:</span> <span class="p">{</span>
        <span class="nb">id</span><span class="p">:</span> <span class="s1">&#39;testPluginInstances&#39;</span><span class="p">,</span>
        <span class="n">fields</span><span class="p">:</span> <span class="p">{</span>
          <span class="n">name</span><span class="p">:</span> <span class="p">{</span> <span class="n">label</span><span class="p">:</span> <span class="s1">&#39;label.name&#39;</span> <span class="p">},</span>
          <span class="n">instancename</span><span class="p">:</span> <span class="p">{</span> <span class="n">label</span><span class="p">:</span> <span class="s1">&#39;label.internal.name&#39;</span> <span class="p">},</span>
          <span class="n">displayname</span><span class="p">:</span> <span class="p">{</span> <span class="n">label</span><span class="p">:</span> <span class="s1">&#39;label.display.name&#39;</span> <span class="p">},</span>
          <span class="n">zonename</span><span class="p">:</span> <span class="p">{</span> <span class="n">label</span><span class="p">:</span> <span class="s1">&#39;label.zone.name&#39;</span> <span class="p">}</span>
        <span class="p">},</span>
        <span class="n">dataProvider</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
          <span class="o">//</span> <span class="n">API</span> <span class="n">calls</span> <span class="n">go</span> <span class="n">here</span><span class="p">,</span> <span class="n">to</span> <span class="n">retrive</span> <span class="n">the</span> <span class="n">data</span> <span class="n">asynchronously</span>
          <span class="o">//</span>
          <span class="o">//</span> <span class="n">On</span> <span class="n">successful</span> <span class="n">retrieval</span><span class="p">,</span> <span class="n">call</span>
          <span class="o">//</span> <span class="n">args</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="p">({</span> <span class="n">data</span><span class="p">:</span> <span class="p">[</span><span class="n">data</span> <span class="n">array</span><span class="p">]</span> <span class="p">});</span>
          <span class="n">plugin</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">apiCall</span><span class="p">(</span><span class="s1">&#39;listVirtualMachines&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">success</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">json</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">var</span> <span class="n">vms</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">listvirtualmachinesresponse</span><span class="o">.</span><span class="n">virtualmachine</span><span class="p">;</span>

              <span class="n">args</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="p">({</span> <span class="n">data</span><span class="p">:</span> <span class="n">vms</span> <span class="p">});</span>
            <span class="p">},</span>
            <span class="n">error</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">args</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>
            <span class="p">}</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span>
<span class="p">}(</span><span class="n">cloudStack</span><span class="p">));</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Test the plugin.</strong></p>
<p>First, copy all the plugin code that you have created so far to
<cite>/tomcat/webapps/client/plugins</cite>. Then refresh the browser. You can
see that your placeholder content was replaced with a list table,
containing 4 columns of virtual machine data.</p>
</li>
<li><p class="first"><strong>Add an action button.</strong></p>
<p>Let’s add an action button to the list view, which will reboot the
VM. To do this, add an actions block under listView. After
specifying the correct format, the actions will appear automatically
to the right of each row of data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ vi csMyFirstPlugin.js
</pre></div>
</div>
<p>Now add the following new code in csMyFirstPlugin.js. (The dots …
show where we have omitted some existing code for the sake of space.
Don’t actually cut and paste that part):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
   <span class="n">listView</span><span class="p">:</span> <span class="p">{</span>
     <span class="nb">id</span><span class="p">:</span> <span class="s1">&#39;testPluginInstances&#39;</span><span class="p">,</span>
     <span class="o">...</span>

     <span class="n">actions</span><span class="p">:</span> <span class="p">{</span>
       <span class="o">//</span> <span class="n">The</span> <span class="n">key</span><span class="o">/</span><span class="n">ID</span> <span class="n">you</span> <span class="n">specify</span> <span class="n">here</span> <span class="n">will</span> <span class="n">determine</span> <span class="n">what</span> <span class="n">icon</span> <span class="ow">is</span>
       <span class="o">//</span> <span class="n">shown</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">UI</span> <span class="k">for</span> <span class="n">this</span> <span class="n">action</span><span class="p">,</span>
       <span class="o">//</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">added</span> <span class="k">as</span> <span class="n">a</span> <span class="n">CSS</span> <span class="k">class</span> <span class="nc">to</span> <span class="n">the</span> <span class="n">action</span><span class="s1">&#39;s element</span>
       <span class="o">//</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span> <span class="s1">&#39;.action.restart&#39;</span><span class="p">)</span>
       <span class="o">//</span>
       <span class="o">//</span> <span class="o">--</span> <span class="n">here</span><span class="p">,</span> <span class="s1">&#39;restart&#39;</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">predefined</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">CloudStack</span> <span class="n">that</span> <span class="n">will</span>
       <span class="o">//</span> <span class="n">automatically</span> <span class="n">show</span> <span class="n">a</span> <span class="s1">&#39;reboot&#39;</span> <span class="n">arrow</span> <span class="k">as</span> <span class="n">an</span> <span class="n">icon</span><span class="p">;</span>
       <span class="o">//</span> <span class="n">this</span> <span class="n">can</span> <span class="n">be</span> <span class="n">changed</span> <span class="ow">in</span> <span class="n">csMyFirstPlugin</span><span class="o">.</span><span class="n">css</span>
       <span class="n">restart</span><span class="p">:</span> <span class="p">{</span>
         <span class="n">label</span><span class="p">:</span> <span class="s1">&#39;Restart VM&#39;</span><span class="p">,</span>
         <span class="n">messages</span><span class="p">:</span> <span class="p">{</span>
           <span class="n">confirm</span><span class="p">:</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;Are you sure you want to restart this VM?&#39;</span> <span class="p">},</span>
           <span class="n">notification</span><span class="p">:</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;Rebooted VM&#39;</span> <span class="p">}</span>
         <span class="p">},</span>
         <span class="n">action</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
           <span class="o">//</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">instance</span> <span class="nb">object</span> <span class="n">of</span> <span class="n">the</span> <span class="n">selected</span> <span class="n">row</span> <span class="kn">from</span> <span class="nn">context</span>
           <span class="o">//</span>
           <span class="o">//</span> <span class="o">--</span> <span class="nb">all</span> <span class="n">currently</span> <span class="n">loaded</span> <span class="n">state</span> <span class="ow">is</span> <span class="n">stored</span> <span class="ow">in</span> <span class="s1">&#39;context&#39;</span> <span class="k">as</span> <span class="n">objects</span><span class="p">,</span>
           <span class="o">//</span>    <span class="n">such</span> <span class="k">as</span> <span class="n">the</span> <span class="n">selected</span> <span class="nb">list</span> <span class="n">view</span> <span class="n">row</span><span class="p">,</span>
           <span class="o">//</span>    <span class="n">the</span> <span class="n">selected</span> <span class="n">section</span><span class="p">,</span> <span class="ow">and</span> <span class="n">active</span> <span class="n">user</span>
           <span class="o">//</span>
           <span class="o">//</span> <span class="o">--</span> <span class="k">for</span> <span class="nb">list</span> <span class="n">view</span> <span class="n">actions</span><span class="p">,</span> <span class="n">the</span> <span class="nb">object</span><span class="s1">&#39;s key will be the same as</span>
           <span class="o">//</span>    <span class="n">listView</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">specified</span> <span class="n">above</span><span class="p">;</span>
           <span class="o">//</span>    <span class="n">always</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">you</span> <span class="n">specify</span> <span class="n">an</span> <span class="s1">&#39;id&#39;</span> <span class="k">for</span> <span class="n">the</span> <span class="n">listView</span><span class="p">,</span>
           <span class="o">//</span>     <span class="ow">or</span> <span class="k">else</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="s1">&#39;undefined!&#39;</span>
           <span class="n">var</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">testPluginInstances</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

           <span class="n">plugin</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">apiCall</span><span class="p">(</span><span class="s1">&#39;rebootVirtualMachine&#39;</span><span class="p">,</span> <span class="p">{</span>
             <span class="o">//</span> <span class="n">These</span> <span class="n">will</span> <span class="n">be</span> <span class="n">appended</span> <span class="n">to</span> <span class="n">the</span> <span class="n">API</span> <span class="n">request</span>
             <span class="o">//</span>
             <span class="o">//</span> <span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span> <span class="n">rebootVirtualMachine</span><span class="o">&amp;</span><span class="nb">id</span><span class="o">=...</span>
             <span class="n">data</span><span class="p">:</span> <span class="p">{</span>
               <span class="nb">id</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">id</span>
             <span class="p">},</span>
             <span class="n">success</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">json</span><span class="p">)</span> <span class="p">{</span>
               <span class="n">args</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="p">({</span>
                 <span class="o">//</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">an</span> <span class="k">async</span> <span class="n">job</span><span class="p">,</span> <span class="n">so</span> <span class="n">success</span> <span class="n">here</span> <span class="n">only</span> <span class="n">indicates</span>
                 <span class="o">//</span> <span class="n">that</span> <span class="n">the</span> <span class="n">job</span> <span class="n">was</span> <span class="n">initiated</span><span class="o">.</span>
                 <span class="o">//</span>
                 <span class="o">//</span> <span class="n">To</span> <span class="k">pass</span> <span class="n">the</span> <span class="n">job</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">the</span> <span class="n">notification</span> <span class="n">UI</span>
                 <span class="o">//</span> <span class="p">(</span><span class="k">for</span> <span class="n">checking</span> <span class="n">to</span> <span class="n">see</span> <span class="n">when</span> <span class="n">action</span> <span class="ow">is</span> <span class="n">completed</span><span class="p">),</span>
                 <span class="o">//</span> <span class="s1">&#39;_custom: { jobID: ... }&#39;</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">always</span> <span class="n">be</span> <span class="n">passed</span> <span class="n">on</span> <span class="n">success</span><span class="p">,</span>
                 <span class="o">//</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="nb">format</span> <span class="k">as</span> <span class="n">below</span>
                 <span class="n">_custom</span><span class="p">:</span> <span class="p">{</span> <span class="n">jobId</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">rebootvirtualmachineresponse</span><span class="o">.</span><span class="n">jobid</span> <span class="p">}</span>
               <span class="p">});</span>
             <span class="p">},</span>


             <span class="n">error</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span> <span class="p">{</span>
               <span class="n">args</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">);</span> <span class="o">//</span> <span class="n">Cancel</span> <span class="n">action</span><span class="p">,</span> <span class="n">show</span> <span class="n">error</span> <span class="n">message</span> <span class="n">returned</span>
             <span class="p">}</span>
           <span class="p">});</span>
         <span class="p">},</span>

         <span class="o">//</span> <span class="n">Because</span> <span class="n">rebootVirtualMachine</span> <span class="ow">is</span> <span class="n">an</span> <span class="k">async</span> <span class="n">job</span><span class="p">,</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">add</span>
         <span class="o">//</span> <span class="n">a</span> <span class="n">poll</span> <span class="n">function</span><span class="p">,</span> <span class="n">which</span> <span class="n">will</span> <span class="n">perodically</span> <span class="n">check</span>
         <span class="o">//</span> <span class="n">the</span> <span class="n">management</span> <span class="n">server</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">the</span> <span class="n">job</span> <span class="ow">is</span> <span class="n">ready</span>
         <span class="o">//</span> <span class="p">(</span><span class="n">via</span> <span class="n">pollAsyncJobResult</span> <span class="n">API</span> <span class="n">call</span><span class="p">)</span>
         <span class="o">//</span>
         <span class="o">//</span> <span class="n">The</span> <span class="n">plugin</span> <span class="n">API</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">helper</span> <span class="n">function</span><span class="p">,</span> <span class="s1">&#39;plugin.ui.pollAsyncJob&#39;</span><span class="p">,</span>
         <span class="o">/</span>  <span class="n">which</span> <span class="n">will</span> <span class="n">work</span> <span class="k">for</span> <span class="n">most</span> <span class="n">jobs</span>
         <span class="o">//</span> <span class="ow">in</span> <span class="n">CloudStack</span>
         <span class="n">notification</span><span class="p">:</span> <span class="p">{</span>
           <span class="n">poll</span><span class="p">:</span> <span class="n">plugin</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">pollAsyncJob</span>
         <span class="p">}</span>
       <span class="p">}</span>
     <span class="p">},</span>

     <span class="n">dataProvider</span><span class="p">:</span> <span class="n">function</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span>
       <span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Add the thumbnail icon.</strong></p>
<p>Create an icon file; it should be square, about 50x50 pixels, and
named <cite>icon.png</cite>. Copy it into the same directory with your plugin
code: <cite>cloudstack/ui/plugins/csMyFirstPlugin/icon.png</cite>.</p>
</li>
<li><p class="first"><strong>Add the stylesheet.</strong></p>
<p>Create a CSS file, with the same name as your <cite>.js</cite> file. Copy it into
the same directory with your plugin code:
<cite>cloudstack/ui/plugins/csMyFirstPlugin/csMyFirstPlugin.css</cite>.</p>
</li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="alloc.html" class="btn btn-neutral float-right" title="Allocators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dev.html" class="btn btn-neutral float-left" title="开发者指南" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Foundation
      
        <span class="commit">
          Revision <code>29a3d9e2</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 4.13.0.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="http://docs.cloudstack.apache.org/en/master/">master</a></dd>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../index.html">4.13.0.0</a></dd>
        
          <dd><a href="../../4.12.0.0/index.html">4.12.0.0</a></dd>
        
          <dd><a href="../../4.11.3.0/index.html">4.11.3.0</a></dd>
        
          <dd><a href="../../4.11.2.0/index.html">4.11.2.0</a></dd>
        
          <dd><a href="../../4.11.1.0/index.html">4.11.1.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/cloudstack-documentation/downloads/htmlzip/4.13.0.0/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/cloudstack-documentation/?fromdocs=cloudstack-documentation">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/cloudstack-documentation/?fromdocs=cloudstack-documentation">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>