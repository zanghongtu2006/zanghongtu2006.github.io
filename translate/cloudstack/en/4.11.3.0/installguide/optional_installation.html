

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Additional 安装 Options &mdash; Apache CloudStack 4.11.3.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="密码和加密密钥" href="encryption.html" />
    <link rel="prev" title="Citrix XenServer 安装" href="hypervisor/xenserver.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="../../latest/installguide/optional_installation.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "installguide/optional_installation"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache CloudStack
          

          
          </a>

          
            
            
            
              <div class="version">
                4.11.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conceptsandterminology/index.html">CloudStack 概念和术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickinstallationguide/qig.html">快速安装向导</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">安装指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#building-from-source">从源码编译安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#general-installation">通用安装指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hypervisor-setup">Hypervisor 安装和设置</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#optional-installation">Optional 安装</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="optional_installation.html#">Additional 安装 Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="optional_installation.html#installing-the-usage-server-optional">Installing the Usage Server (Optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="optional_installation.html#ssl-optional">SSL (Optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="optional_installation.html#database-replication-optional">Database Replication (Optional)</a></li>
<li class="toctree-l4"><a class="reference internal" href="optional_installation.html#amazon-web-services-interface">Amazon Web Services Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="encryption.html">密码和加密密钥</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">升级 CloudStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adminguide/index.html">使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developersguide/index.html">开发者手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">插件使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">发行版本说明</a></li>
</ul>
<p class="caption"><span class="caption-text">其它:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/api.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Home">Apache CloudStack Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/">Apache CloudStack web site</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache CloudStack Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/cloudstack">Apache CloudStack on GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre 4.11 Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-administration.html">管理员手册</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-release-notes.html">发行版本说明</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CloudStack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">安装指南</a> &raquo;</li>
        
      <li>Additional 安装 Options</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/cloudstack-documentation/blob/4.11.3.0/source/installguide/optional_installation.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="additional-installation-options">
<h1>Additional 安装 Options<a class="headerlink" href="optional_installation.html#additional-installation-options" title="Permalink to this headline">¶</a></h1>
<p>The next few sections describe CloudStack features above and beyond the
basic deployment options.</p>
<div class="section" id="installing-the-usage-server-optional">
<h2>Installing the Usage Server (Optional)<a class="headerlink" href="optional_installation.html#installing-the-usage-server-optional" title="Permalink to this headline">¶</a></h2>
<p>You can optionally install the Usage Server once the 管理服务
is configured properly. The Usage Server takes data from the events in
the system and enables usage-based billing for accounts.</p>
<p>When multiple Management Servers are present, the Usage Server may be
installed on any number of them. The Usage Servers will coordinate usage
processing. A site that is concerned about availability should install
Usage Servers on at least two Management Servers.</p>
<div class="section" id="requirements-for-installing-the-usage-server">
<h3>Requirements for Installing the Usage Server<a class="headerlink" href="optional_installation.html#requirements-for-installing-the-usage-server" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The 管理服务 must be running when the Usage Server is
installed.</li>
<li>The Usage Server must be installed on the same server as a Management
Server.</li>
</ul>
</div>
<div class="section" id="steps-to-install-the-usage-server">
<h3>Steps to Install the Usage Server<a class="headerlink" href="optional_installation.html#steps-to-install-the-usage-server" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Package repository should already being configured. Refer to
<a class="reference external" href="http://cloudstack-installation.readthedocs.org/en/latest/installation.html#configure-package-repository">Configure Package Repository</a></p>
</li>
<li><p class="first">Install package cloudstack-usage</p>
<p>On RHEL/CentOS systems, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum install cloudstack-usage</span>
</pre></div>
</div>
<p>On Debian/Ubuntu systems, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># apt-get install cloudstack-usage</span>
</pre></div>
</div>
</li>
<li><p class="first">Once installed, start the Usage Server with the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service cloudstack-usage start</span>
</pre></div>
</div>
</li>
<li><p class="first">Enable the service at boot</p>
<p>On RHEL/CentOS systems, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># chkconfig cloudstack-usage on</span>
</pre></div>
</div>
<p>On Debian/Ubuntu systems, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># update-rc.d cloudstack-usage defaults</span>
</pre></div>
</div>
</li>
</ol>
<p><a class="reference internal" href="../adminguide/usage.html#working-with-usage"><span class="std std-ref">Working with Usage</span></a> discusses further configuration of the Usage
Server.</p>
</div>
</div>
<div class="section" id="ssl-optional">
<h2>SSL (Optional)<a class="headerlink" href="optional_installation.html#ssl-optional" title="Permalink to this headline">¶</a></h2>
<p>CloudStack provides HTTP access in its default installation. There are a
number of technologies and sites which choose to implement SSL/TLS. As a
result, we have left CloudStack to expose HTTP under the assumption that
a site will implement its typical practice.</p>
<p>CloudStack 4.9 and above uses embedded Jetty as its servlet container. For sites
that would like CloudStack to terminate the SSL session, HTTPS can be enabled
by configuring the https-related settings in CloudStack management server’s
server.properties file at /etc/cloudstack/management/ location:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># For management server to pickup these configuration settings, the configured</span>
<span class="c1"># keystore file should exists and be readable by the management server.</span>
<span class="n">https</span><span class="o">.</span><span class="n">enable</span><span class="o">=</span><span class="n">true</span>
<span class="n">https</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">8443</span>
<span class="n">https</span><span class="o">.</span><span class="n">keystore</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">cloudstack</span><span class="o">/</span><span class="n">management</span><span class="o">/</span><span class="n">cloud</span><span class="o">.</span><span class="n">jks</span>
<span class="n">https</span><span class="o">.</span><span class="n">keystore</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">vmops</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</div></blockquote>
<p>For storing certificates, admins can create and configure a java keystore file
and configure the same in the server.properties file as illustrated above.</p>
</div>
<div class="section" id="database-replication-optional">
<h2>Database Replication (Optional)<a class="headerlink" href="optional_installation.html#database-replication-optional" title="Permalink to this headline">¶</a></h2>
<p>CloudStack supports database replication from one MySQL node to another.
This is achieved using standard MySQL replication. You may want to do
this as insurance against MySQL server or storage loss. MySQL
replication is implemented using a master/slave model. The master is the
node that the Management Servers are configured to use. The slave is a
standby node that receives all write operations from the master and
applies them to a local, redundant copy of the database. The following
steps are a guide to implementing MySQL replication.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Creating a replica is not a backup solution. You should develop a backup
procedure for the MySQL data that is distinct from replication.</p>
</div>
<ol class="arabic">
<li><p class="first">Ensure that this is a fresh install with no data in the master.</p>
</li>
<li><p class="first">Edit my.cnf on the master and add the following in the [mysqld]
section below datadir.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">log_bin</span><span class="o">=</span><span class="n">mysql</span><span class="o">-</span><span class="nb">bin</span>
<span class="n">server_id</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>The server_id must be unique with respect to other servers. The
recommended way to achieve this is to give the master an ID of 1 and
each slave a sequential number greater than 1, so that the servers
are numbered 1, 2, 3, etc.</p>
</li>
<li><p class="first">Restart the MySQL service. On RHEL/CentOS systems, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service mysqld restart</span>
</pre></div>
</div>
<p>On Debian/Ubuntu systems, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service mysql restart</span>
</pre></div>
</div>
</li>
<li><p class="first">Create a replication account on the master and give it privileges. We
will use the “cloud-repl” user with the password “password”. This
assumes that master and slave run on the 172.16.1.0/24 network.</p>
<pre class="literal-block">
# mysql -u root
mysql&gt; create user <a class="reference external" href="mailto:'cloud-repl'&#37;&#52;&#48;'172&#46;16&#46;1">'cloud-repl'<span>&#64;</span>'172<span>&#46;</span>16<span>&#46;</span>1</a>.%' identified by 'password';
mysql&gt; grant replication slave on <em>.</em> TO <a class="reference external" href="mailto:'cloud-repl'&#37;&#52;&#48;'172&#46;16&#46;1">'cloud-repl'<span>&#64;</span>'172<span>&#46;</span>16<span>&#46;</span>1</a>.%';
mysql&gt; flush privileges;
mysql&gt; flush tables with read lock;
</pre>
</li>
<li><p class="first">Leave the current MySQL session running.</p>
</li>
<li><p class="first">In a new shell start a second MySQL session.</p>
</li>
<li><p class="first">Retrieve the current position of the database.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mysql -u root</span>
<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">show</span> <span class="n">master</span> <span class="n">status</span><span class="p">;</span>
<span class="o">+------------------+----------+--------------+------------------+</span>
<span class="o">|</span> <span class="n">File</span>             <span class="o">|</span> <span class="n">Position</span> <span class="o">|</span> <span class="n">Binlog_Do_DB</span> <span class="o">|</span> <span class="n">Binlog_Ignore_DB</span> <span class="o">|</span>
<span class="o">+------------------+----------+--------------+------------------+</span>
<span class="o">|</span> <span class="n">mysql</span><span class="o">-</span><span class="nb">bin</span><span class="o">.</span><span class="mi">000001</span> <span class="o">|</span>      <span class="mi">412</span> <span class="o">|</span>              <span class="o">|</span>                  <span class="o">|</span>
<span class="o">+------------------+----------+--------------+------------------+</span>
</pre></div>
</div>
</li>
<li><p class="first">Note the file and the position that are returned by your instance.</p>
</li>
<li><p class="first">Exit from this session.</p>
</li>
<li><p class="first">Complete the master setup. Returning to your first session on the
master, release the locks and exit MySQL.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">unlock</span> <span class="n">tables</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Install and configure the slave. On the slave server, run the
following commands.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum install mysql-server</span>
<span class="c1"># chkconfig mysqld on</span>
</pre></div>
</div>
</li>
<li><p class="first">Edit my.cnf and add the following lines in the [mysqld] section below
datadir.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">server_id</span><span class="o">=</span><span class="mi">2</span>
<span class="n">innodb_rollback_on_timeout</span><span class="o">=</span><span class="mi">1</span>
<span class="n">innodb_lock_wait_timeout</span><span class="o">=</span><span class="mi">600</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart MySQL. Use “mysqld” on RHEL/CentOS systems:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service mysqld restart</span>
</pre></div>
</div>
<p>On Ubuntu/Debian systems use “mysql.”</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service mysql restart</span>
</pre></div>
</div>
</li>
<li><p class="first">Instruct the slave to connect to and replicate from the master.
Replace the IP address, password, log file, and position with the
values you have used in the previous steps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">change</span> <span class="n">master</span> <span class="n">to</span>
    <span class="o">-&gt;</span> <span class="n">master_host</span><span class="o">=</span><span class="s1">&#39;172.16.1.217&#39;</span><span class="p">,</span>
    <span class="o">-&gt;</span> <span class="n">master_user</span><span class="o">=</span><span class="s1">&#39;cloud-repl&#39;</span><span class="p">,</span>
    <span class="o">-&gt;</span> <span class="n">master_password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
    <span class="o">-&gt;</span> <span class="n">master_log_file</span><span class="o">=</span><span class="s1">&#39;mysql-bin.000001&#39;</span><span class="p">,</span>
    <span class="o">-&gt;</span> <span class="n">master_log_pos</span><span class="o">=</span><span class="mi">412</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Then start replication on the slave.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">start</span> <span class="n">slave</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Optionally, open port 3306 on the slave as was done on the master
earlier.</p>
<p>This is not required for replication to work. But if you choose not
to do this, you will need to do it when failover to the replica
occurs.</p>
</li>
</ol>
<div class="section" id="failover">
<h3>Failover<a class="headerlink" href="optional_installation.html#failover" title="Permalink to this headline">¶</a></h3>
<p>This will provide for a replicated database that can be used to
implement manual failover for the Management Servers. CloudStack
failover from one MySQL instance to another is performed by the
administrator. In the event of a database failure you should:</p>
<ol class="arabic">
<li><p class="first">Stop the Management Servers (via service cloudstack-management stop).</p>
</li>
<li><p class="first">Change the replica’s configuration to be a master and restart it.</p>
</li>
<li><p class="first">Ensure that the replica’s port 3306 is open to the Management
Servers.</p>
</li>
<li><p class="first">Make a change so that the 管理服务 uses the new database.
The simplest process here is to put the IP address of the new
database server into each 管理服务’s
/etc/cloudstack/management/db.properties.</p>
</li>
<li><p class="first">Restart the Management Servers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service cloudstack-management start</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="amazon-web-services-interface">
<h2>Amazon Web Services Interface<a class="headerlink" href="optional_installation.html#amazon-web-services-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="amazon-web-services-compatible-interface">
<h3>Amazon Web Services Compatible Interface<a class="headerlink" href="optional_installation.html#amazon-web-services-compatible-interface" title="Permalink to this headline">¶</a></h3>
<p>CloudStack can translate Amazon Web Services (AWS) API calls to native
CloudStack API calls so that users can continue using existing
AWS-compatible tools. This translation service runs as a separate web
application in the same tomcat server as the management server of
CloudStack, listening on a different port. The Amazon Web Services (AWS)
compatible interface provides the EC2 SOAP and Query APIs as well as the
S3 REST API.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This service was previously enabled by separate software called CloudBridge.
It is now fully integrated with the CloudStack management server.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The compatible interface for the EC2 Query API and the S3 API are Work In
Progress. The S3 compatible API offers a way to store data on the
management server file system, it is not an implementation of the S3
backend.</p>
</div>
<p>Limitations</p>
<ul class="simple">
<li>Supported only in zones that use basic networking.</li>
<li>Available in fresh installations of CloudStack. Not available through
upgrade of previous versions.</li>
<li>Features such as Elastic IP (EIP) and Elastic 负载均衡 (ELB)
are only available in an infrastructure with a Citrix NetScaler
device. Users accessing a Zone with a NetScaler device will need to
use a NetScaler-enabled network offering (DefaultSharedNetscalerEIP
and ELBNetworkOffering).</li>
</ul>
</div>
<div class="section" id="supported-api-version">
<h3>Supported API Version<a class="headerlink" href="optional_installation.html#supported-api-version" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The EC2 interface complies with Amazon’s WDSL version dated November
15, 2010, available at <a class="reference external" href="http://ec2.amazonaws.com/doc/2010-11-15/">http://ec2.amazonaws.com/doc/2010-11-15/</a>.</li>
<li>The interface is compatible with the EC2 command-line tools <em>EC2
tools v. 1.3.6230</em>, which can be downloaded at
<a class="reference external" href="http://s3.amazonaws.com/ec2-downloads/ec2-api-tools-1.3-62308.zip">http://s3.amazonaws.com/ec2-downloads/ec2-api-tools-1.3-62308.zip</a>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Work is underway to support a more recent version of the EC2 API</p>
</div>
</div>
<div class="section" id="enabling-the-ec2-and-s3-compatible-interface">
<h3>Enabling the EC2 and S3 Compatible Interface<a class="headerlink" href="optional_installation.html#enabling-the-ec2-and-s3-compatible-interface" title="Permalink to this headline">¶</a></h3>
<p>The software that provides AWS API compatibility is installed along with
CloudStack. You must enable the services and perform some setup steps
prior to using it.</p>
<ol class="arabic">
<li><p class="first">Set the global configuration parameters for each service to true. See
<a class="reference external" href="configuration.html#setting-global-configuration-parameters">*Setting Global Configuration Parameters*</a>.</p>
</li>
<li><p class="first">Create a set of CloudStack service offerings with names that match
the Amazon service offerings. You can do this through the CloudStack
UI as described in the 管理员手册.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be sure you have included the Amazon default service offering, m1.small.
As well as any EC2 instance types that you will use.</p>
</div>
</li>
<li><p class="first">If you did not already do so when you set the configuration parameter
in step 1, restart the 管理服务.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service cloudstack-management restart</span>
</pre></div>
</div>
</li>
</ol>
<p>The following sections provides details to perform these steps</p>
<div class="section" id="enabling-the-services">
<h4>Enabling the Services<a class="headerlink" href="optional_installation.html#enabling-the-services" title="Permalink to this headline">¶</a></h4>
<p>To enable the EC2 and S3 compatible services you need to set the
configuration variables <em>enable.ec2.api</em> and <em>enable.s3.api</em> to true.
You do not have to enable both at the same time. Enable the ones you
need. This can be done via the CloudStack GUI by going in <em>Global
Settings</em> or via the API.</p>
<p>The snapshot below shows you how to use the GUI to enable these services</p>
<p><img alt="Use the GUI to set the configuration variable to true" src="../_images/ec2-s3-configuration.png" /></p>
<p>Using the CloudStack API, the easiest is to use the so-called
integration port on which you can make unauthenticated calls. In Global
Settings set the port to 8096 and subsequently call the
<em>updateConfiguration</em> method. The following urls shows you how:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://localhost:8096/client/api?command=updateConfiguration&amp;name=enable.ec2.api&amp;value=true
http://localhost:8096/client/api?command=updateConfiguration&amp;name=enable.ec2.api&amp;value=true
</pre></div>
</div>
<p>Once you have enabled the services, restart the server.</p>
</div>
<div class="section" id="creating-ec2-compatible-service-offerings">
<h4>Creating EC2 Compatible 计算方案<a class="headerlink" href="optional_installation.html#creating-ec2-compatible-service-offerings" title="Permalink to this headline">¶</a></h4>
<p>You will also need to define compute service offerings with names
compatible with the <a class="reference external" href="http://aws.amazon.com/ec2/instance-types/">Amazon EC2 instance
types</a> API names (e.g
m1.small,m1.large). This can be done via the CloudStack GUI. Go under
<em>计算方案</em> select <em>Compute offering</em> and either create a new
compute offering or modify an existing one, ensuring that the name
matches an EC2 instance type API name. The snapshot below shows you how:</p>
<p><img alt="Use the GUI to set the name of a compute service offering to an EC2 instance type API name." src="../_images/compute-service-offerings.png" /></p>
</div>
<div class="section" id="modifying-the-aws-api-port">
<h4>Modifying the AWS API Port<a class="headerlink" href="optional_installation.html#modifying-the-aws-api-port" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>(Optional) The AWS API listens for requests on port 7080. If you prefer AWS
API to listen on another port, you can change it as follows:</p>
<ol class="last arabic simple">
<li>Edit the files <code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/server.xml</span></code>,
<code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/server-nonssl.xml</span></code>, and
<code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/server-ssl.xml</span></code>.</li>
<li>In each file, find the tag &lt;Service name=”Catalina7080”&gt;. Under this tag, locate &lt;Connector executor=”tomcatThreadPool-internal” port=   ….&lt;.</li>
<li>Change the port to whatever port you want to use, then save the files.</li>
<li>Restart the 管理服务.</li>
</ol>
</div>
<p>If you re-install CloudStack, you will have to re-enable the services
and if need be update the port.</p>
</div>
</div>
<div class="section" id="aws-api-user-setup">
<h3>AWS API User Setup<a class="headerlink" href="optional_installation.html#aws-api-user-setup" title="Permalink to this headline">¶</a></h3>
<p>In general, users need not be aware that they are using a translation
service provided by CloudStack. They only need to send AWS API calls to
CloudStack’s endpoint, and it will translate the calls to the native
CloudStack API. Users of the Amazon EC2 compatible interface will be
able to keep their existing EC2 tools and scripts and use them with
their CloudStack deployment, by specifying the endpoint of the
management server and using the proper user credentials. In order to do
this, each user must perform the following configuration steps:</p>
<ul class="simple">
<li>Generate user credentials.</li>
<li>Register with the service.</li>
<li>For convenience, set up environment variables for the EC2 SOAP
command-line tools.</li>
</ul>
</div>
<div class="section" id="aws-api-command-line-tools-setup">
<h3>AWS API Command-Line Tools Setup<a class="headerlink" href="optional_installation.html#aws-api-command-line-tools-setup" title="Permalink to this headline">¶</a></h3>
<p>To use the EC2 command-line tools, the user must perform these steps:</p>
<ol class="arabic simple">
<li>Be sure you have the right version of EC2 Tools. The supported
version is available at
<a class="reference external" href="http://s3.amazonaws.com/ec2-downloads/ec2-api-tools-1.3-62308.zip">http://s3.amazonaws.com/ec2-downloads/ec2-api-tools-1.3-62308.zip</a>.</li>
<li>Set up the EC2 environment variables. This can be done every time you
use the service or you can set them up in the proper shell profile.
Replace the endpoint (i.e EC2_URL) with the proper address of your
CloudStack management server and port. In a bash shell do the
following.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export EC2_CERT=/path/to/cert.pem
$ export EC2_PRIVATE_KEY=/path/to/private_key.pem
$ export EC2_URL=http://localhost:7080/awsapi
$ export EC2_HOME=/path/to/EC2_tools_directory
</pre></div>
</div>
</div>
<div class="section" id="using-timeouts-to-ensure-aws-api-command-completion">
<h3>Using Timeouts to Ensure AWS API Command Completion<a class="headerlink" href="optional_installation.html#using-timeouts-to-ensure-aws-api-command-completion" title="Permalink to this headline">¶</a></h3>
<p>The Amazon EC2 command-line tools have a default connection timeout.
When used with CloudStack, a longer timeout might be needed for some
commands. If you find that commands are not completing due to timeouts,
you can specify a custom timeouts. You can add the following optional
command-line parameters to any CloudStack-supported EC2 command:</p>
<p>Specifies a connection timeout (in seconds)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">connection</span><span class="o">-</span><span class="n">timeout</span> <span class="n">TIMEOUT</span>
</pre></div>
</div>
<p>Specifies a request timeout (in seconds)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">request</span><span class="o">-</span><span class="n">timeout</span> <span class="n">TIMEOUT</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ec2-run-instances 2 –z us-test1 –n 1-3 --connection-timeout 120 --request-timeout 120
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The timeouts optional arguments are not specific to CloudStack.</p>
</div>
</div>
<div class="section" id="supported-aws-api-calls">
<h3>Supported AWS API Calls<a class="headerlink" href="optional_installation.html#supported-aws-api-calls" title="Permalink to this headline">¶</a></h3>
<p>The following Amazon EC2 commands are supported by CloudStack when the
AWS API compatible interface is enabled. For a few commands, there are
differences between the CloudStack and Amazon EC2 versions, and these
differences are noted. The underlying SOAP call for each command is also
given, for those who have built tools using those calls.</p>
<p>Table&nbsp;1.&nbsp;Elastic IP API mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="36%" />
<col width="31%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-allocate-address</td>
<td>AllocateAddress</td>
<td>associateIpAddress</td>
</tr>
<tr class="row-odd"><td>ec2-associate-address</td>
<td>AssociateAddress</td>
<td>enableStaticNat</td>
</tr>
<tr class="row-even"><td>ec2-describe-addresses</td>
<td>DescribeAddresses</td>
<td>listPublicIpAddresses</td>
</tr>
<tr class="row-odd"><td>ec2-diassociate-address</td>
<td>DisassociateAddress</td>
<td>disableStaticNat</td>
</tr>
<tr class="row-even"><td>ec2-release-address</td>
<td>ReleaseAddress</td>
<td>disassociateIpAddress</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;2.&nbsp;Availability Zone API mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="40%" />
<col width="33%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-describe-availability-zones</td>
<td>DescribeAvailabilityZones</td>
<td>listZones</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;3.&nbsp;Images API mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="35%" />
<col width="29%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-create-image</td>
<td>CreateImage</td>
<td>createTemplate</td>
</tr>
<tr class="row-odd"><td>ec2-deregister</td>
<td>DeregisterImage</td>
<td>DeleteTemplate</td>
</tr>
<tr class="row-even"><td>ec2-describe-images</td>
<td>DescribeImages</td>
<td>listTemplates</td>
</tr>
<tr class="row-odd"><td>ec2-register</td>
<td>RegisterImage</td>
<td>registerTemplate</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;4.&nbsp;Image Attributes API mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="37%" />
<col width="30%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-describe-image-attribute</td>
<td>DescribeImageAttribute</td>
<td>listTemplatePermissions</td>
</tr>
<tr class="row-odd"><td>ec2-modify-image-attribute</td>
<td>ModifyImageAttribute</td>
<td>updateTemplatePermissions</td>
</tr>
<tr class="row-even"><td>ec2-reset-image-attribute</td>
<td>ResetImageAttribute</td>
<td>updateTemplatePermissions</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;5.&nbsp;Instances API mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="36%" />
<col width="30%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-describe-instances</td>
<td>DescribeInstances</td>
<td>listVirtualMachines</td>
</tr>
<tr class="row-odd"><td>ec2-run-instances</td>
<td>RunInstances</td>
<td>deployVirtualMachine</td>
</tr>
<tr class="row-even"><td>ec2-reboot-instances</td>
<td>RebootInstances</td>
<td>rebootVirtualMachine</td>
</tr>
<tr class="row-odd"><td>ec2-start-instances</td>
<td>StartInstances</td>
<td>startVirtualMachine</td>
</tr>
<tr class="row-even"><td>ec2-stop-instances</td>
<td>StopInstances</td>
<td>stopVirtualMachine</td>
</tr>
<tr class="row-odd"><td>ec2-terminate-instances</td>
<td>TerminateInstances</td>
<td>destroyVirtualMachine</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;6.&nbsp;Instance Attributes Mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="40%" />
<col width="33%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-describe-instance-attribute</td>
<td>DescribeInstanceAttribute</td>
<td>listVirtualMachines</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;7.&nbsp;Keys Pairs Mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="37%" />
<col width="29%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-add-keypair</td>
<td>CreateKeyPair</td>
<td>createSSHKeyPair</td>
</tr>
<tr class="row-odd"><td>ec2-delete-keypair</td>
<td>DeleteKeyPair</td>
<td>deleteSSHKeyPair</td>
</tr>
<tr class="row-even"><td>ec2-describe-keypairs</td>
<td>DescribeKeyPairs</td>
<td>listSSHKeyPairs</td>
</tr>
<tr class="row-odd"><td>ec2-import-keypair</td>
<td>ImportKeyPair</td>
<td>registerSSHKeyPair</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;8.&nbsp;Passwords API Mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="32%" />
<col width="31%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-get-password</td>
<td>GetPasswordData</td>
<td>getVMPassword</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;9.&nbsp;安全组 API Mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="25%" />
<col width="38%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-authorize</td>
<td>Authorize安全GroupIngress</td>
<td>authorize安全GroupIngress</td>
</tr>
<tr class="row-odd"><td>ec2-add-group</td>
<td>Create安全Group</td>
<td>create安全Group</td>
</tr>
<tr class="row-even"><td>ec2-delete-group</td>
<td>Delete安全Group</td>
<td>delete安全Group</td>
</tr>
<tr class="row-odd"><td>ec2-describe-group</td>
<td>Describe安全Groups</td>
<td>list安全Groups</td>
</tr>
<tr class="row-even"><td>ec2-revoke</td>
<td>Revoke安全GroupIngress</td>
<td>revoke安全GroupIngress</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;10.&nbsp;Snapshots API Mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="37%" />
<col width="30%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-create-snapshot</td>
<td>CreateSnapshot</td>
<td>createSnapshot</td>
</tr>
<tr class="row-odd"><td>ec2-delete-snapshot</td>
<td>DeleteSnapshot</td>
<td>deleteSnapshot</td>
</tr>
<tr class="row-even"><td>ec2-describe-snapshots</td>
<td>DescribeSnapshots</td>
<td>listSnapshots</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Table&nbsp;11.&nbsp;Volumes API Mapping</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="36%" />
<col width="28%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">EC2 command</th>
<th class="head">SOAP call</th>
<th class="head">CloudStack API call</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ec2-attach-volume</td>
<td>AttachVolume</td>
<td>attachVolume</td>
</tr>
<tr class="row-odd"><td>ec2-create-volume</td>
<td>CreateVolume</td>
<td>createVolume</td>
</tr>
<tr class="row-even"><td>ec2-delete-volume</td>
<td>DeleteVolume</td>
<td>deleteVolume</td>
</tr>
<tr class="row-odd"><td>ec2-describe-volume</td>
<td>DescribeVolume</td>
<td>listVolumes</td>
</tr>
<tr class="row-even"><td>ec2-detach-volume</td>
<td>DetachVolume</td>
<td>detachVolume</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="optional_installation.html#examples" title="Permalink to this headline">¶</a></h3>
<p>There are many tools available to interface with a AWS compatible API.
In this section we provide a few examples that users of CloudStack can
build upon.</p>
<div class="section" id="boto-examples">
<h4>Boto Examples<a class="headerlink" href="optional_installation.html#boto-examples" title="Permalink to this headline">¶</a></h4>
<p>Boto is one of them. It is a Python package available at
<a class="reference external" href="https://github.com/boto/boto">https://github.com/boto/boto</a>. In this section we provide two examples of
Python scripts that use Boto and have been tested with the CloudStack
AWS API Interface.</p>
<p>First is an EC2 example. Replace the Access and Secret Keys with your
own and update the endpoint.</p>
<p>Example&nbsp;1.&nbsp;An EC2 Boto example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">boto</span>
<span class="kn">import</span> <span class="nn">boto.ec2</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">ec2</span><span class="o">.</span><span class="n">regioninfo</span><span class="o">.</span><span class="n">RegionInfo</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ROOT&quot;</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">)</span>
<span class="n">apikey</span><span class="o">=</span><span class="s1">&#39;GwNnpUPrO6KgIdZu01z_ZhhZnKjtSdRwuYd4DvpzvFpyxGMvrzno2q05MB0ViBoFYtdqKd&#39;</span>
<span class="n">secretkey</span><span class="o">=</span><span class="s1">&#39;t4eXLEYWw7chBhDlaKf38adCMSHx_wlds6JfSx3z9fSpSOm0AbP9Moj0oGIzy2LSC8iw&#39;</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Establish connection to EC2 cloud&#39;&#39;&#39;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">boto</span><span class="o">.</span><span class="n">connect_ec2</span><span class="p">(</span><span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">apikey</span><span class="p">,</span>
                            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">secretkey</span><span class="p">,</span>
                            <span class="n">is_secure</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                            <span class="n">port</span><span class="o">=</span><span class="mi">7080</span><span class="p">,</span>
                            <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/awsapi&quot;</span><span class="p">,</span>
                            <span class="n">api_version</span><span class="o">=</span><span class="s2">&quot;2010-11-15&quot;</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;Get list of images that I own&#39;&#39;&#39;</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_all_images</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">images</span>
    <span class="n">myimage</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="sd">&#39;&#39;&#39;Pick an instance type&#39;&#39;&#39;</span>
    <span class="n">vm_type</span><span class="o">=</span><span class="s1">&#39;m1.small&#39;</span>
    <span class="n">reservation</span> <span class="o">=</span> <span class="n">myimage</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">instance_type</span><span class="o">=</span><span class="n">vm_type</span><span class="p">,</span><span class="n">security_groups</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
     <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Second is an S3 example. The S3 interface in CloudStack is obsolete. If you need an S3 interface you should look at systems like RiakCS, Ceph or GlusterFS. This example is here for completeness and can be adapted to other S3 endpoint.</p>
<p>Example&nbsp;2.&nbsp;An S3 Boto Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">boto.s3.key</span> <span class="kn">import</span> <span class="n">Key</span>
<span class="kn">from</span> <span class="nn">boto.s3.connection</span> <span class="kn">import</span> <span class="n">S3Connection</span>
<span class="kn">from</span> <span class="nn">boto.s3.connection</span> <span class="kn">import</span> <span class="n">OrdinaryCallingFormat</span>

<span class="n">apikey</span><span class="o">=</span><span class="s1">&#39;ChOw-pwdcCFy6fpeyv6kUaR0NnhzmG3tE7HLN2z3OB_s-ogF5HjZtN4rnzKnq2UjtnHeg_yLA5gOw&#39;</span>
<span class="n">secretkey</span><span class="o">=</span><span class="s1">&#39;IMY8R7CJQiSGFk4cHwfXXN3DUFXz07cCiU80eM3MCmfLs7kusgyOfm0g9qzXRXhoAPCH-IRxXc3w&#39;</span>

<span class="n">cf</span><span class="o">=</span><span class="n">OrdinaryCallingFormat</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Establish connection to S3 service&#39;&#39;&#39;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">S3Connection</span><span class="p">(</span><span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">apikey</span><span class="p">,</span><span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">secretkey</span><span class="p">,</span> \
                        <span class="n">is_secure</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> \
                        <span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> \
                        <span class="n">port</span><span class="o">=</span><span class="mi">7080</span><span class="p">,</span> \
                        <span class="n">calling_format</span><span class="o">=</span><span class="n">cf</span><span class="p">,</span> \
                        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;/awsapi/rest/AmazonS3&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">bucket</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="s1">&#39;cloudstack&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k</span><span class="o">.</span><span class="n">set_contents_from_filename</span><span class="p">(</span><span class="s1">&#39;/Users/runseb/Desktop/s3cs.py&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;could not write file&#39;</span>
            <span class="k">pass</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s1">&#39;cloudstack&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k</span><span class="o">.</span><span class="n">get_contents_to_filename</span><span class="p">(</span><span class="s1">&#39;/Users/runseb/Desktop/foobar&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Could not get file&#39;</span>
            <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">bucket1</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="s1">&#39;teststring&#39;</span><span class="p">)</span>
        <span class="n">k</span><span class="o">=</span><span class="n">Key</span><span class="p">(</span><span class="n">bucket1</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">set_contents_from_string</span><span class="p">(</span><span class="s1">&#39;This is my silly test&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">bucket1</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="s1">&#39;teststring&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">bucket1</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;foobar&#39;</span>
        <span class="n">k</span><span class="o">.</span><span class="n">get_contents_as_string</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="encryption.html" class="btn btn-neutral float-right" title="密码和加密密钥" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="hypervisor/xenserver.html" class="btn btn-neutral float-left" title="Citrix XenServer 安装" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Foundation
      
        <span class="commit">
          Revision <code>7c5c9b49</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 4.11.3.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../../4.12.0.0/index.html">4.12.0.0</a></dd>
        
          <dd><a href="../index.html">4.11.3.0</a></dd>
        
          <dd><a href="../../4.11.2.0/index.html">4.11.2.0</a></dd>
        
          <dd><a href="../../4.11.1.0/index.html">4.11.1.0</a></dd>
        
          <dd><a href="http://docs.cloudstack.apache.org/en/master/">master</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/cloudstack-documentation/?fromdocs=cloudstack-documentation">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/cloudstack-documentation/?fromdocs=cloudstack-documentation">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>