

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>使用标签管理云上的资源 &mdash; Apache CloudStack 4.13.0.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
        <script type="text/javascript" src="../static/jquery.js"></script>
        <script type="text/javascript" src="../static/underscore.js"></script>
        <script type="text/javascript" src="../static/doctools.js"></script>
        <script type="text/javascript" src="../static/language_data.js"></script>
        <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="管理服务高可用" href="reliability.html" />
    <link rel="prev" title="Using Remote Access VPN" href="networking/using_remote_access.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="management.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "adminguide/management"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache CloudStack
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conceptsandterminology/index.html">CloudStack 概念和术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickinstallationguide/qig.html">快速入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installguide/index.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">升级 CloudStack</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">使用手册</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#user-interface">用户界面</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#managing-accounts-users-and-domains">账户、用户和域</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-projects-to-organize-user-resources">用项目来管理用户资源</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#service-offerings">计算方案</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#setting-up-networking-for-users">设置用户网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-virtual-machines">虚拟机</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-templates">模板</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-hosts">主机</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-storage">存储</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-system-virtual-machines">系统虚拟机</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-usage">Working with Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#managing-networks-and-traffic">Managing Networks and Traffic</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#managing-the-cloud">管理云</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="management.html#">使用标签管理云上的资源</a></li>
<li class="toctree-l3"><a class="reference internal" href="management.html#reporting-cpu-sockets">Reporting CPU Sockets</a></li>
<li class="toctree-l3"><a class="reference internal" href="management.html#changing-the-database-configuration">修改数据库设置</a></li>
<li class="toctree-l3"><a class="reference internal" href="management.html#changing-the-database-password">修改数据库密码</a></li>
<li class="toctree-l3"><a class="reference internal" href="management.html#file-encryption-type">File encryption type</a></li>
<li class="toctree-l3"><a class="reference internal" href="management.html#administrator-alerts">Administrator Alerts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="management.html#sending-alerts-to-external-snmp-and-syslog-managers">Sending Alerts to External SNMP and Syslog Managers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="management.html#customizing-the-network-domain-name">Customizing the Network Domain Name</a></li>
<li class="toctree-l3"><a class="reference internal" href="management.html#stopping-and-restarting-the-management-server">停止和重启管理服务</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#system-reliability-and-availability">系统的可靠性和可用性</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tuning">调优</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#events-and-troubleshooting">Events and Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developersguide/index.html">开发者手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">插件使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">发行版本说明</a></li>
</ul>
<p class="caption"><span class="caption-text">其它:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/api.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Home">Apache CloudStack Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/">Apache CloudStack 官网</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache CloudStack 源码</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/cloudstack">Apache CloudStack on GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre 4.11 Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-administration.html">管理员手册</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-release-notes.html">发行版本说明</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CloudStack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">使用手册</a> &raquo;</li>
        
      <li>使用标签管理云上的资源</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/cloudstack-documentation/blob/4.13.0.0/source/adminguide/management.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-tags-to-organize-resources-in-the-cloud">
<h1>使用标签管理云上的资源<a class="headerlink" href="management.html#using-tags-to-organize-resources-in-the-cloud" title="Permalink to this headline">¶</a></h1>
<p>A tag is a key-value pair that stores metadata about a resource in the
cloud. Tags are useful for categorizing resources. For example, you can
tag a user VM with a value that indicates the user’s city of residence.
In this case, the key would be “city” and the value might be “Toronto”
or “Tokyo.” You can then request CloudStack to find all resources that
have a given tag; for example, VMs for users in a given city.</p>
<p>You can tag a user virtual machine, volume, snapshot, guest network,
template, ISO, firewall rule, port forwarding rule, public IP address,
security group, load balancer rule, project, VPC, network ACL, or static
route. You can not tag a remote access VPN.</p>
<p>You can work with tags through the UI or through the API commands
createTags, deleteTags, and listTags. You can define multiple tags for
each resource. There is no limit on the number of tags you can define.
Each tag can be up to 255 characters long. Users can define tags on the
resources they own, and administrators can define tags on any resources
in the cloud.</p>
<p>An optional input parameter, “tags,” exists on many of the list* API
commands. The following example shows how to use this new parameter to
find all the volumes having tag region=canada OR tag city=Toronto:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command</span><span class="o">=</span><span class="n">listVolumes</span>
   <span class="o">&amp;</span><span class="n">listAll</span><span class="o">=</span><span class="n">true</span>
   <span class="o">&amp;</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">region</span>
   <span class="o">&amp;</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">canada</span>
   <span class="o">&amp;</span><span class="n">tags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">city</span>
   <span class="o">&amp;</span><span class="n">tags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">Toronto</span>
</pre></div>
</div>
<p>The following API commands have the “tags” input parameter:</p>
<ul class="simple">
<li>listVirtualMachines</li>
<li>listVolumes</li>
<li>listSnapshots</li>
<li>listNetworks</li>
<li>listTemplates</li>
<li>listIsos</li>
<li>listFirewallRules</li>
<li>listPortForwardingRules</li>
<li>listPublicIpAddresses</li>
<li>list安全Groups</li>
<li>listLoadBalancerRules</li>
<li>listProjects</li>
<li>listVPCs</li>
<li>listNetworkACLs</li>
<li>listStaticRoutes</li>
</ul>
</div>
<div class="section" id="reporting-cpu-sockets">
<h1>Reporting CPU Sockets<a class="headerlink" href="management.html#reporting-cpu-sockets" title="Permalink to this headline">¶</a></h1>
<p>PRODUCT manages different types of hosts that contains one or more
physical CPU sockets. CPU socket is considered as a unit of measure used
for licensing and billing cloud infrastructure. PRODUCT provides both UI
and API support to collect the CPU socket statistics for billing
purpose. The Infrastructure tab has a new tab for CPU sockets. You can
view the statistics for CPU sockets managed by PRODUCT, which in turn
reflects the size of the cloud. The CPU Socket page will give you the
number of hosts and sockets used for each host type.</p>
<ol class="arabic">
<li><p class="first">Log in to the PRODUCT UI.</p>
</li>
<li><p class="first">In the left navigation bar, click Infrastructure.</p>
</li>
<li><p class="first">On CPU Sockets, click View all.</p>
<p>The CPU Socket page is displayed. The page shows the number of hosts
and CPU sockets based on hypervisor types.</p>
</li>
</ol>
</div>
<div class="section" id="changing-the-database-configuration">
<h1>修改数据库设置<a class="headerlink" href="management.html#changing-the-database-configuration" title="Permalink to this headline">¶</a></h1>
<p>The CloudStack 管理服务 stores database configuration
information (e.g., hostname, port, credentials) in the file
<code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/db.properties</span></code>. To effect a change, edit
this file on each 管理服务, then restart the 管理服务.</p>
</div>
<div class="section" id="changing-the-database-password">
<h1>修改数据库密码<a class="headerlink" href="management.html#changing-the-database-password" title="Permalink to this headline">¶</a></h1>
<p>You may need to change the password for the MySQL account used by
CloudStack. If so, you’ll need to change the password in MySQL, and then
add the encrypted password to
<code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/db.properties</span></code>.</p>
<ol class="arabic">
<li><p class="first">Before changing the password, you’ll need to stop CloudStack’s
management server and the usage engine if you’ve deployed that
component.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service cloudstack-management stop</span>
<span class="c1"># service cloudstack-usage stop</span>
</pre></div>
</div>
</li>
<li><p class="first">Next, you’ll update the password for the CloudStack user on the MySQL
server.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># mysql -u root -p</span>
</pre></div>
</div>
<p>At the MySQL shell, you’ll change the password and flush privileges:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">update</span> <span class="n">mysql</span><span class="o">.</span><span class="n">user</span> <span class="nb">set</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">(</span><span class="s2">&quot;newpassword123&quot;</span><span class="p">)</span> <span class="n">where</span> <span class="n">User</span><span class="o">=</span><span class="s1">&#39;cloud&#39;</span><span class="p">;</span>
<span class="n">flush</span> <span class="n">privileges</span><span class="p">;</span>
<span class="n">quit</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">The next step is to encrypt the password and copy the encrypted
password to CloudStack’s database configuration
(<code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/db.properties</span></code>).</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># java -classpath /usr/share/cloudstack-common/lib/jasypt-1.9.2.jar \ org.jasypt.intf.cli.JasyptPBEStringEncryptionCLI encrypt.sh \ input=&quot;newpassword123&quot; password=&quot;`cat /etc/cloudstack/management/key`&quot; \ verbose=false</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="file-encryption-type">
<h1>File encryption type<a class="headerlink" href="management.html#file-encryption-type" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>Note that this is for the file encryption type. If you’re using the
web encryption type then you’ll use
password=”management_server_secret_key”</div></blockquote>
<ol class="arabic">
<li><p class="first">Now, you’ll update <code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/db.properties</span></code> with
the new ciphertext. Open <code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/db.properties</span></code>
in a text editor, and update these parameters:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">ENC</span><span class="p">(</span><span class="n">encrypted_password_from_above</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">password</span><span class="o">=</span><span class="n">ENC</span><span class="p">(</span><span class="n">encrypted_password_from_above</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">After copying the new password over, you can now start CloudStack
(and the usage engine, if necessary).</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service cloudstack-management start</span>
<span class="c1"># service cloud-usage start</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="administrator-alerts">
<h1>Administrator Alerts<a class="headerlink" href="management.html#administrator-alerts" title="Permalink to this headline">¶</a></h1>
<p>The system provides alerts and events to help with the management of the
cloud. Alerts are notices to an administrator, generally delivered by
e-mail, notifying the administrator that an error has occurred in the
cloud. Alert behavior is configurable.</p>
<p>Events track all of the user and administrator actions in the cloud. For
example, every guest VM start creates an associated event. Events are
stored in the 管理服务’s database.</p>
<p>Emails will be sent to administrators under the following circumstances:</p>
<ul class="simple">
<li>The 管理服务 cluster runs low on CPU, memory, or storage
resources</li>
<li>The 管理服务 loses heartbeat from a Host for more than 3
minutes</li>
<li>The Host cluster runs low on CPU, memory, or storage resources</li>
</ul>
<div class="section" id="sending-alerts-to-external-snmp-and-syslog-managers">
<h2>Sending Alerts to External SNMP and Syslog Managers<a class="headerlink" href="management.html#sending-alerts-to-external-snmp-and-syslog-managers" title="Permalink to this headline">¶</a></h2>
<p>In addition to showing administrator alerts on the Dashboard in the
CloudStack UI and sending them in email, CloudStack can also send the
same alerts to external SNMP or Syslog management software. This is
useful if you prefer to use an SNMP or Syslog manager to monitor your
cloud.</p>
<p>The alerts which can be sent are:</p>
<p>The following is the list of alert type numbers. The current alerts can
be found by calling listAlerts.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MEMORY</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">//</span> <span class="n">Available</span> <span class="n">Memory</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">//</span> <span class="n">Unallocated</span> <span class="n">CPU</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STORAGE</span> <span class="o">=</span><span class="mi">2</span> <span class="o">//</span> <span class="n">Available</span> <span class="n">Storage</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STORAGE_ALLOCATED</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">//</span> <span class="n">Remaining</span> <span class="n">unallocated</span> <span class="n">Storage</span> <span class="ow">is</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PUBLIC_IP</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">//</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">unallocated</span> <span class="n">virtual</span> <span class="n">network</span> <span class="n">public</span> <span class="n">IPs</span> <span class="ow">is</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PRIVATE_IP</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">//</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">unallocated</span> <span class="n">private</span> <span class="n">IPs</span> <span class="ow">is</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SECONDARY_STORAGE</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">//</span>  <span class="n">Available</span> <span class="n">Secondary</span> <span class="n">Storage</span> <span class="ow">in</span> <span class="n">availability</span> <span class="n">zone</span> <span class="ow">is</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HOST</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">//</span> <span class="n">Host</span> <span class="n">related</span> <span class="n">alerts</span> <span class="n">like</span> <span class="n">host</span> <span class="n">disconnected</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USERVM</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">//</span> <span class="n">User</span> <span class="n">VM</span> <span class="n">stopped</span> <span class="n">unexpectedly</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DOMAIN_ROUTER</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">//</span> <span class="n">Domain</span> <span class="n">Router</span> <span class="n">VM</span> <span class="n">stopped</span> <span class="n">unexpectedly</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONSOLE_PROXY</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">//</span> <span class="n">Console</span> <span class="n">Proxy</span> <span class="n">VM</span> <span class="n">stopped</span> <span class="n">unexpectedly</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ROUTING</span> <span class="o">=</span> <span class="mi">11</span> <span class="o">//</span> <span class="n">Lost</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">default</span> <span class="n">route</span> <span class="p">(</span><span class="n">to</span> <span class="n">the</span> <span class="n">gateway</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STORAGE_MISC</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">//</span> <span class="n">Storage</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">system</span> <span class="n">VMs</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USAGE_SERVER</span> <span class="o">=</span> <span class="mi">13</span> <span class="o">//</span> <span class="n">No</span> <span class="n">usage</span> <span class="n">server</span> <span class="n">process</span> <span class="n">running</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MANAGMENT_NODE</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">//</span> <span class="n">Management</span> <span class="n">network</span> <span class="n">CIDR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">configured</span> <span class="n">originally</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DOMAIN_ROUTER_MIGRATE</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">//</span> <span class="n">Domain</span> <span class="n">Router</span> <span class="n">VM</span> <span class="n">Migration</span> <span class="n">was</span> <span class="n">unsuccessful</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONSOLE_PROXY_MIGRATE</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">//</span> <span class="n">Console</span> <span class="n">Proxy</span> <span class="n">VM</span> <span class="n">Migration</span> <span class="n">was</span> <span class="n">unsuccessful</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USERVM_MIGRATE</span> <span class="o">=</span> <span class="mi">17</span> <span class="o">//</span> <span class="n">User</span> <span class="n">VM</span> <span class="n">Migration</span> <span class="n">was</span> <span class="n">unsuccessful</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VLAN</span> <span class="o">=</span> <span class="mi">18</span> <span class="o">//</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">unallocated</span> <span class="n">VLANs</span> <span class="ow">is</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">availability</span> <span class="n">zone</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SSVM</span> <span class="o">=</span> <span class="mi">19</span> <span class="o">//</span> <span class="n">SSVM</span> <span class="n">stopped</span> <span class="n">unexpectedly</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USAGE_SERVER_RESULT</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">//</span> <span class="n">Usage</span> <span class="n">job</span> <span class="n">failed</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STORAGE_DELETE</span> <span class="o">=</span> <span class="mi">21</span> <span class="o">//</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">delete</span> <span class="n">storage</span> <span class="n">pool</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE_RESOURCE_COUNT</span> <span class="o">=</span> <span class="mi">22</span> <span class="o">//</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">update</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">count</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USAGE_SANITY_RESULT</span> <span class="o">=</span> <span class="mi">23</span> <span class="o">//</span> <span class="n">Usage</span> <span class="n">Sanity</span> <span class="n">Check</span> <span class="n">failed</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DIRECT_ATTACHED_PUBLIC_IP</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">//</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">unallocated</span> <span class="n">shared</span> <span class="n">network</span> <span class="n">IPs</span> <span class="ow">is</span> <span class="n">low</span> <span class="ow">in</span> <span class="n">availability</span> <span class="n">zone</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOCAL_STORAGE</span> <span class="o">=</span> <span class="mi">25</span> <span class="o">//</span> <span class="n">Remaining</span> <span class="n">unallocated</span> <span class="n">Local</span> <span class="n">Storage</span> <span class="ow">is</span> <span class="n">below</span> <span class="n">configured</span> <span class="n">threshold</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RESOURCE_LIMIT_EXCEEDED</span> <span class="o">=</span> <span class="mi">26</span> <span class="o">//</span><span class="n">Generated</span> <span class="n">when</span> <span class="n">the</span> <span class="n">resource</span> <span class="n">limit</span> <span class="n">exceeds</span> <span class="n">the</span> <span class="n">limit</span><span class="o">.</span> <span class="n">Currently</span> <span class="n">used</span> <span class="k">for</span> <span class="n">recurring</span> <span class="n">snapshots</span> <span class="n">only</span>
</pre></div>
</div>
<p>You can also display the most up to date list by calling the API command <code class="docutils literal notranslate"><span class="pre">listAlerts</span></code>.</p>
<div class="section" id="snmp-alert-details">
<h3>SNMP Alert Details<a class="headerlink" href="management.html#snmp-alert-details" title="Permalink to this headline">¶</a></h3>
<p>The supported protocol is SNMP version 2.</p>
<p>Each SNMP trap contains the following information: message, podId,
dataCenterId, clusterId, and generationTime.</p>
</div>
<div class="section" id="syslog-alert-details">
<h3>Syslog Alert Details<a class="headerlink" href="management.html#syslog-alert-details" title="Permalink to this headline">¶</a></h3>
<p>CloudStack generates a syslog message for every alert. Each syslog
message incudes the fields alertType, message, podId, dataCenterId, and
clusterId, in the following format. If any field does not have a valid
value, it will not be included.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Date</span> <span class="n">severity_level</span> <span class="n">Management_Server_IP_Address</span><span class="o">/</span><span class="n">Name</span>  <span class="n">alertType</span><span class="p">::</span> <span class="n">value</span> <span class="n">dataCenterId</span><span class="p">::</span> <span class="n">value</span>  <span class="n">podId</span><span class="p">::</span> <span class="n">value</span>  <span class="n">clusterId</span><span class="p">::</span> <span class="n">value</span>  <span class="n">message</span><span class="p">::</span> <span class="n">value</span>
</pre></div>
</div>
<p>For example:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Mar</span>  <span class="mi">4</span> <span class="mi">10</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">47</span>    <span class="n">WARN</span>    <span class="n">localhost</span>    <span class="n">alertType</span><span class="p">::</span> <span class="n">managementNode</span> <span class="n">message</span><span class="p">::</span> <span class="n">Management</span> <span class="n">server</span> <span class="n">node</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="ow">is</span> <span class="n">up</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-snmp-and-syslog-managers">
<h3>Configuring SNMP and Syslog Managers<a class="headerlink" href="management.html#configuring-snmp-and-syslog-managers" title="Permalink to this headline">¶</a></h3>
<p>To configure one or more SNMP managers or Syslog managers to receive
alerts from CloudStack:</p>
<ol class="arabic">
<li><p class="first">For an SNMP manager, install the CloudStack MIB file on your SNMP
manager system. This maps the SNMP OIDs to trap types that can be
more easily read by users. The file must be publicly available. For
more information on how to install this file, consult the
documentation provided with the SNMP manager.</p>
</li>
<li><p class="first">Edit the file /etc/cloudstack/management/log4j-cloud.xml.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># vi /etc/cloudstack/management/log4j-cloud.xml</span>
</pre></div>
</div>
</li>
<li><p class="first">Add an entry using the syntax shown below. Follow the appropriate
example depending on whether you are adding an SNMP manager or a
Syslog manager. To specify multiple external managers, separate the
IP addresses and other configuration values with commas (,).</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">The recommended maximum number of SNMP or Syslog managers is 20
for each.</p>
</div>
<p>The following example shows how to configure two SNMP managers at IP
addresses 10.1.1.1 and 10.1.1.2. Substitute your own IP addresses,
ports, and communities. Do not change the other values (name,
threshold, class, and layout values).</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;appender name=&quot;SNMP&quot; class=&quot;org.apache.cloudstack.alert.snmp.SnmpTrapAppender&quot;&gt;
  &lt;param name=&quot;Threshold&quot; value=&quot;WARN&quot;/&gt;  &lt;!-- Do not edit. The alert feature assumes WARN. --&gt;
  &lt;param name=&quot;SnmpManagerIpAddresses&quot; value=&quot;10.1.1.1,10.1.1.2&quot;/&gt;
  &lt;param name=&quot;SnmpManagerPorts&quot; value=&quot;162,162&quot;/&gt;
  &lt;param name=&quot;SnmpManagerCommunities&quot; value=&quot;public,public&quot;/&gt;
  &lt;layout class=&quot;org.apache.cloudstack.alert.snmp.SnmpEnhancedPatternLayout&quot;&gt; &lt;!-- Do not edit --&gt;
    &lt;param name=&quot;PairDelimeter&quot; value=&quot;//&quot;/&gt;
    &lt;param name=&quot;KeyValueDelimeter&quot; value=&quot;::&quot;/&gt;
  &lt;/layout&gt;
&lt;/appender&gt;
</pre></div>
</div>
<p>The following example shows how to configure two Syslog managers at
IP addresses 10.1.1.1 and 10.1.1.2. Substitute your own IP addresses.
You can set Facility to any syslog-defined value, such as LOCAL0 -
LOCAL7. Do not change the other values.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">appender</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ALERTSYSLOG&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Threshold&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;WARN&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;SyslogHosts&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;10.1.1.1,10.1.1.2&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Facility&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;LOCAL6&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">layout</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ConversionPattern&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">layout</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">appender</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">If your cloud has multiple 管理服务 nodes, repeat these
steps to edit log4j-cloud.xml on every instance.</p>
</li>
<li><p class="first">If you have made these changes while the 管理服务 is
running, wait a few minutes for the change to take effect.</p>
</li>
</ol>
<p><strong>Troubleshooting:</strong> If no alerts appear at the configured SNMP or
Syslog manager after a reasonable amount of time, it is likely that
there is an error in the syntax of the &lt;appender&gt; entry in
log4j-cloud.xml. Check to be sure that the format and settings are
correct.</p>
</div>
<div class="section" id="deleting-an-snmp-or-syslog-manager">
<h3>Deleting an SNMP or Syslog Manager<a class="headerlink" href="management.html#deleting-an-snmp-or-syslog-manager" title="Permalink to this headline">¶</a></h3>
<p>To remove an external SNMP manager or Syslog manager so that it no
longer receives alerts from CloudStack, remove the corresponding entry
from the file <code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/log4j-cloud.xml</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="customizing-the-network-domain-name">
<h1>Customizing the Network Domain Name<a class="headerlink" href="management.html#customizing-the-network-domain-name" title="Permalink to this headline">¶</a></h1>
<p>The root administrator can optionally assign a custom DNS suffix at the
level of a network, account, domain, zone, or entire CloudStack
installation, and a domain administrator can do so within their own
domain. To specify a custom domain name and put it into effect, follow
these steps.</p>
<ol class="arabic simple">
<li>Set the DNS suffix at the desired scope<ul>
<li>At the network level, the DNS suffix can be assigned through the
UI when creating a new network, as described in
<a class="reference external" href="http://docs.cloudstack.apache.org/en/latest/adminguide/networking2#adding-an-additional-guest-network">“Adding an Additional Guest Network”</a> or with the
updateNetwork command in the CloudStack API.</li>
<li>At the account, domain, or zone level, the DNS suffix can be
assigned with the appropriate CloudStack API commands:
createAccount, editAccount, createDomain, editDomain, createZone,
or editZone.</li>
<li>At the global level, use the configuration parameter
guest.domain.suffix. You can also use the CloudStack API command
updateConfiguration. After modifying this global configuration,
restart the 管理服务 to put the new setting into effect.</li>
</ul>
</li>
<li>To make the new DNS suffix take effect for an existing network, call
the CloudStack API command updateNetwork. This step is not necessary
when the DNS suffix was specified while creating a new network.</li>
</ol>
<p>The source of the network domain that is used depends on the following
rules.</p>
<ul class="simple">
<li>For all networks, if a network domain is specified as part of a
network’s own configuration, that value is used.</li>
<li>For an account-specific network, the network domain specified for the
account is used. If none is specified, the system looks for a value
in the domain, zone, and global configuration, in that order.</li>
<li>For a domain-specific network, the network domain specified for the
domain is used. If none is specified, the system looks for a value in
the zone and global configuration, in that order.</li>
<li>For a zone-specific network, the network domain specified for the
zone is used. If none is specified, the system looks for a value in
the global configuration.</li>
</ul>
</div>
<div class="section" id="stopping-and-restarting-the-management-server">
<h1>停止和重启管理服务<a class="headerlink" href="management.html#stopping-and-restarting-the-management-server" title="Permalink to this headline">¶</a></h1>
<p>The root administrator will need to stop and restart the Management
Server from time to time.</p>
<p>For example, after changing a global configuration parameter, a restart
is required. If you have multiple 管理服务 nodes, restart all
of them to put the new parameter value into effect consistently
throughout the cloud..</p>
<p>To stop the 管理服务, issue the following command at the
operating system prompt on the 管理服务 node:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service cloudstack-management stop</span>
</pre></div>
</div>
<p>To start the 管理服务:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># service cloudstack-management start</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reliability.html" class="btn btn-neutral float-right" title="管理服务高可用" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="networking/using_remote_access.html" class="btn btn-neutral float-left" title="Using Remote Access VPN" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Foundation
      
        <span class="commit">
          Revision <code>29a3d9e2</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="http://docs.cloudstack.apache.org/en/master/">master</a></dd>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../../4.13.0.0/index.html">4.13.0.0</a></dd>
        
          <dd><a href="../../4.12.0.0/index.html">4.12.0.0</a></dd>
        
          <dd><a href="../../4.11.3.0/index.html">4.11.3.0</a></dd>
        
          <dd><a href="../../4.11.2.0/index.html">4.11.2.0</a></dd>
        
          <dd><a href="../../4.11.1.0/index.html">4.11.1.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/cloudstack-documentation/downloads/htmlzip/latest/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/cloudstack-documentation/?fromdocs=cloudstack-documentation">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/cloudstack-documentation/?fromdocs=cloudstack-documentation">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>