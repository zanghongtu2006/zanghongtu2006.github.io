

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The OVS Plugin &mdash; Apache CloudStack 4.13.0.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IPv6 Support in CloudStack" href="ipv6.html" />
    <link rel="prev" title="The VXLAN Plugin" href="vxlan.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="ovs-plugin.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "plugins/ovs-plugin"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache CloudStack
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conceptsandterminology/index.html">CloudStack 概念和术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickinstallationguide/qig.html">快速安装向导</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installguide/index.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">升级 CloudStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adminguide/index.html">使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developersguide/index.html">开发者手册</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">插件使用手册</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="cloudian-connector.html">The Cloudian Connector Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="nicira-plugin.html">The Nicira NVP Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="nuage-plugin.html">The Nuage VSP Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="vxlan.html">The VXLAN Plugin</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="ovs-plugin.html#">The OVS Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ovs-plugin.html#introduction-to-the-ovs-plugin">简介 to the OVS Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#features-of-the-ovs-plugin">Features of the OVS Plugin</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ovs-plugin.html#configuring-the-ovs-plugin">Configuring the OVS Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#prerequisites">前提</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#zone-configuration">Zone Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#agent-configuration">Agent Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#enabling-the-service-provider">Enabling the service provider</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#network-offerings">网络方案</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ovs-plugin.html#using-the-ovs-plugin-with-vpc">Using the OVS plugin with VPC</a></li>
<li class="toctree-l3"><a class="reference internal" href="ovs-plugin.html#dpdk-support">DPDK Support</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#agent-configuration-for-dpdk-support">Agent configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#additional-vm-configurations">Additional VM configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#additional-configurations-to-enable-dpdk-on-vms">Additional configurations to enable DPDK on VMs</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#dpdk-vhost-user-mode-selection">DPDK vHost User mode selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#applying-additional-configurations-via-service-offerings">Applying additional configurations via service offerings</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#dpdk-vms-live-migrations">DPDK VMs live migrations</a></li>
<li class="toctree-l4"><a class="reference internal" href="ovs-plugin.html#dpdk-ports">DPDK ports</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ovs-plugin.html#revision-history">Revision History</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ipv6.html">IPv6 Support in CloudStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="quota.html">Quota Plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">发行版本说明</a></li>
</ul>
<p class="caption"><span class="caption-text">其它:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/api.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Home">Apache CloudStack Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/">Apache CloudStack web site</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache CloudStack Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/cloudstack">Apache CloudStack on GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre 4.11 Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-administration.html">管理员手册</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-release-notes.html">发行版本说明</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CloudStack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">插件使用手册</a> &raquo;</li>
        
      <li>The OVS Plugin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/cloudstack-documentation/blob/4.13.0.0/source/plugins/ovs-plugin.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-ovs-plugin">
<h1>The OVS Plugin<a class="headerlink" href="ovs-plugin.html#the-ovs-plugin" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction-to-the-ovs-plugin">
<h2>简介 to the OVS Plugin<a class="headerlink" href="ovs-plugin.html#introduction-to-the-ovs-plugin" title="Permalink to this headline">¶</a></h2>
<p>The OVS plugin is the native SDN
implementations in CloudStack, using GRE isolation method. The plugin can be
used by CloudStack to implement isolated guest networks and to provide
additional services like NAT, port forwarding and load balancing.</p>
<div class="section" id="features-of-the-ovs-plugin">
<h3>Features of the OVS Plugin<a class="headerlink" href="ovs-plugin.html#features-of-the-ovs-plugin" title="Permalink to this headline">¶</a></h3>
<p>The following table lists the CloudStack network services provided by
the OVS Plugin.</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Network Service</th>
<th class="head">CloudStack version</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Virtual Networking</td>
<td>&gt;= 4.0</td>
</tr>
<tr class="row-odd"><td>Static NAT</td>
<td>&gt;= 4.3</td>
</tr>
<tr class="row-even"><td>Port Forwarding</td>
<td>&gt;= 4.3</td>
</tr>
<tr class="row-odd"><td>负载均衡</td>
<td>&gt;= 4.3</td>
</tr>
</tbody>
</table>
<p>Table: Supported Services</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Virtual Networking service was originally called ‘Connectivity’
in CloudStack 4.0</p>
</div>
<p>The following hypervisors are supported by the OVS Plugin.</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Hypervisor</th>
<th class="head">CloudStack version</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>XenServer</td>
<td>&gt;= 4.0</td>
</tr>
<tr class="row-odd"><td>KVM</td>
<td>&gt;= 4.3</td>
</tr>
</tbody>
</table>
<p>Table: Supported Hypervisors</p>
</div>
</div>
<div class="section" id="configuring-the-ovs-plugin">
<h2>Configuring the OVS Plugin<a class="headerlink" href="ovs-plugin.html#configuring-the-ovs-plugin" title="Permalink to this headline">¶</a></h2>
<div class="section" id="prerequisites">
<h3>前提<a class="headerlink" href="ovs-plugin.html#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>Before enabling the OVS plugin the hypervisor needs to be install OpenvSwitch.
Default, XenServer has already installed OpenvSwitch. However, you must
install OpenvSwitch manually on KVM. CentOS 6.4 and OpenvSwitch 1.10 are
recommended.</p>
<p>KVM hypervisor:</p>
<ul class="simple">
<li>CentOS 6.4 is recommended.</li>
<li>To make sure that the native bridge module will not interfere with
openvSwitch the bridge module should be added to the blacklist. See the
modprobe documentation for your distribution on where to find the blacklist.
Make sure the module is not loaded either by rebooting or executing rmmod
bridge before executing next steps.</li>
</ul>
</div>
<div class="section" id="zone-configuration">
<h3>Zone Configuration<a class="headerlink" href="ovs-plugin.html#zone-configuration" title="Permalink to this headline">¶</a></h3>
<p>CloudStack needs to have at least one physical network with the isolation
method set to “GRE”. This network should be enabled for the Guest
traffic type.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>With KVM, the traffic type should be configured with the traffic label
that matches the name of the Integration Bridge on the hypervisor. For
example, you should set the traffic label as following:</p>
<ul class="last simple">
<li>Management &amp; Storage traffic: cloudbr0</li>
<li>Guest &amp; Public traffic: cloudbr1
See KVM networking configuration guide for more detail.</li>
</ul>
</div>
<div class="figure align-center">
<img alt="a screenshot of a physical network with the GRE isolation type" src="../_images/ovs-physical-network-gre.png" />
</div>
</div>
<div class="section" id="agent-configuration">
<h3>Agent Configuration<a class="headerlink" href="ovs-plugin.html#agent-configuration" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only for KVM hypervisor</p>
</div>
<ul>
<li><p class="first">Configure network interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">eth0</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">none</span>
<span class="n">IPV6INIT</span><span class="o">=</span><span class="n">no</span>
<span class="n">NM_CONTROLLED</span><span class="o">=</span><span class="n">no</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">OVSPort</span>
<span class="n">DEVICETYPE</span><span class="o">=</span><span class="n">ovs</span>
<span class="n">OVS_BRIDGE</span><span class="o">=</span><span class="n">cloudbr0</span>

<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">eth1</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">eth1</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">none</span>
<span class="n">IPV6INIT</span><span class="o">=</span><span class="n">no</span>
<span class="n">NM_CONTROLLED</span><span class="o">=</span><span class="n">no</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">OVSPort</span>
<span class="n">DEVICETYPE</span><span class="o">=</span><span class="n">ovs</span>
<span class="n">OVS_BRIDGE</span><span class="o">=</span><span class="n">cloudbr1</span>

<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">cloudbr0</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">cloudbr0</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">DEVICETYPE</span><span class="o">=</span><span class="n">ovs</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">OVSBridge</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">static</span>
<span class="n">IPADDR</span><span class="o">=</span><span class="mf">172.16</span><span class="o">.</span><span class="mf">10.10</span>
<span class="n">GATEWAY</span><span class="o">=</span><span class="mf">172.16</span><span class="o">.</span><span class="mf">10.1</span>
<span class="n">NETMASK</span><span class="o">=</span><span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
<span class="n">HOTPLUG</span><span class="o">=</span><span class="n">no</span>

<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">cloudbr1</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">cloudbr1</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">DEVICETYPE</span><span class="o">=</span><span class="n">ovs</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">OVSBridge</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">none</span>
<span class="n">HOTPLUG</span><span class="o">=</span><span class="n">no</span>

<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span>
<span class="n">NETWORKING</span><span class="o">=</span><span class="n">yes</span>
<span class="n">HOSTNAME</span><span class="o">=</span><span class="n">testkvm1</span>
<span class="n">GATEWAY</span><span class="o">=</span><span class="mf">172.10</span><span class="o">.</span><span class="mf">10.1</span>
</pre></div>
</div>
</li>
<li><p class="first">Edit /etc/cloudstack/agent/agent.properties</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span><span class="o">.</span><span class="n">bridge</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">openvswitch</span>
<span class="n">libvirt</span><span class="o">.</span><span class="n">vif</span><span class="o">.</span><span class="n">driver</span><span class="o">=</span><span class="n">com</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">hypervisor</span><span class="o">.</span><span class="n">kvm</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">OvsVifDriver</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="enabling-the-service-provider">
<h3>Enabling the service provider<a class="headerlink" href="ovs-plugin.html#enabling-the-service-provider" title="Permalink to this headline">¶</a></h3>
<p>The OVS provider is disabled by default. Navigate to the “Network
Service Providers” configuration of the physical network with the GRE
isolation type. Navigate to the OVS provider and press the
“Enable Provider” button.</p>
<div class="figure align-center">
<img alt="a screenshot of an enabled OVS provider" src="../_images/ovs-physical-network-gre-enable.png" />
</div>
</div>
<div class="section" id="network-offerings">
<h3>网络方案<a class="headerlink" href="ovs-plugin.html#network-offerings" title="Permalink to this headline">¶</a></h3>
<p>Using the OVS plugin requires a network offering with Virtual
Networking enabled and configured to use the OVS element. Typical
use cases combine services from the 虚拟路由器 appliance and the
OVS plugin.</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="56%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Service</th>
<th class="head">Provider</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>VPN</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-odd"><td>DHCP</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-even"><td>DNS</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-odd"><td>Firewall</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-even"><td>Load Balancer</td>
<td>OVS</td>
</tr>
<tr class="row-odd"><td>User Data</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-even"><td>Source NAT</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-odd"><td>Static NAT</td>
<td>OVS</td>
</tr>
<tr class="row-even"><td>Post Forwarding</td>
<td>OVS</td>
</tr>
<tr class="row-odd"><td>Virtual Networking</td>
<td>OVS</td>
</tr>
</tbody>
</table>
<p>Table: Isolated network offering with regular services from the Virtual
Router.</p>
<div class="figure align-center">
<img alt="a screenshot of a network offering." src="../_images/ovs-network-offering.png" />
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The tag in the network offering should be set to the name of the
physical network with the OVS provider.</p>
</div>
<p>Isolated network with network services. The virtual router is still
required to provide network services like dns and dhcp.</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="56%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Service</th>
<th class="head">Provider</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>DHCP</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-odd"><td>DNS</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-even"><td>User Data</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-odd"><td>Source NAT</td>
<td>VirtualRouter</td>
</tr>
<tr class="row-even"><td>Static NAT</td>
<td>OVS</td>
</tr>
<tr class="row-odd"><td>Post Forwarding</td>
<td>OVS</td>
</tr>
<tr class="row-even"><td>负载均衡</td>
<td>OVS</td>
</tr>
<tr class="row-odd"><td>Virtual Networking</td>
<td>OVS</td>
</tr>
</tbody>
</table>
<p>Table: Isolated network offering with network services</p>
</div>
</div>
<div class="section" id="using-the-ovs-plugin-with-vpc">
<h2>Using the OVS plugin with VPC<a class="headerlink" href="ovs-plugin.html#using-the-ovs-plugin-with-vpc" title="Permalink to this headline">¶</a></h2>
<p>OVS plugin does not work with VPC at that time</p>
</div>
<div class="section" id="dpdk-support">
<h2>DPDK Support<a class="headerlink" href="ovs-plugin.html#dpdk-support" title="Permalink to this headline">¶</a></h2>
<p>Since version 4.12 it is possible to enable DPDK support on CloudStack along with the OVS plugin.</p>
<div class="section" id="agent-configuration-for-dpdk-support">
<span id="id1"></span><h3>Agent configuration<a class="headerlink" href="ovs-plugin.html#agent-configuration-for-dpdk-support" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Edit /etc/cloudstack/agent/agent.properties to enable DPDK support on the agent and on ovs-vstcl commands for port creations as well as the path to OVS ports (usually: /var/run/openvswitch)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openvswitch</span><span class="o">.</span><span class="n">dpdk</span><span class="o">.</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
<span class="n">openvswitch</span><span class="o">.</span><span class="n">dpdk</span><span class="o">.</span><span class="n">ovs</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="n">OVS_PATH</span>
</pre></div>
</div>
</li>
</ul>
<p>Agent should be restarted for actions to take effect.</p>
<p>When the host agent connects to the management server, it sends the list of hosts capabilities. When DPDK support is enabled on the host, the capability with name ‘dpdk’ is sent to the management server. The list of host capabilities are persisted on the ‘capabilities’ column on ‘hosts’ table, and can be retrieved by the ‘listHosts’ API method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span> <span class="n">hosts</span> <span class="nb">id</span><span class="o">=</span><span class="n">HOST_ID</span> <span class="nb">filter</span><span class="o">=</span><span class="n">capabilities</span>
</pre></div>
</div>
</div>
<div class="section" id="additional-vm-configurations">
<h3>Additional VM configurations<a class="headerlink" href="ovs-plugin.html#additional-vm-configurations" title="Permalink to this headline">¶</a></h3>
<p>In order to enable DPDK on VM deployments, users should pass addition configuration to VMs. The required configurations are listed on the next section. Administrators can allow users to pass additional configurations to their VMs by the account scoped setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enable</span><span class="o">.</span><span class="n">additional</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">configuration</span>
</pre></div>
</div>
<p>Users are able to pass extra configurations as part of the ‘deployVirtualMachine’ or ‘updateVirtualMachine’ API methods.
These extra configurations are included on the resulting XML domain of the virtual machine and are also persisted on CloudStack database as details on the ‘user_vm_details’ table.</p>
<p>The ‘deployVirtualMachine’ and ‘updateVirtualMachine’ API methods accept a URL UTF-8 string encoded parameter ‘extraconfig’.</p>
<p>Parameter is decoded following these rules:</p>
<ul class="simple">
<li>There could be multiple XML sections, separated by a new line</li>
<li>Each section can be named, setting a title ending on ‘:’ at the first line</li>
<li>Double quotes instead of single quotes should be used</li>
<li>Configurations are persisted as VM details, with the key: ‘extraconfig-TITLE’ or ‘extraconfig-N’ where N is a number.</li>
</ul>
<p>Example:</p>
<p>In order to pass the below extra configuration to the VM, named ‘config-1’</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">tag</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">inner</span><span class="o">-</span><span class="n">tag</span><span class="o">&gt;</span><span class="n">VALUE</span><span class="o">&lt;/</span><span class="n">inner</span><span class="o">-</span><span class="n">tag</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tag</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The ‘extraconfig’ parameter should receive the UTF-8 URL encoded string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">-</span><span class="mi">1</span><span class="o">%</span><span class="mi">3</span><span class="n">A</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">Ctag</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Cinner</span><span class="o">-</span><span class="n">tag</span><span class="o">%</span><span class="mi">3</span><span class="n">EVALUE</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Finner</span><span class="o">-</span><span class="n">tag</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Ftag</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span>
</pre></div>
</div>
<p>On ‘user_vm_details’ table the additional configuration is persisted with key: ‘extraconfig-config-1’</p>
</div>
<div class="section" id="additional-configurations-to-enable-dpdk-on-vms">
<h3>Additional configurations to enable DPDK on VMs<a class="headerlink" href="ovs-plugin.html#additional-configurations-to-enable-dpdk-on-vms" title="Permalink to this headline">¶</a></h3>
<p>To enable DPDK on VM deployments:</p>
<ul>
<li><p class="first">Set the global configuration to ‘true’ (as global setting or account setting)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enable</span><span class="o">.</span><span class="n">additional</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">configuration</span>
</pre></div>
</div>
</li>
<li><p class="first">Generate the UTF-8 URL encoded additional configuration to enable huge pages and NUMA, examples below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpdk</span><span class="o">-</span><span class="n">hugepages</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">memoryBacking</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">hugepages</span><span class="o">&gt;</span>
   <span class="o">&lt;/</span><span class="n">hugepages</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">memoryBacking</span><span class="o">&gt;</span>

<span class="n">dpdk</span><span class="o">-</span><span class="n">numa</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">cpu</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;host-passthrough&quot;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">numa</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">cell</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">cpus</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">memory</span><span class="o">=</span><span class="s2">&quot;9437184&quot;</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;KiB&quot;</span> <span class="n">memAccess</span><span class="o">=</span><span class="s2">&quot;shared&quot;</span><span class="o">/&gt;</span>
   <span class="o">&lt;/</span><span class="n">numa</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">cpu</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Pass the ‘extraconfig’ parameter to ‘deployVirtualMachine’ or ‘updateVirtualMachine’ API methods as a single UTF-8 URL encoded string containing multiple extra configurations (as shown above). Note: if multiple extra configurations are needed, follow the example above and add new sections separated by an empty line, encode the whole string and pass it as a single string to the APIs as ‘extraconfig’ parameter.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deployVirtualMachine</span> <span class="n">extraconfig</span><span class="o">=</span><span class="n">dpdk</span><span class="o">-</span><span class="n">hugepages</span><span class="o">%</span><span class="mi">3</span><span class="n">A</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">CmemoryBacking</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Chugepages</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fhugepages</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">FmemoryBacking</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">0</span><span class="n">Adpdk</span><span class="o">-</span><span class="n">numa</span><span class="o">%</span><span class="mi">3</span><span class="n">A</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">Ccpu</span><span class="o">%</span><span class="mi">20</span><span class="n">mode</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">host</span><span class="o">-</span><span class="n">passthrough</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Cnuma</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Ccell</span><span class="o">%</span><span class="mi">20</span><span class="nb">id</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">220</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">cpus</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">220</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">memory</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">229437184</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">unit</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">KiB</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">memAccess</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">shared</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">2</span><span class="n">F</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fnuma</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fcpu</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Additionally, users can pass extra configuration named ‘dpdk-interface-TAG’ to be included on VMs interfaces definition. Example below:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpdk</span><span class="o">-</span><span class="n">interface</span><span class="o">-</span><span class="n">model</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">model</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;virtio&#39;</span><span class="o">/&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="dpdk-vhost-user-mode-selection">
<h3>DPDK vHost User mode selection<a class="headerlink" href="ovs-plugin.html#dpdk-vhost-user-mode-selection" title="Permalink to this headline">¶</a></h3>
<p>The vHost user mode describes a client/server model between Openvswitch along with DPDK and QEMU, in which one acts as client while the other as server. The server creates and manages the vHost user sockets and the client connects to the sockets created by the server:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>DPDK vHost user server mode:</dt>
<dd><ul class="first last">
<li>Is the default configuration.</li>
<li>OVS with DPDK acts as the server, while QEMU acts as the client.</li>
<li>The port types used are: dpdkvhostuser</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>DPDK vHost user client mode:</dt>
<dd><ul class="first last">
<li>OVS with DPDK acts as the client and QEMU acts as the server.</li>
<li>If Openvswitch is restarted then the sockets can reconnect to the existing sockets on the server, and normal connectivity can be resumed.</li>
<li>The port types used are: dpdkvhostuserclient</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="applying-additional-configurations-via-service-offerings">
<h3>Applying additional configurations via service offerings<a class="headerlink" href="ovs-plugin.html#applying-additional-configurations-via-service-offerings" title="Permalink to this headline">¶</a></h3>
<p>It is possible to avoid passing additional configuration on each VM deployment, but setting these configurations on a service offering, and those are passed to the VM.</p>
<ul class="simple">
<li>To create a service offering with additional configurations, pass each key/value pair as service offering details on service offering creation, with keys starting with the “extraconfig” keyword, and each value an URL UTF-8 encoded string.</li>
<li>Additional configurations are stored as service offering details</li>
</ul>
<p>For example, applying DPDK additional configurations via service offering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">serviceoffering</span> <span class="n">name</span><span class="o">=&lt;</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="n">displaytext</span><span class="o">=&lt;</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">extraconfig</span><span class="o">-</span><span class="n">dpdk</span><span class="o">-</span><span class="n">hugepages</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=%</span><span class="mi">3</span><span class="n">CmemoryBacking</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Chugepages</span><span class="o">%</span><span class="mi">2</span><span class="n">F</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">FmemoryBacking</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">extraconfig</span><span class="o">-</span><span class="n">dpdk</span><span class="o">-</span><span class="n">numa</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=%</span><span class="mi">3</span><span class="n">Ccpu</span><span class="o">%</span><span class="mi">20</span><span class="n">mode</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">host</span><span class="o">-</span><span class="n">passthrough</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Cnuma</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Ccell</span><span class="o">%</span><span class="mi">20</span><span class="nb">id</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">220</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">cpus</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">220</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">memory</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">229437184</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">unit</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">KiB</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">memAccess</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">shared</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">2</span><span class="n">F</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fnuma</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fcpu</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span>
</pre></div>
</div>
<p>The preferred DPDK vHost User Mode must be passed as a service offering detail, with special key name: “DPDK-VHOSTUSER”. Possible values are: “client” or “server”. The following table illustrates the expected behaviour on DPDK ports and VM guest interfaces.</p>
<p>By default, the server mode is assumed if it is not passed as a service offering detail.</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="34%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DPDK vHost User Mode</th>
<th class="head">OVS port creation type</th>
<th class="head">VM guest interface mode</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>server</td>
<td>dpdkvhostuser</td>
<td>client</td>
</tr>
<tr class="row-odd"><td>client</td>
<td>dpdkvhostuserclient</td>
<td>server</td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">serviceoffering</span> <span class="n">name</span><span class="o">=&lt;</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="n">displaytext</span><span class="o">=&lt;</span><span class="n">NAME</span><span class="o">&gt;</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">DPDK</span><span class="o">-</span><span class="n">VHOSTUSER</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">client</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">extraconfig</span><span class="o">-</span><span class="n">dpdk</span><span class="o">-</span><span class="n">hugepages</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=%</span><span class="mi">3</span><span class="n">CmemoryBacking</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Chugepages</span><span class="o">%</span><span class="mi">2</span><span class="n">F</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">FmemoryBacking</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">key</span><span class="o">=</span><span class="n">extraconfig</span><span class="o">-</span><span class="n">dpdk</span><span class="o">-</span><span class="n">numa</span> <span class="n">serviceofferingdetails</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=%</span><span class="mi">3</span><span class="n">Ccpu</span><span class="o">%</span><span class="mi">20</span><span class="n">mode</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">host</span><span class="o">-</span><span class="n">passthrough</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Cnuma</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">Ccell</span><span class="o">%</span><span class="mi">20</span><span class="nb">id</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">220</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">cpus</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">220</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">memory</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">229437184</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">unit</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">KiB</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">20</span><span class="n">memAccess</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mi">22</span><span class="n">shared</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">2</span><span class="n">F</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fnuma</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">20</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fcpu</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span>
</pre></div>
</div>
</div>
<div class="section" id="dpdk-vms-live-migrations">
<h3>DPDK VMs live migrations<a class="headerlink" href="ovs-plugin.html#dpdk-vms-live-migrations" title="Permalink to this headline">¶</a></h3>
<p>It is possible to perform live migrations of DPDK enabled VMs since CloudStack version 4.13. DPDK enabled VMs can be migrated between hosts in the same cluster which are both DPDK enabled.</p>
<p>CloudStack determinates that a VM is a DPDK enabled VM when the following conditions are met:</p>
<ul class="simple">
<li>The VM is a user VM</li>
<li>The VM state is Running</li>
<li>The host in which the VM is running is a DPDK enabled host (i.e. host contains the ‘dpdk’ capability as part of its capabilities. Check <a class="reference internal" href="ovs-plugin.html#agent-configuration-for-dpdk-support">Agent configuration for DPDK support</a>.)</li>
<li><dl class="first docutils">
<dt>The VM acquires the DPDK required configurations via VM details or service offering details. DPDK required additional configurations are additional configurations with name:</dt>
<dd><ul class="first last">
<li>‘extraconfig-dpdk-numa’</li>
<li>‘extraconfig-dpdk-hugepages’</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>DPDK enabled VMs can only be migrated between DPDK enabled hosts. Therefore the ‘findHostsForMigration’ API method excludes non-DPDK enabled hosts from the list of suitable hosts to migrate DPDK enabled VMs.</p>
</div>
<div class="section" id="dpdk-ports">
<h3>DPDK ports<a class="headerlink" href="ovs-plugin.html#dpdk-ports" title="Permalink to this headline">¶</a></h3>
<p>When VM is created or started, CloudStack creates ports with DPDK support with format: “csdpdk-N” where N is a number, incremented on new ports creation. This port is set into the ‘source’ property of the ‘interface’ tag on the XML domain of the VM, prepended by the value of the OVS path set on the property:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">openvswitch</span><span class="o">.</span><span class="n">dpdk</span><span class="o">.</span><span class="n">ovs</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="n">OVS_PATH</span>
</pre></div>
</div>
<p>That would set interfaces to type ‘vhostuser’ and reference the ports created in the XML domain of the VMs as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">interface</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;vhostuser&#39;</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">source</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;unix&quot;</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&lt;OVS_PATH&gt;/&lt;port_name&gt;&quot;</span> <span class="o">.../&gt;</span>
   <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">interface</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Note that the OVS_PATH property is required, as explained on <a class="reference internal" href="ovs-plugin.html#agent-configuration-for-dpdk-support">Agent configuration for DPDK support</a>. For example, when OVS_PATH is set to the default path for Openvswitch (/var/run/openvswitch), interfaces will reference created ports on: /var/run/openvswitch/&lt;port_name&gt;</p>
</div>
</div>
<div class="section" id="revision-history">
<h2>Revision History<a class="headerlink" href="ovs-plugin.html#revision-history" title="Permalink to this headline">¶</a></h2>
<p>0-0 Mon Dec 2 2013 Nguyen Anh Tu <a class="reference external" href="mailto:tuna&#37;&#52;&#48;apache&#46;org">tuna<span>&#64;</span>apache<span>&#46;</span>org</a> Documentation
created for 4.3.0 version of the OVS Plugin</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ipv6.html" class="btn btn-neutral float-right" title="IPv6 Support in CloudStack" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="vxlan.html" class="btn btn-neutral float-left" title="The VXLAN Plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Foundation
      
        <span class="commit">
          Revision <code>29a3d9e2</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="http://docs.cloudstack.apache.org/en/master/">master</a></dd>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../../4.13.0.0/index.html">4.13.0.0</a></dd>
        
          <dd><a href="../../4.12.0.0/index.html">4.12.0.0</a></dd>
        
          <dd><a href="../../4.11.3.0/index.html">4.11.3.0</a></dd>
        
          <dd><a href="../../4.11.2.0/index.html">4.11.2.0</a></dd>
        
          <dd><a href="../../4.11.1.0/index.html">4.11.1.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/cloudstack-documentation/downloads/htmlzip/latest/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/cloudstack-documentation/?fromdocs=cloudstack-documentation">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/cloudstack-documentation/?fromdocs=cloudstack-documentation">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>