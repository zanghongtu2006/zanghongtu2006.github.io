

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>简介 &mdash; Apache CloudStack 4.13.0.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="安装概述" href="overview/index.html" />
    <link rel="prev" title="安装指南" href="index.html" /> 

<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="building_from_source.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "installguide/building_from_source"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache CloudStack
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../conceptsandterminology/index.html">CloudStack 概念和术语</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickinstallationguide/qig.html">快速入门指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">安装指南</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#building-from-source">从源码编译安装</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="building_from_source.html#">简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html#downloading-the-release">下载发行版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html#verifying-the-downloaded-release">验证下载的版本</a><ul>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#getting-the-keys">Getting the KEYS</a></li>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#gpg">GPG</a></li>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#md5">MD5</a></li>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#sha512">SHA512</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html#prerequisites-for-building-apache-cloudstack">编译 Apache CloudStack 的先决条件</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html#extracting-source">解压源码</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html#install-new-mysql-connector">安装 MySQL connector</a><ul>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#mysql-connector-apt-repository">MySQL connector APT repository</a></li>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#mysql-connector-rpm-repository">MySQL connector RPM repository</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html#building-deb-packages">打包成 DEB</a><ul>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#setting-up-an-apt-repo">Setting up an APT repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#repository-signing">Repository signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#configuring-your-machines-to-use-the-apt-repository">Configuring your machines to use the APT repository</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html#building-rpms-from-source">打包成 RPM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="building_from_source.html#generating-rpms">Generating RPMS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="building_from_source.html#building-non-oss">打包 Non-OSS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#general-installation">通用安装指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hypervisor-setup">Hypervisor 安装和设置</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#optional-installation">Optional 安装</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading/index.html">升级 CloudStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adminguide/index.html">使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developersguide/index.html">开发者手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">插件使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releasenotes/index.html">发行版本说明</a></li>
</ul>
<p class="caption"><span class="caption-text">其它:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/api.html">API 文档</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Home">Apache CloudStack Wiki</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/">Apache CloudStack 官网</a></li>
<li class="toctree-l1"><a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache CloudStack 源码</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/cloudstack">Apache CloudStack on GitHub</a></li>
</ul>
<p class="caption"><span class="caption-text">Pre 4.11 Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-installation.html">安装指南</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-administration.html">管理员手册</a></li>
<li class="toctree-l1"><a class="reference external" href="../../../projects/cloudstack-release-notes.html">发行版本说明</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache CloudStack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">安装指南</a> &raquo;</li>
        
      <li>简介</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/apache/cloudstack-documentation/blob/4.13.0.0/source/installguide/building_from_source.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction">
<h1>简介<a class="headerlink" href="building_from_source.html#introduction" title="Permalink to this headline">¶</a></h1>
<p>The official CloudStack release is always in source code form. You will
likely be able to find “convenience binaries,” the source is the
canonical release. In this section, we’ll cover acquiring the source
release and building that so that you can deploy it using Maven or
create Debian packages or RPMs.</p>
<p>Note that building and deploying directly from source is typically not
the most efficient way to deploy an IaaS. However, we will cover that
method as well as building RPMs or Debian packages for deploying
CloudStack.</p>
<p>The instructions here are likely version-specific. That is, the method
for building from source for the 4.7.x series is different from the
4.2.x series.</p>
<p>If you are working with a unreleased version of CloudStack, see the
INSTALL.md file in the top-level directory of the release.</p>
</div>
<div class="section" id="downloading-the-release">
<h1>下载发行版本<a class="headerlink" href="building_from_source.html#downloading-the-release" title="Permalink to this headline">¶</a></h1>
<p>You can download the latest CloudStack release from the <a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache
CloudStack project download page</a>.</p>
<p>Prior releases are available via archive.apache.org as well. See the
downloads page for more information on archived releases.</p>
<p>You’ll notice several links under the ‘Latest release’ section. A link
to a file ending in <code class="docutils literal notranslate"><span class="pre">tar.bz2</span></code>, as well as a PGP/GPG signature, MD5,
and SHA512 file.</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">tar.bz2</span></code> file contains the Bzip2-compressed tarball with the
source code.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">.asc</span></code> file is a detached cryptographic signature that can be
used to help verify the authenticity of the release.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">.md5</span></code> file is an MD5 hash of the release to aid in verify the
validity of the release download.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">.sha</span></code> file is a SHA512 hash of the release to aid in verify
the validity of the release download.</li>
</ul>
</div>
<div class="section" id="verifying-the-downloaded-release">
<h1>验证下载的版本<a class="headerlink" href="building_from_source.html#verifying-the-downloaded-release" title="Permalink to this headline">¶</a></h1>
<p>There are a number of mechanisms to check the authenticity and validity
of a downloaded release.</p>
<div class="section" id="getting-the-keys">
<h2>Getting the KEYS<a class="headerlink" href="building_from_source.html#getting-the-keys" title="Permalink to this headline">¶</a></h2>
<p>To enable you to verify the GPG signature, you will need to download the
<a class="reference external" href="http://www.apache.org/dist/cloudstack/KEYS">KEYS</a> file.</p>
<p>You next need to import those keys, which you can do by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ wget http://www.apache.org/dist/cloudstack/KEYS
$ gpg --import KEYS
</pre></div>
</div>
</div>
<div class="section" id="gpg">
<h2>GPG<a class="headerlink" href="building_from_source.html#gpg" title="Permalink to this headline">¶</a></h2>
<p>The CloudStack project provides a detached GPG signature of the release.
To check the signature, run the following command:</p>
<pre class="literal-block">
$ gpg --verify apache-cloudstack-4.13.0.0-src.tar.bz2.asc
</pre>
<p>If the signature is valid you will see a line of output that contains
‘Good signature’.</p>
</div>
<div class="section" id="md5">
<h2>MD5<a class="headerlink" href="building_from_source.html#md5" title="Permalink to this headline">¶</a></h2>
<p>In addition to the cryptographic signature, CloudStack has an MD5
checksum that you can use to verify the download matches the release.
You can verify this hash by executing the following command:</p>
<pre class="literal-block">
$ gpg --print-md MD5 apache-cloudstack-4.13.0.0-src.tar.bz2 | diff - apache-cloudstack-4.13.0.0-src.tar.bz2.md5
</pre>
<p>If this successfully completes you should see no output. If there is any
output from them, then there is a difference between the hash you
generated locally and the hash that has been pulled from the server.</p>
</div>
<div class="section" id="sha512">
<h2>SHA512<a class="headerlink" href="building_from_source.html#sha512" title="Permalink to this headline">¶</a></h2>
<p>In addition to the MD5 hash, the CloudStack project provides a SHA512
cryptographic hash to aid in assurance of the validity of the downloaded
release. You can verify this hash by executing the following command:</p>
<pre class="literal-block">
$ gpg --print-md SHA512 apache-cloudstack-4.13.0.0-src.tar.bz2 | diff - apache-cloudstack-4.13.0.0-src.tar.bz2.sha
</pre>
<p>If this command successfully completes you should see no output. If
there is any output from them, then there is a difference between the
hash you generated locally and the hash that has been pulled from the
server.</p>
</div>
</div>
<div class="section" id="prerequisites-for-building-apache-cloudstack">
<h1>编译 Apache CloudStack 的先决条件<a class="headerlink" href="building_from_source.html#prerequisites-for-building-apache-cloudstack" title="Permalink to this headline">¶</a></h1>
<p>There are a number of prerequisites needed to build CloudStack. This
document assumes compilation on a Linux system that uses RPMs or DEBs
for package management.</p>
<p>You will need, at a minimum, the following to compile CloudStack:</p>
<ol class="arabic simple">
<li>Maven (version 3)</li>
<li>Java (Java 8/OpenJDK 1.8)</li>
<li>Apache Web Services Common Utilities (ws-commons-util)</li>
<li>MySQL</li>
<li>MySQLdb (provides Python database API)</li>
<li>genisoimage</li>
<li>rpmbuild or dpkg-dev</li>
</ol>
</div>
<div class="section" id="extracting-source">
<h1>解压源码<a class="headerlink" href="building_from_source.html#extracting-source" title="Permalink to this headline">¶</a></h1>
<p>Extracting the CloudStack release is relatively simple and can be done
with a single command as follows:</p>
<pre class="literal-block">
$ tar -jxvf apache-cloudstack-4.13.0.0-src.tar.bz2
</pre>
<p>You can now move into the directory:</p>
<pre class="literal-block">
$ cd ./apache-cloudstack-4.13.0.0-src
</pre>
</div>
<div class="section" id="install-new-mysql-connector">
<h1>安装 MySQL connector<a class="headerlink" href="building_from_source.html#install-new-mysql-connector" title="Permalink to this headline">¶</a></h1>
<p>Install Python MySQL connector using the official MySQL packages repository.</p>
<div class="section" id="mysql-connector-apt-repository">
<h2>MySQL connector APT repository<a class="headerlink" href="building_from_source.html#mysql-connector-apt-repository" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Procedure below should work for Ubuntu 14.04 and 16.04.
For Ubuntu 18.04, please read later below.</p>
</div>
<p>Install the following package provided by MySQL to enable official repositories:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the download fails check the current version number. The version available may
have been updated.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">dev</span><span class="o">.</span><span class="n">mysql</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">get</span><span class="o">/</span><span class="n">mysql</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">config_0</span><span class="o">.</span><span class="mf">7.3</span><span class="o">-</span><span class="mi">1</span><span class="n">_all</span><span class="o">.</span><span class="n">deb</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">mysql</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">config_0</span><span class="o">.</span><span class="mf">7.3</span><span class="o">-</span><span class="mi">1</span><span class="n">_all</span><span class="o">.</span><span class="n">deb</span>
</pre></div>
</div>
<p>Make sure to activate the repository for MySQL connectors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Below is given a bit different procedure if you are compiling on Ubuntu 18.04</p>
</div>
<p>Due to default python version changes (and some others) in Ubuntu 18.04 version, we will need to install python 2.7, python-mysql.connector from Universe repo (instead from official MySQL repo) and later make sure we are using Java 8, since Java 10 comes as default</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">repository</span> <span class="n">universe</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">mysql</span><span class="o">.</span><span class="n">connector</span> <span class="n">python</span><span class="o">-</span><span class="n">setuptools</span> <span class="n">dh</span><span class="o">-</span><span class="n">systemd</span>
<span class="p">(</span><span class="n">installs</span> <span class="n">python</span> <span class="mf">2.7</span> <span class="k">with</span> <span class="n">needed</span> <span class="n">dependencies</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="mysql-connector-rpm-repository">
<h2>MySQL connector RPM repository<a class="headerlink" href="building_from_source.html#mysql-connector-rpm-repository" title="Permalink to this headline">¶</a></h2>
<p>Add a new yum repo <code class="docutils literal notranslate"><span class="pre">/etc/yum.repos.d/mysql.repo</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[mysql-community]
name=MySQL Community connectors
baseurl=http://repo.mysql.com/yum/mysql-connectors-community/el/$releasever/$basearch/
gpgkey=http://repo.mysql.com/RPM-GPG-KEY-mysql
enabled=1
gpgcheck=1
</pre></div>
</div>
<p>Install mysql-connector</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-deb-packages">
<span id="id1"></span><h1>打包成 DEB<a class="headerlink" href="building_from_source.html#building-deb-packages" title="Permalink to this headline">¶</a></h1>
<p>In addition to the bootstrap dependencies, you’ll also need to install
several other dependencies. Note that we recommend using Maven 3.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get install python-software-properties
$ sudo apt-get update
$ sudo apt-get install debhelper openjdk-8-jdk libws-commons-util-java genisoimage libcommons-codec-java libcommons-httpclient-java liblog4j1.2-java maven
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If on Ubuntu 18.04, in above command, please replace “python-software-properties” with “software-properties-common”
If on Ubuntu 18.04, above command will install both Java 10 and Java 8, so make sure to switch to Java8 with “update-alternatives –config java” - otherwise you will get errors during dependency check and code compiling.</p>
</div>
<p>While we have defined, and you have presumably already installed the
bootstrap prerequisites, there are a number of build time prerequisites
that need to be resolved. CloudStack uses maven for dependency
resolution. You can resolve the buildtime depdencies for CloudStack by
running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mvn -P deps
</pre></div>
</div>
<p>Now that we have resolved the dependencies we can move on to building
CloudStack and packaging them into DEBs by issuing the following
command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dpkg-buildpackage -uc -us
</pre></div>
</div>
<p>This command will build the following debian packages. You should have
all of the following:</p>
<pre class="literal-block">
cloudstack-common-4.13.0.0.amd64.deb
cloudstack-management-4.13.0.0.amd64.deb
cloudstack-agent-4.13.0.0.amd64.deb
cloudstack-usage-4.13.0.0.amd64.deb
cloudstack-cli-4.13.0.0.amd64.deb
</pre>
<div class="section" id="setting-up-an-apt-repo">
<h2>Setting up an APT repo<a class="headerlink" href="building_from_source.html#setting-up-an-apt-repo" title="Permalink to this headline">¶</a></h2>
<p>After you’ve created the packages, you’ll want to copy them to a system
where you can serve the packages over HTTP. You’ll create a directory
for the packages and then use <code class="docutils literal notranslate"><span class="pre">dpkg-scanpackages</span></code> to create
<code class="docutils literal notranslate"><span class="pre">Packages.gz</span></code>, which holds information about the archive structure.
Finally, you’ll add the repository to your system(s) so you can install
the packages using APT.</p>
<p>The first step is to make sure that you have the <strong>dpkg-dev</strong> package
installed. This should have been installed when you pulled in the
<strong>debhelper</strong> application previously, but if you’re generating
<code class="docutils literal notranslate"><span class="pre">Packages.gz</span></code> on a different system, be sure that it’s installed there
as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install dpkg-dev apt-utils
</pre></div>
</div>
<p>The next step is to copy the DEBs to the directory where they can be
served over HTTP. We’ll use <code class="docutils literal notranslate"><span class="pre">/var/www/cloudstack/repo</span></code> in the
examples, but change the directory to whatever works for you.</p>
<pre class="literal-block">
$ sudo mkdir -p /var/www/cloudstack/repo/binary
$ sudo cp *.deb /var/www/cloudstack/repo/binary
$ cd /var/www/cloudstack/repo/binary
$ sudo dpkg-scanpackages . /dev/null &gt; Packages
$ sudo gzip -9k Packages
$ sudo apt-ftparchive release . &gt; Release
</pre>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can safely ignore the warning about a missing override file.</p>
</div>
<p>Now you should have all of the DEB packages, <code class="docutils literal notranslate"><span class="pre">Packages</span></code>,
<code class="docutils literal notranslate"><span class="pre">Packages.gz</span></code> and <code class="docutils literal notranslate"><span class="pre">Release</span></code> in the <code class="docutils literal notranslate"><span class="pre">binary</span></code> directory and
available over HTTP. (You may want to use <code class="docutils literal notranslate"><span class="pre">wget</span></code> or <code class="docutils literal notranslate"><span class="pre">curl</span></code>
to test this before moving on to the next step.)</p>
</div>
<div class="section" id="repository-signing">
<h2>Repository signing<a class="headerlink" href="building_from_source.html#repository-signing" title="Permalink to this headline">¶</a></h2>
<p>The following step is optional.</p>
<p>The repository we just created will work without cryptographic
signatures, but it’s always better to sign your releases if you can.</p>
<p>Install GnuPG first:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install gpg
</pre></div>
</div>
<p>Set up a signing key if you don’t have one yet.
If you already have a suitable key, skip this step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo gpg --default-new-key-algo rsa4096 --gen-key
</pre></div>
</div>
<p>Generate the repository signatures. Replace ${YOUR_KEY_ID} with the
key ID of the key you created above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo rm -fr Release.gpg InRelease
$ sudo gpg --default-key ${YOUR_KEY_ID} -abs -o Release.gpg Release
$ sudo gpg --default-key ${YOUR_KEY_ID} --clearsign -o InRelease Release
$ sudo gpg --output KEY.gpg --armor --export ${YOUR_KEY_ID}
</pre></div>
</div>
<p>Store the <code class="docutils literal notranslate"><span class="pre">Release.gpg</span></code> and <code class="docutils literal notranslate"><span class="pre">InRelease</span></code> as well as KEY.gpg on your
HTTP server.</p>
</div>
<div class="section" id="configuring-your-machines-to-use-the-apt-repository">
<h2>Configuring your machines to use the APT repository<a class="headerlink" href="building_from_source.html#configuring-your-machines-to-use-the-apt-repository" title="Permalink to this headline">¶</a></h2>
<p>Now that we have created the repository, you need to configure your
machine to make use of the APT repository. You can do this by adding a
repository file under <code class="docutils literal notranslate"><span class="pre">/etc/apt/sources.list.d</span></code>. Use your preferred
editor to create <code class="docutils literal notranslate"><span class="pre">/etc/apt/sources.list.d/cloudstack.list</span></code> with this
line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">server</span><span class="o">.</span><span class="n">url</span><span class="o">/</span><span class="n">cloudstack</span><span class="o">/</span><span class="n">repo</span><span class="o">/</span><span class="n">binary</span> <span class="o">./</span>
</pre></div>
</div>
<p>If you signed your Release file with GnuPG, import the signing key
on your target system first.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ wget -q -O - http://server.url/cloudstack/repo/binary/KEY.gpg | sudo apt-key add -
</pre></div>
</div>
<p>Now that you have the repository info in place, you’ll want to run
another update so that APT knows where to find the CloudStack packages.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update
</pre></div>
</div>
<p>You can now move on to the instructions under Install on Ubuntu.</p>
</div>
</div>
<div class="section" id="building-rpms-from-source">
<h1>打包成 RPM<a class="headerlink" href="building_from_source.html#building-rpms-from-source" title="Permalink to this headline">¶</a></h1>
<p>As mentioned previously in <a class="reference external" href="building_from_source.html#prerequisites-for-building-apache-cloudstack">“编译 Apache CloudStack 的先决条件”</a>, you will need to install
several prerequisites before you can build packages for CloudStack. Here we’ll
assume you’re working with a 64-bit build of CentOS or Red Hat Enterprise
Linux.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum groupinstall &quot;Development Tools&quot;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum install java-1.8.0-openjdk-devel.x86_64 genisoimage mysql mysql-server ws-commons-util MySQL-python python-setuptools createrepo</span>
</pre></div>
</div>
<p>Next, you’ll need to install build-time dependencies for CloudStack with
Maven. We’re using Maven 3, so you’ll want to grab <a class="reference external" href="http://maven.apache.org/download.cgi">Maven 3.0.5 (Binary tar.gz)</a> and uncompress it in
your home directory (or whatever location you prefer):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ~
$ tar zxvf apache-maven-3.0.5-bin.tar.gz
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export PATH=~/apache-maven-3.0.5/bin:$PATH
</pre></div>
</div>
<p>Maven also needs to know where Java is, and expects the JAVA_HOME
environment variable to be set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk.x86_64
</pre></div>
</div>
<p>Verify that Maven is installed correctly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mvn --version
</pre></div>
</div>
<p>You probably want to ensure that your environment variables will survive
a logout/reboot. Be sure to update <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> with the PATH and
JAVA_HOME variables.</p>
<p>Building RPMs for CloudStack is fairly simple. Assuming you already have
the source downloaded and have uncompressed the tarball into a local
directory, you’re going to be able to generate packages in just a few
minutes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Packaging has changed. If you’ve created packages for CloudStack
previously, you should be aware that the process has changed considerably
since the project has moved to using Apache Maven. Please be sure to follow
the steps in this section closely.</p>
</div>
<div class="section" id="generating-rpms">
<h2>Generating RPMS<a class="headerlink" href="building_from_source.html#generating-rpms" title="Permalink to this headline">¶</a></h2>
<p>Now that we have the prerequisites and source, you will cd to the
<cite>packaging/</cite> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd packaging/
</pre></div>
</div>
<p>Generating RPMs is done using the <code class="docutils literal notranslate"><span class="pre">package.sh</span></code> script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./package.sh -d centos63
</pre></div>
</div>
<p>For other supported options(like centos7), run <code class="docutils literal notranslate"><span class="pre">./package.sh</span> <span class="pre">--help</span></code></p>
<p>That will run for a bit and then place the finished packages in
<code class="docutils literal notranslate"><span class="pre">dist/rpmbuild/RPMS/x86_64/</span></code>.</p>
<p>You should see the following RPMs in that directory:</p>
<pre class="literal-block">
cloudstack-agent-4.13.0.0.el6.x86_64.rpm
cloudstack-cli-4.13.0.0.el6.x86_64.rpm
cloudstack-common-4.13.0.0.el6.x86_64.rpm
cloudstack-management-4.13.0.0.el6.x86_64.rpm
cloudstack-usage-4.13.0.0.el6.x86_64.rpm
</pre>
<div class="section" id="creating-a-yum-repo">
<h3>Creating a yum repo<a class="headerlink" href="building_from_source.html#creating-a-yum-repo" title="Permalink to this headline">¶</a></h3>
<p>While RPMs is a useful packaging format - it’s most easily consumed from
Yum repositories over a network. The next step is to create a Yum Repo
with the finished packages:</p>
<pre class="literal-block">
$ mkdir -p ~/tmp/repo

$ cd ../..
$ cp dist/rpmbuild/RPMS/x86_64/*rpm ~/tmp/repo/

$ createrepo /tmp/repo
</pre>
<p>The files and directories within <code class="docutils literal notranslate"><span class="pre">~/tmp/repo</span></code> can now be uploaded to a
web server and serve as a yum repository.</p>
</div>
<div class="section" id="configuring-your-systems-to-use-your-new-yum-repository">
<h3>Configuring your systems to use your new yum repository<a class="headerlink" href="building_from_source.html#configuring-your-systems-to-use-your-new-yum-repository" title="Permalink to this headline">¶</a></h3>
<p>Now that your yum repository is populated with RPMs and metadata we need
to configure the machines that need to install CloudStack. Create a file
named <code class="docutils literal notranslate"><span class="pre">/etc/yum.repos.d/cloudstack.repo</span></code> with this information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">apache</span><span class="o">-</span><span class="n">cloudstack</span><span class="p">]</span>
<span class="n">name</span><span class="o">=</span><span class="n">Apache</span> <span class="n">CloudStack</span>
<span class="n">baseurl</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">webserver</span><span class="o">.</span><span class="n">tld</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">repo</span>
<span class="n">enabled</span><span class="o">=</span><span class="mi">1</span>
<span class="n">gpgcheck</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>Completing this step will allow you to easily install CloudStack on a
number of machines across the network.</p>
</div>
</div>
</div>
<div class="section" id="building-non-oss">
<span id="building-noredist"></span><h1>打包 Non-OSS<a class="headerlink" href="building_from_source.html#building-non-oss" title="Permalink to this headline">¶</a></h1>
<p>If you need support for the VMware, NetApp, F5, NetScaler, SRX, or any
other non-Open Source Software (nonoss) plugins, you’ll need to download
a few components on your own and follow a slightly different procedure
to build from source.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Some of the plugins supported by CloudStack cannot be distributed with
CloudStack for licensing reasons. In some cases, some of the required
libraries/JARs are under a proprietary license. In other cases, the
required libraries may be under a license that’s not compatible with
<a class="reference external" href="http://www.apache.org/legal/resolved.html#category-x">Apache’s licensing guidelines for third-party products</a>.</p>
</div>
<ol class="arabic">
<li><p class="first">To build the Non-OSS plugins, you’ll need to have the requisite JARs
installed under the <code class="docutils literal notranslate"><span class="pre">deps</span></code> directory.</p>
<p>Because these modules require dependencies that can’t be distributed
with CloudStack you’ll need to download them yourself. Links to the
most recent dependencies are listed on the <a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/How+to+build+CloudStack">*How to build CloudStack*</a>
page on the wiki.</p>
</li>
<li><p class="first">You may also need to download
<a class="reference external" href="http://download.cloud.com.s3.amazonaws.com/tools/vhd-util">vhd-util</a>,
which was removed due to licensing issues. You’ll copy vhd-util to
the <code class="docutils literal notranslate"><span class="pre">scripts/vm/hypervisor/xenserver/</span></code> directory.</p>
</li>
<li><p class="first">Once you have all the dependencies copied over, you’ll be able to
build CloudStack with the <code class="docutils literal notranslate"><span class="pre">noredist</span></code> option:</p>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mvn clean
$ mvn install -Dnoredist
</pre></div>
</div>
<ol class="arabic simple">
<li>Once you’ve built CloudStack with the <code class="docutils literal notranslate"><span class="pre">noredist</span></code> profile, you can
package it using the <a class="reference external" href="building_from_source.html#building-rpms-from-source">“打包成 RPM”</a>
or <a class="reference external" href="building_from_source.html#building-deb-packages">“打包成 DEB”</a> instructions.</li>
</ol>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="overview/index.html" class="btn btn-neutral float-right" title="安装概述" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="安装指南" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Apache Foundation
      
        <span class="commit">
          Revision <code>29a3d9e2</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="http://docs.cloudstack.apache.org/en/master/">master</a></dd>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../../4.13.0.0/index.html">4.13.0.0</a></dd>
        
          <dd><a href="../../4.12.0.0/index.html">4.12.0.0</a></dd>
        
          <dd><a href="../../4.11.3.0/index.html">4.11.3.0</a></dd>
        
          <dd><a href="../../4.11.2.0/index.html">4.11.2.0</a></dd>
        
          <dd><a href="../../4.11.1.0/index.html">4.11.1.0</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/cloudstack-documentation/downloads/htmlzip/latest/">html</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/cloudstack-documentation/?fromdocs=cloudstack-documentation">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/cloudstack-documentation/?fromdocs=cloudstack-documentation">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
   

</body>
</html>