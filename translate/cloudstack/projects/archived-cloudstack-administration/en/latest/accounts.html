<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>管理角色、账户、用户和域 &#8212; Apache CloudStack Administration Documentation 4.11.0.0 documentation</title>
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.readthedocs.org/static/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.2.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="用项目来管理用户和资源" href="projects.html" />
    <link rel="prev" title="用户界面" href="ui.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="accounts.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'accounts'
READTHEDOCS_DATA['source_suffix'] = '.rst'
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          管理员手册</a>
        <span class="navbar-text navbar-version pull-left"><b>4.11</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
                <a role="button"
                   id="dLabelGlobalToc"
                   data-toggle="dropdown"
                   data-target="#"
                   href="index.html">Sections <b class="caret"></b></a>
                <ul class="dropdown-menu globaltoc"
                    role="menu"
                    aria-labelledby="dLabelGlobalToc">
                     <ul>
<li class="toctree-l1"><a class="reference internal" href="ui.html">用户界面</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="accounts.html#">管理角色、账户、用户和域</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="projects.html">用项目来管理用户和资源</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="service_offerings.html">计算方案</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="networking.html">为用户设置网络</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="virtual_machines.html">虚拟机</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="templates.html">模板</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hosts.html">主机</a></li>
<li class="toctree-l1"><a class="reference internal" href="hosts.html#security">安全</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="storage.html">存储</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="systemvm.html">系统虚拟机</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Working with Usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="networking_and_traffic.html">Managing Networks and Traffic</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking/using_remote_access.html">Using Remote Access VPN</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="management.html">管理云</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reliability.html">System Reliability and High Availability</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plugins/quota.html">Quota Plugin</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tuning.html">调优</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="events.html">Event Notification</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">故障排除</a></li>
</ul>


                </ul>
              </li>
              
                
              
            
            
              
                
  <li>
    <a href="ui.html" title="Previous Chapter: 用户界面"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 用户界面</span>
    </a>
  </li>
  <li>
    <a href="projects.html" title="Next Chapter: 用项目来管理用户和资源"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Using Projects to Organize Users and ... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="accounts.html#">管理角色、账户、用户和域</a><ul>
<li><a class="reference internal" href="accounts.html#roles-accounts-users-and-domains">角色、账户、用户和域</a><ul>
<li><a class="reference internal" href="accounts.html#roles">Roles</a></li>
<li><a class="reference internal" href="accounts.html#accounts">Accounts</a></li>
<li><a class="reference internal" href="accounts.html#domains">Domains</a></li>
<li><a class="reference internal" href="accounts.html#users">Users</a></li>
<li><a class="reference internal" href="accounts.html#domain-administrators">Domain Administrators</a></li>
<li><a class="reference internal" href="accounts.html#root-administrator">Root Administrator</a></li>
<li><a class="reference internal" href="accounts.html#resource-ownership">Resource Ownership</a></li>
</ul>
</li>
<li><a class="reference internal" href="accounts.html#using-dynamic-roles">使用动态角色</a></li>
<li><a class="reference internal" href="accounts.html#dedicating-resources-to-accounts-and-domains">将资源分配给账户和域</a></li>
<li><a class="reference internal" href="accounts.html#how-to-dedicate-a-zone-cluster-pod-or-host-to-an-account-or-domain">怎样将资源域、集群、池和主机分配给指定的账户和域</a><ul>
<li><a class="reference internal" href="accounts.html#how-to-use-dedicated-hosts">How to Use Dedicated Hosts</a></li>
<li><a class="reference internal" href="accounts.html#behavior-of-dedicated-hosts-clusters-pods-and-zones">Behavior of Dedicated Hosts, Clusters, Pods, and Zones</a></li>
</ul>
</li>
<li><a class="reference internal" href="accounts.html#using-an-ldap-server-for-user-authentication">使用 LDAP 作用户认证</a><ul>
<li><a class="reference internal" href="accounts.html#restricting-ldap-users-to-a-group">Restricting LDAP users to a group:</a></li>
<li><a class="reference internal" href="accounts.html#ldap-ssl">LDAP SSL:</a></li>
<li><a class="reference internal" href="accounts.html#ldap-groups">LDAP groups:</a></li>
</ul>
</li>
<li><a class="reference internal" href="accounts.html#using-a-saml-2-0-identity-provider-for-user-authentication">使用 SAML 2.0 作用户认证</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9">
      
  <div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>NOTICE: THIS DOCUMENTATION SITE HAS BEEN SUPERSEDED.</p>
<p class="last">For the current documentation site goto: <a class="reference external" href="../../../../index.html">http://docs.cloudstack.apache.org</a></p>
</div>
<div class="section" id="managing-roles-accounts-users-and-domains">
<h1>管理角色、账户、用户和域<a class="headerlink" href="accounts.html#managing-roles-accounts-users-and-domains" title="Permalink to this headline">¶</a></h1>
<div class="section" id="roles-accounts-users-and-domains">
<h2>角色、账户、用户和域<a class="headerlink" href="accounts.html#roles-accounts-users-and-domains" title="Permalink to this headline">¶</a></h2>
<div class="section" id="roles">
<h3>Roles<a class="headerlink" href="accounts.html#roles" title="Permalink to this headline">¶</a></h3>
<p>A role represents a set of allowed functions. All CloudStack accounts have a
role attached to them that enforce access rules on them to be allowed or
disallowed to make an API request. Typically there are four default roles:
root admin, resource admin, domain admin and user.</p>
</div>
<div class="section" id="accounts">
<h3>Accounts<a class="headerlink" href="accounts.html#accounts" title="Permalink to this headline">¶</a></h3>
<p>An account typically represents a customer of the service provider or a
department in a large organization. Multiple users can exist in an
account.</p>
</div>
<div class="section" id="domains">
<h3>Domains<a class="headerlink" href="accounts.html#domains" title="Permalink to this headline">¶</a></h3>
<p>Accounts are grouped by domains. Domains usually contain multiple
accounts that have some logical relationship to each other and a set of
delegated administrators with some authority over the domain and its
subdomains. For example, a service provider with several resellers could
create a domain for each reseller.</p>
<p>For each account created, the Cloud installation creates three different
types of user accounts: root administrator, domain administrator, and
user.</p>
</div>
<div class="section" id="users">
<h3>Users<a class="headerlink" href="accounts.html#users" title="Permalink to this headline">¶</a></h3>
<p>Users are like aliases in the account. Users in the same account are not
isolated from each other, but they are isolated from users in other
accounts. Most installations need not surface the notion of users; they
just have one user per account. The same user cannot belong to multiple
accounts.</p>
<p>Username is unique in a domain across accounts in that domain. The same
username can exist in other domains, including sub-domains. Domain name
can repeat only if the full pathname from root is unique. For example,
you can create root/d1, as well as root/foo/d1, and root/sales/d1.</p>
<p>Administrators are accounts with special privileges in the system. There
may be multiple administrators in the system. Administrators can create
or delete other administrators, and change the password for any user in
the system.</p>
</div>
<div class="section" id="domain-administrators">
<h3>Domain Administrators<a class="headerlink" href="accounts.html#domain-administrators" title="Permalink to this headline">¶</a></h3>
<p>Domain administrators can perform administrative operations for users
who belong to that domain. Domain administrators do not have visibility
into physical servers or other domains.</p>
</div>
<div class="section" id="root-administrator">
<h3>Root Administrator<a class="headerlink" href="accounts.html#root-administrator" title="Permalink to this headline">¶</a></h3>
<p>Root administrators have complete access to the system, including
managing templates, service offerings, customer care administrators, and
domains</p>
</div>
<div class="section" id="resource-ownership">
<h3>Resource Ownership<a class="headerlink" href="accounts.html#resource-ownership" title="Permalink to this headline">¶</a></h3>
<p>Resources belong to the account, not individual users in that account.
For example, billing, resource limits, and so on are maintained by the
account, not the users. A user can operate on any resource in the
account provided the user has privileges for that operation. The
privileges are determined by the role. A root administrator can change
the ownership of any virtual machine from one account to any other
account by using the assignVirtualMachine API. A domain or sub-domain
administrator can do the same for VMs within the domain from one account
to any other account in the domain or any of its sub-domains.</p>
</div>
</div>
<div class="section" id="using-dynamic-roles">
<h2>使用动态角色<a class="headerlink" href="accounts.html#using-dynamic-roles" title="Permalink to this headline">¶</a></h2>
<p>In addition to the four default roles, the dynamic role-based API checker feature
allows CloudStack root admins to create new roles with customized permissions.
The allow/deny rules can be configured dynamically during runtime without
restarting the management server(s).</p>
<p>For backward compatiblity, all roles resolve to one of the four role types:
admin, resource admin, domain admin and user. A new role can be created using
the roles tab in the UI and specifying a name, a role type and optionally a
description.</p>
<p>Role specific rules can be configured through the rules tab on role specific
details page. A rule is either an API name or a wildcard string that are one of
allow or deny permission and optionally a description.</p>
<p>When a user makes an API request, the backend checks the requested API against
configured rules (in the order the rules were configured) for the caller
user-account’s role. It will iterate through the rules and would allow the
API request if the API matches an allow rule, else if it matches a deny rule
it would deny the request. Next, if the request API fails to match any of
the configured rules it would allow if the requested API’s default authorized
annotaions allow that user role type and finally deny the user API request
if it fails to be explicitly allowed/denied by the role permission rules or the
default API authorize annotations. Note: to avoid root admin being locked
out of the system, all root admin accounts are allowed all APIs.</p>
<p>The dynamic-roles feature is enabled by default only for all new CloudStack
installations since version <a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Dynamic+Role+Based+API+Access+Checker+for+CloudStack">4.9.x</a>.</p>
<p>In 4.11.x and above, existing deployment without any commands.properties file
will be automatically migrated to dynamic roles. Admins may also enable dynamic
roles by setting the global setting ‘dynamic.apichecker.enabled’ to true.</p>
<p>After an upgrade, admins can also use this migration tool to migrate old rules
from commands.properties file(s):
<code class="docutils literal notranslate"><span class="pre">/usr/share/cloudstack-common/scripts/util/migrate-dynamicroles.py</span></code>.</p>
<p>During migration, this tool enables the global setting in the database and
copies existing static role-based rules from provided commands.properties file
(typically at <code class="docutils literal notranslate"><span class="pre">/etc/cloudstack/management/commands.properties</span></code>) to the database
and renames the commands.properties file (typically to
/etc/cloudstack/management/commands.properties.deprecated). The migration
process does not require restarting the management server(s).</p>
<p>Usage: <code class="docutils literal notranslate"><span class="pre">migrate-dynamicroles.py</span></code> [options] [-h for help]</p>
<p>Options:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-b <var>DB</var></span></kbd></td>
<td>The name of the database, default: cloud</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-u <var>USER</var></span></kbd></td>
<td>User name a MySQL user with privileges on cloud database, default: cloud</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-p <var>PASSWORD</var></span></kbd></td>
<td>Password of a MySQL user with privileges on cloud database</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-H <var>HOST</var></span></kbd></td>
<td>Host or IP of the MySQL server</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-P <var>PORT</var></span></kbd></td>
<td>Host or IP of the MySQL server, default: 3306</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-f <var>FILE</var></span></kbd></td>
<td>The commands.properties file, default: /etc/cloudstack/management/commands.properties</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-D</span></kbd></td>
<td>Use the default role-rule permissions, and only enable dynamic roles</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-d</span></kbd></td>
<td>Dry run and debug operations this tool will perform</td></tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo python /usr/share/cloudstack-common/scripts/util/migrate-dynamicroles.py -u cloud -p cloud -H localhost -P <span class="m">3006</span> -f /etc/cloudstack/management/commands.properties
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo python /usr/share/cloudstack-common/scripts/util/migrate-dynamicroles.py -u cloud -p cloud -H localhost -P <span class="m">3006</span> -D
</pre></div>
</div>
<p>If you’ve multiple management servers, remove or rename the commands.properties
file on the management servers typically in /etc/cloudstack/management path,
after running the migration tool for the first management server.</p>
</div>
<div class="section" id="dedicating-resources-to-accounts-and-domains">
<h2>将资源分配给账户和域<a class="headerlink" href="accounts.html#dedicating-resources-to-accounts-and-domains" title="Permalink to this headline">¶</a></h2>
<p>The root administrator can dedicate resources to a specific domain or
account that needs private infrastructure for additional security or
performance guarantees. A zone, pod, cluster, or host can be reserved by
the root administrator for a specific domain or account. Only users in
that domain or its subdomain may use the infrastructure. For example,
only users in a given domain can create guests in a zone dedicated to
that domain.</p>
<p>There are several types of dedication available:</p>
<ul class="simple">
<li>Explicit dedication. A zone, pod, cluster, or host is dedicated to an
account or domain by the root administrator during initial deployment
and configuration.</li>
<li>Strict implicit dedication. A host will not be shared across multiple
accounts. For example, strict implicit dedication is useful for
deployment of certain types of applications, such as desktops, where
no host can be shared between different accounts without violating
the desktop software’s terms of license.</li>
<li>Preferred implicit dedication. The VM will be deployed in dedicated
infrastructure if possible. Otherwise, the VM can be deployed in
shared infrastructure.</li>
</ul>
</div>
<div class="section" id="how-to-dedicate-a-zone-cluster-pod-or-host-to-an-account-or-domain">
<h2>怎样将资源域、集群、池和主机分配给指定的账户和域<a class="headerlink" href="accounts.html#how-to-dedicate-a-zone-cluster-pod-or-host-to-an-account-or-domain" title="Permalink to this headline">¶</a></h2>
<p>For explicit dedication: When deploying a new zone, pod, cluster, or
host, the root administrator can click the Dedicated checkbox, then
choose a domain or account to own the resource.</p>
<p>To explicitly dedicate an existing zone, pod, cluster, or host: log in
as the root admin, find the resource in the UI, and click the Dedicate
button. <img alt="button to dedicate a zone, pod,cluster, or host" src="_images/dedicate-resource-button.png" /></p>
<p>For implicit dedication: The administrator creates a compute service
offering and in the Deployment Planner field, chooses
ImplicitDedicationPlanner. Then in Planner Mode, the administrator
specifies either Strict or Preferred, depending on whether it is
permissible to allow some use of shared resources when dedicated
resources are not available. Whenever a user creates a VM based on this
service offering, it is allocated on one of the dedicated hosts.</p>
<div class="section" id="how-to-use-dedicated-hosts">
<h3>How to Use Dedicated Hosts<a class="headerlink" href="accounts.html#how-to-use-dedicated-hosts" title="Permalink to this headline">¶</a></h3>
<p>To use an explicitly dedicated host, use the explicit-dedicated type of
affinity group (see <a class="reference external" href="virtual_machines.html#affinity-groups">“Affinity Groups”</a>).
For example, when creating a new VM, an
end user can choose to place it on dedicated infrastructure. This
operation will succeed only if some infrastructure has already been
assigned as dedicated to the user’s account or domain.</p>
</div>
<div class="section" id="behavior-of-dedicated-hosts-clusters-pods-and-zones">
<h3>Behavior of Dedicated Hosts, Clusters, Pods, and Zones<a class="headerlink" href="accounts.html#behavior-of-dedicated-hosts-clusters-pods-and-zones" title="Permalink to this headline">¶</a></h3>
<p>The administrator can live migrate VMs away from dedicated hosts if
desired, whether the destination is a host reserved for a different
account/domain or a host that is shared (not dedicated to any particular
account or domain). CloudStack will generate an alert, but the operation
is allowed.</p>
<p>Dedicated hosts can be used in conjunction with host tags. If both a
host tag and dedication are requested, the VM will be placed only on a
host that meets both requirements. If there is no dedicated resource
available to that user that also has the host tag requested by the user,
then the VM will not deploy.</p>
<p>If you delete an account or domain, any hosts, clusters, pods, and zones
that were dedicated to it are freed up. They will now be available to be
shared by any account or domain, or the administrator may choose to
re-dedicate them to a different account or domain.</p>
<p>System VMs and virtual routers affect the behavior of host dedication.
System VMs and virtual routers are owned by the CloudStack system
account, and they can be deployed on any host. They do not adhere to
explicit dedication. The presence of system vms and virtual routers on a
host makes it unsuitable for strict implicit dedication. The host can
not be used for strict implicit dedication, because the host already has
VMs of a specific account (the default system account). However, a host
with system VMs or virtual routers can be used for preferred implicit
dedication.</p>
</div>
</div>
<div class="section" id="using-an-ldap-server-for-user-authentication">
<h2>使用 LDAP 作用户认证<a class="headerlink" href="accounts.html#using-an-ldap-server-for-user-authentication" title="Permalink to this headline">¶</a></h2>
<p>You can use an external LDAP server such as Microsoft Active Directory
or ApacheDS to authenticate CloudStack end-users. CloudStack will search
the external LDAP directory tree starting at a specified base directory
and gets user info such as first name, last name, email and username.</p>
<p>To authenticate, username and password entered by the user are used.
Cloudstack does a search for a user with the given username. If it
exists, it does a bind request with DN and password.</p>
<p>To set up LDAP authentication in CloudStack, call the CloudStack API
command <code class="docutils literal notranslate"><span class="pre">addLdapConfiguration</span></code> and provide Hostname or IP address
and listening port of the LDAP server. You could configure multiple
servers as well. These are expected to be replicas. If one fails,
the next one is used.</p>
<p>The following global configurations should also be configured (the
default values are for openldap)</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ldap.basedn</span></code>:     Sets the basedn for LDAP. Ex: <strong>OU=APAC,DC=company,DC=com</strong></li>
<li><code class="docutils literal notranslate"><span class="pre">ldap.bind.principal</span></code>, <code class="docutils literal notranslate"><span class="pre">ldap.bind.password</span></code>: DN and password for a user
who can list all the users in the above basedn. Ex:
<strong>CN=Administrator, OU=APAC, DC=company, DC=com</strong></li>
<li><code class="docutils literal notranslate"><span class="pre">ldap.user.object</span></code>: object type of users within LDAP. Defaults value is
<strong>user</strong> for AD and <strong>inetorgperson</strong> for openldap.</li>
<li><code class="docutils literal notranslate"><span class="pre">ldap.email.attribute</span></code>: email attribute within ldap for a user. Default
value for AD and openldap is <strong>mail</strong>.</li>
<li><code class="docutils literal notranslate"><span class="pre">ldap.firstname.attribute</span></code>: firstname attribute within ldap for a user.
Default value for AD and openldap is <strong>givenname</strong>.</li>
<li><code class="docutils literal notranslate"><span class="pre">ldap.lastname.attribute</span></code>: lastname attribute within ldap for a user.
Default value for AD and openldap is <strong>sn</strong>.</li>
<li><code class="docutils literal notranslate"><span class="pre">ldap.username.attribute</span></code>: username attribute for a user within LDAP.
Default value is <strong>SAMAccountName</strong> for AD and <strong>uid</strong> for openldap.</li>
</ul>
<div class="section" id="restricting-ldap-users-to-a-group">
<h3>Restricting LDAP users to a group:<a class="headerlink" href="accounts.html#restricting-ldap-users-to-a-group" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ldap.search.group.principle</span></code>: this is optional and if set only users from
this group are listed.</li>
</ul>
</div>
<div class="section" id="ldap-ssl">
<h3>LDAP SSL:<a class="headerlink" href="accounts.html#ldap-ssl" title="Permalink to this headline">¶</a></h3>
<p>If the LDAP server requires SSL, you need to enable the below configurations.
Before enabling SSL for LDAP, you need to get the certificate which the LDAP server is using and add it to a trusted keystore.
You will need to know the path to the keystore and the password.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ldap.truststore</span></code> : truststore path</li>
<li><code class="docutils literal notranslate"><span class="pre">ldap.truststore.password</span></code> : truststore password</li>
</ul>
</div>
<div class="section" id="ldap-groups">
<h3>LDAP groups:<a class="headerlink" href="accounts.html#ldap-groups" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ldap.group.object</span></code>: object type of groups within LDAP. Default value is
group for AD and <strong>groupOfUniqueNames</strong> for openldap.</li>
<li><code class="docutils literal notranslate"><span class="pre">ldap.group.user.uniquemember</span></code>: attribute for uniquemembers within a group.
Default value is <strong>member</strong> for AD and <strong>uniquemember</strong> for openldap.</li>
</ul>
<p>Once configured, on Add Account page, you will see an “Add LDAP Account” button
which opens a dialog and the selected users can be imported.</p>
<div class="figure align-center">
<img alt="_images/CloudStack-ldap-screen1.png" src="_images/CloudStack-ldap-screen1.png" />
</div>
<p>You could also use api commands: <code class="docutils literal notranslate"><span class="pre">listLdapUsers</span></code>, <code class="docutils literal notranslate"><span class="pre">ldapCreateAccount</span></code> and
<code class="docutils literal notranslate"><span class="pre">importLdapUsers</span></code>.</p>
<p>Once LDAP is enabled, the users will not be allowed to changed password
directly in cloudstack.</p>
</div>
</div>
<div class="section" id="using-a-saml-2-0-identity-provider-for-user-authentication">
<h2>使用 SAML 2.0 作用户认证<a class="headerlink" href="accounts.html#using-a-saml-2-0-identity-provider-for-user-authentication" title="Permalink to this headline">¶</a></h2>
<p>You can use a SAML 2.0 Identity Provider with CloudStack for user
authentication. This will require enabling the SAML 2.0 service provider plugin
in CloudStack. To do that first, enable the SAML plugin by setting
<code class="docutils literal notranslate"><span class="pre">saml2.enabled</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> and restart management server.</p>
<p>Starting 4.5.2, the SAML plugin uses an authorization workflow where users should
be authorized by an admin using <code class="docutils literal notranslate"><span class="pre">authorizeSamlSso</span></code> API before those users can
use Single Sign On against a specific IDP. This can be done by ticking the enable
SAML Single Sign On checkbox and selecting a IDP when adding or importing users.
For existing users, admin can go to the user’s page and click on configure
SAML SSO option to enable/disable SSO for a user and select a Identity Provider.
A user can be authorized to authenticate against only one IDP.</p>
<p>The CloudStack service provider metadata is accessible using the
<code class="docutils literal notranslate"><span class="pre">getSPMetadata</span></code> API command, or from the URL
<a class="reference external" href="http://acs-server:8080/client/api?command=getSPMetadata">http://acs-server:8080/client/api?command=getSPMetadata</a> where acs-server is the
domain name or IP address of the management server. The IDP administrator can
get the SP metadata from CloudStack and add it to their IDP server.</p>
<p>To start a SAML 2.0 Single Sign-On authentication, on the login page users need to
select the Identity Provider or Institution/Department they can authenticate with
and click on Login button. This action call the <code class="docutils literal notranslate"><span class="pre">samlsso</span></code> API command which
will redirect the user to the Identity Provider’s login page. Upon successful
authentication, the IdP will redirect the user to CloudStack. In case a user has
multiple user accounts with the same username (across domains) for the same
authorized IDP, that user would need to specify domainpath after selecting their
IDP server from the dropdown list. By default, users don’t need to specify any
domain path. After a user is successfully authenticated by an IDP server, the SAML
authentication plugin finds user accounts whose username match the username
attribute value returned by the SAML authentication response; it fails
only when it finds that there are multiple user accounts with the same user name
for the specific IDP otherwise the unique useraccount is allowed to proceed and
the user is logged into their account.</p>
<p>Limitations:</p>
<ul class="simple">
<li>The plugin uses a user attribute returned by the IDP server in the SAML response
to find and map the authorized user in CloudStack. The default attribute is <cite>uid</cite>.</li>
<li>The SAML authentication plugin supports HTTP-Redirect and HTTP-Post bindings.</li>
<li>Tested with Shibboleth 2.4, SSOCircle, Microsoft ADFS, OneLogin, Feide OpenIDP,
PingIdentity.</li>
</ul>
<p>The following global configuration should be configured:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">saml2.enabled</span></code>: Indicates whether SAML SSO plugin is enabled or not true. Default is <strong>false</strong></li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.sp.id</span></code>: SAML2 Service Provider Identifier string</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.idp.metadata.url</span></code>: SAML2 Identity Provider Metadata XML Url or Filename. If a URL is not provided, it will look for a file in the config directory /etc/cloudstack/management</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.default.idpid</span></code>: The default IdP entity ID to use only in case of multiple IdPs</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.sigalg</span></code>: The algorithm to use to when signing a SAML request. Default is SHA1, allowed algorithms: SHA1, SHA256, SHA384, SHA512.</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.redirect.url</span></code>: The CloudStack UI url the SSO should redirected to when successful. Default is <strong>http://localhost:8080/client</strong></li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.sp.org.name</span></code>: SAML2 Service Provider Organization Name</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.sp.org.url</span></code>: SAML2 Service Provider Organization URL</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.sp.contact.email</span></code>: SAML2 Service Provider Contact Email Address</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.sp.contact.person</span></code>: SAML2 Service Provider Contact Person Name</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.sp.slo.url</span></code>: SAML2 CloudStack Service Provider Single Log Out URL</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.sp.sso.url</span></code>: SAML2 CloudStack Service Provider Single Sign On URL</li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.user.attribute</span></code>: Attribute name to be looked for in SAML response that will contain the username. Default is <strong>uid</strong></li>
<li><code class="docutils literal notranslate"><span class="pre">saml2.timeout</span></code>: SAML2 IDP Metadata refresh interval in seconds, minimum value is set to 300. Default is 1800</li>
</ul>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="accounts.html#">Back to top</a>
          | <a href="ui.html" title="Previous Chapter: 用户界面"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 用户界面</span>
          </a>
          | <a href="projects.html" title="Next Chapter: 用项目来管理用户和资源"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">用项目来管理用户和资源 &raquo;</span>
          </a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/accounts.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2016, Apache Software Foundation.<br/>
    </p>
  </div>
</footer>
  </body>
</html>