<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>主机 &#8212; Apache CloudStack Administration Documentation 4.11.0.0 documentation</title>
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.readthedocs.org/static/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.2.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="存储" href="storage.html" />
    <link rel="prev" title="模板" href="templates.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="hosts.html" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'hosts'
READTHEDOCS_DATA['source_suffix'] = '.rst'
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          管理员手册</a>
        <span class="navbar-text navbar-version pull-left"><b>4.11</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
                <a role="button"
                   id="dLabelGlobalToc"
                   data-toggle="dropdown"
                   data-target="#"
                   href="index.html">Sections <b class="caret"></b></a>
                <ul class="dropdown-menu globaltoc"
                    role="menu"
                    aria-labelledby="dLabelGlobalToc">
                     <ul>
<li class="toctree-l1"><a class="reference internal" href="ui.html">用户界面</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="accounts.html">管理角色、账户、用户和域</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="projects.html">用项目来管理用户和资源</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="service_offerings.html">计算方案</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="networking.html">为用户设置网络</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="virtual_machines.html">虚拟机</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="templates.html">模板</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="hosts.html#">主机</a></li>
<li class="toctree-l1"><a class="reference internal" href="hosts.html#security">安全</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="storage.html">存储</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="systemvm.html">系统虚拟机</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Working with Usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="networking_and_traffic.html">Managing Networks and Traffic</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking/using_remote_access.html">Using Remote Access VPN</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="management.html">管理云</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reliability.html">System Reliability and 高可用</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="plugins/quota.html">Quota Plugin</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tuning.html">调优</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="events.html">Event Notification</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">故障排除</a></li>
</ul>


                </ul>
              </li>
              
                
              
            
            
              
                
  <li>
    <a href="templates.html" title="Previous Chapter: 模板"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 模板</span>
    </a>
  </li>
  <li>
    <a href="storage.html" title="Next Chapter: 存储"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">存储 &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="hosts.html#">主机</a><ul>
<li><a class="reference internal" href="hosts.html#adding-hosts">添加主机</a></li>
<li><a class="reference internal" href="hosts.html#scheduled-maintenance-and-maintenance-mode-for-hosts">Scheduled Maintenance and Maintenance Mode for Hosts</a><ul>
<li><a class="reference internal" href="hosts.html#vcenter-and-maintenance-mode">vCenter and Maintenance Mode</a></li>
<li><a class="reference internal" href="hosts.html#xenserver-and-maintenance-mode">XenServer and Maintenance Mode</a></li>
</ul>
</li>
<li><a class="reference internal" href="hosts.html#disabling-and-enabling-zones-pods-and-clusters">资源域、池和集群的启用和禁用</a></li>
<li><a class="reference internal" href="hosts.html#removing-hosts">删除主机</a><ul>
<li><a class="reference internal" href="hosts.html#removing-xenserver-and-kvm-hosts">Removing XenServer and KVM Hosts</a></li>
<li><a class="reference internal" href="hosts.html#removing-vsphere-hosts">Removing vSphere Hosts</a></li>
</ul>
</li>
<li><a class="reference internal" href="hosts.html#re-installing-hosts">Re-Installing Hosts</a></li>
<li><a class="reference internal" href="hosts.html#maintaining-hypervisors-on-hosts">Maintaining Hypervisors on Hosts</a></li>
<li><a class="reference internal" href="hosts.html#changing-host-password">修改主机密码</a></li>
<li><a class="reference internal" href="hosts.html#over-provisioning-and-service-offering-limits">Over-Provisioning and Service Offering Limits</a><ul>
<li><a class="reference internal" href="hosts.html#limitations-on-over-provisioning-in-xenserver-and-kvm">Limitations on Over-Provisioning in XenServer and KVM</a></li>
<li><a class="reference internal" href="hosts.html#requirements-for-over-provisioning">Requirements for Over-Provisioning</a><ul>
<li><a class="reference internal" href="hosts.html#balloon-driver">Balloon Driver</a><ul>
<li><a class="reference internal" href="hosts.html#xenserver">XenServer</a></li>
<li><a class="reference internal" href="hosts.html#vmware">VMware</a></li>
<li><a class="reference internal" href="hosts.html#kvm">KVM</a></li>
</ul>
</li>
<li><a class="reference internal" href="hosts.html#hypervisor-capabilities">Hypervisor capabilities</a><ul>
<li><a class="reference internal" href="hosts.html#id3">XenServer</a></li>
<li><a class="reference internal" href="hosts.html#vmware-kvm">VMware, KVM</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="hosts.html#setting-over-provisioning-ratios">Setting Over-Provisioning Ratios</a></li>
<li><a class="reference internal" href="hosts.html#service-offering-limits-and-over-provisioning">Service Offering Limits and Over-Provisioning</a></li>
</ul>
</li>
<li><a class="reference internal" href="hosts.html#vlan-provisioning">VLAN Provisioning</a><ul>
<li><a class="reference internal" href="hosts.html#vlan-allocation-example">VLAN 划分示例</a></li>
<li><a class="reference internal" href="hosts.html#adding-non-contiguous-vlan-ranges">Adding Non Contiguous VLAN Ranges</a></li>
<li><a class="reference internal" href="hosts.html#assigning-vlans-to-isolated-networks">Assigning VLANs to Isolated Networks</a></li>
</ul>
</li>
<li><a class="reference internal" href="hosts.html#out-of-band-management">Out-of-band Management</a></li>
</ul>
</li>
<li><a class="reference internal" href="hosts.html#security">安全</a><ul>
<li><a class="reference internal" href="hosts.html#server-address-usage">Server Address Usage</a></li>
<li><a class="reference internal" href="hosts.html#securing-process">Securing Process</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9">
      
  <div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>NOTICE: THIS DOCUMENTATION SITE HAS BEEN SUPERSEDED.</p>
<p class="last">For the current documentation site goto: <a class="reference external" href="../../../../index.html">http://docs.cloudstack.apache.org</a></p>
</div>
<div class="section" id="working-with-hosts">
<h1>主机<a class="headerlink" href="hosts.html#working-with-hosts" title="Permalink to this headline">¶</a></h1>
<div class="section" id="adding-hosts">
<h2>添加主机<a class="headerlink" href="hosts.html#adding-hosts" title="Permalink to this headline">¶</a></h2>
<p>可以随时通过增加主机来增加来宾虚拟机的容量。 For requirements and instructions, see
<a class="reference external" href="http://docs.cloudstack.apache.org/projects/cloudstack-installation.html/en/latest/configuration.html#adding-a-host">“Adding a Host”</a>.</p>
</div>
<div class="section" id="scheduled-maintenance-and-maintenance-mode-for-hosts">
<h2>Scheduled Maintenance and Maintenance Mode for Hosts<a class="headerlink" href="hosts.html#scheduled-maintenance-and-maintenance-mode-for-hosts" title="Permalink to this headline">¶</a></h2>
<p>You can place a host into maintenance mode. When maintenance mode is
activated, the host becomes unavailable to receive new guest VMs, and
the guest VMs already running on the host are seamlessly migrated to
another host not in maintenance mode. This migration uses live migration
technology and does not interrupt the execution of the guest.</p>
<div class="section" id="vcenter-and-maintenance-mode">
<h3>vCenter and Maintenance Mode<a class="headerlink" href="hosts.html#vcenter-and-maintenance-mode" title="Permalink to this headline">¶</a></h3>
<p>To enter maintenance mode on a vCenter host, both vCenter and CloudStack
must be used in concert. CloudStack and vCenter have separate
maintenance modes that work closely together.</p>
<ol class="arabic">
<li><p class="first">Place the host into CloudStack’s “scheduled maintenance” mode. This
does not invoke the vCenter maintenance mode, but only causes VMs to
be migrated off the host</p>
<p>When the CloudStack maintenance mode is requested, the host first
moves into the Prepare for Maintenance state. In this state it cannot
be the target of new guest VM starts. Then all VMs will be migrated
off the server. Live migration will be used to move VMs off the host.
This allows the guests to be migrated to other hosts with no
disruption to the guests. After this migration is completed, the host
will enter the Ready for Maintenance mode.</p>
</li>
<li><p class="first">Wait for the “Ready for Maintenance” indicator to appear in the UI.</p>
</li>
<li><p class="first">Now use vCenter to perform whatever actions are necessary to maintain
the host. During this time, the host cannot be the target of new VM
allocations.</p>
</li>
<li><p class="first">When the maintenance tasks are complete, take the host out of
maintenance mode as follows:</p>
<ol class="arabic">
<li><p class="first">First use vCenter to exit the vCenter maintenance mode.</p>
<p>This makes the host ready for CloudStack to reactivate it.</p>
</li>
<li><p class="first">Then use CloudStack’s administrator UI to cancel the CloudStack
maintenance mode</p>
<p>When the host comes back online, the VMs that were migrated off of
it may be migrated back to it manually and new VMs can be added.</p>
</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="xenserver-and-maintenance-mode">
<h3>XenServer and Maintenance Mode<a class="headerlink" href="hosts.html#xenserver-and-maintenance-mode" title="Permalink to this headline">¶</a></h3>
<p>For XenServer, you can take a server offline temporarily by using the
Maintenance Mode feature in XenCenter. When you place a server into
Maintenance Mode, all running VMs are automatically migrated from it to
another host in the same pool. If the server is the pool master, a new
master will also be selected for the pool. While a server is Maintenance
Mode, you cannot create or start any VMs on it.</p>
<p><strong>To place a server in Maintenance Mode:</strong></p>
<ol class="arabic simple">
<li>In the Resources pane, select the server, then do one of the
following:<ul>
<li>Right-click, then click Enter Maintenance Mode on the shortcut
menu.</li>
<li>On the Server menu, click Enter Maintenance Mode.</li>
</ul>
</li>
<li>Click Enter Maintenance Mode.</li>
</ol>
<p>The server’s status in the Resources pane shows when all running VMs
have been successfully migrated off the server.</p>
<p><strong>To take a server out of Maintenance Mode:</strong></p>
<ol class="arabic simple">
<li>In the Resources pane, select the server, then do one of the
following:<ul>
<li>Right-click, then click Exit Maintenance Mode on the shortcut
menu.</li>
<li>On the Server menu, click Exit Maintenance Mode.</li>
</ul>
</li>
<li>Click Exit Maintenance Mode.</li>
</ol>
</div>
</div>
<div class="section" id="disabling-and-enabling-zones-pods-and-clusters">
<h2>资源域、池和集群的启用和禁用<a class="headerlink" href="hosts.html#disabling-and-enabling-zones-pods-and-clusters" title="Permalink to this headline">¶</a></h2>
<p>You can enable or disable a zone, pod, or cluster without permanently
removing it from the cloud. This is useful for maintenance or when there
are problems that make a portion of the cloud infrastructure unreliable.
No new allocations will be made to a disabled zone, pod, or cluster
until its state is returned to Enabled. When a zone, pod, or cluster is
first added to the cloud, it is Disabled by default.</p>
<p>To disable and enable a zone, pod, or cluster:</p>
<ol class="arabic simple">
<li>Log in to the CloudStack UI as administrator</li>
<li>In the left navigation bar, click Infrastructure.</li>
<li>In Zones, click View More.</li>
<li>If you are disabling or enabling a zone, find the name of the zone in
the list, and click the Enable/Disable button. <img alt="button to enable or disable zone, pod, or cluster." src="_images/enable-disable.png" /></li>
<li>If you are disabling or enabling a pod or cluster, click the name of
the zone that contains the pod or cluster.</li>
<li>Click the Compute tab.</li>
<li>In the Pods or Clusters node of the diagram, click View All.</li>
<li>Click the pod or cluster name in the list.</li>
<li>Click the Enable/Disable button. <img alt="button to enable or disable zone, pod, or cluster." src="_images/enable-disable.png" /></li>
</ol>
</div>
<div class="section" id="removing-hosts">
<h2>删除主机<a class="headerlink" href="hosts.html#removing-hosts" title="Permalink to this headline">¶</a></h2>
<p>Hosts can be removed from the cloud as needed. The procedure to remove a
host depends on the hypervisor type.</p>
<div class="section" id="removing-xenserver-and-kvm-hosts">
<h3>Removing XenServer and KVM Hosts<a class="headerlink" href="hosts.html#removing-xenserver-and-kvm-hosts" title="Permalink to this headline">¶</a></h3>
<p>A node cannot be removed from a cluster until it has been placed in
maintenance mode. This will ensure that all of the VMs on it have been
migrated to other Hosts. To remove a Host from the cloud:</p>
<ol class="arabic">
<li><p class="first">Place the node in maintenance mode.</p>
<p>See <a class="reference external" href="hosts.html#scheduled-maintenance-and-maintenance-mode-for-hosts">“Scheduled Maintenance and Maintenance Mode for
Hosts”</a>.</p>
</li>
<li><p class="first">For KVM, stop the cloud-agent service.</p>
</li>
<li><p class="first">Use the UI option to remove the node.</p>
<p>Then you may power down the Host, re-use its IP address, re-install
it, etc</p>
</li>
</ol>
</div>
<div class="section" id="removing-vsphere-hosts">
<h3>Removing vSphere Hosts<a class="headerlink" href="hosts.html#removing-vsphere-hosts" title="Permalink to this headline">¶</a></h3>
<p>To remove this type of host, first place it in maintenance mode, as
described in <a class="reference external" href="hosts.html#scheduled-maintenance-and-maintenance-mode-for-hosts">“Scheduled Maintenance and Maintenance Mode
for Hosts”</a>. Then use
CloudStack to remove the host. CloudStack will not direct commands to a
host that has been removed using CloudStack. However, the host may still
exist in the vCenter cluster.</p>
</div>
</div>
<div class="section" id="re-installing-hosts">
<h2>Re-Installing Hosts<a class="headerlink" href="hosts.html#re-installing-hosts" title="Permalink to this headline">¶</a></h2>
<p>You can re-install a host after placing it in maintenance mode and then
removing it. If a host is down and cannot be placed in maintenance mode,
it should still be removed before the re-install.</p>
</div>
<div class="section" id="maintaining-hypervisors-on-hosts">
<h2>Maintaining Hypervisors on Hosts<a class="headerlink" href="hosts.html#maintaining-hypervisors-on-hosts" title="Permalink to this headline">¶</a></h2>
<p>When running hypervisor software on hosts, be sure all the hotfixes
provided by the hypervisor vendor are applied. Track the release of
hypervisor patches through your hypervisor vendor’s support channel, and
apply patches as soon as possible after they are released. CloudStack
will not track or notify you of required hypervisor patches. It is
essential that your hosts are completely up to date with the provided
hypervisor patches. The hypervisor vendor is likely to refuse to support
any system that is not up to date with patches.</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">The lack of up-do-date hotfixes can lead to data corruption and lost VMs.</p>
</div>
<p>(XenServer) For more information, see
<a class="reference external" href="http://docs.cloudstack.org/Knowledge_Base/Possible_VM_corruption_if_XenServer_Hotfix_is_not_Applied/Highly_Recommended_Hotfixes_for_XenServer_5.6_SP2">Highly Recommended Hotfixes for XenServer in the CloudStack Knowledge Base</a>.</p>
</div>
<div class="section" id="changing-host-password">
<h2>修改主机密码<a class="headerlink" href="hosts.html#changing-host-password" title="Permalink to this headline">¶</a></h2>
<p>The password for a XenServer Node, KVM Node, or vSphere Node may be
changed in the database. Note that all Nodes in a 集群 must have the
same password.</p>
<p>To change a Node’s password:</p>
<ol class="arabic">
<li><p class="first">Identify all hosts in the cluster.</p>
</li>
<li><p class="first">Change the password on all hosts in the cluster. Now the password for
the host and the password known to CloudStack will not match.
Operations on the cluster will fail until the two passwords match.</p>
</li>
<li><p class="first">if the password in the database is encrypted, it is (likely) necessary to
encrypt the new password using the database key before adding it to the database.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="o">-</span><span class="n">classpath</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">cloudstack</span><span class="o">-</span><span class="n">common</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">jasypt</span><span class="o">-</span><span class="mf">1.9</span><span class="o">.</span><span class="mf">0.</span><span class="n">jar</span> \
<span class="n">org</span><span class="o">.</span><span class="n">jasypt</span><span class="o">.</span><span class="n">intf</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">JasyptPBEStringEncryptionCLI</span> \
<span class="n">encrypt</span><span class="o">.</span><span class="n">sh</span> <span class="nb">input</span><span class="o">=</span><span class="s2">&quot;newrootpassword&quot;</span> \
<span class="n">password</span><span class="o">=</span><span class="s2">&quot;databasekey&quot;</span> \
<span class="n">verbose</span><span class="o">=</span><span class="n">false</span>
</pre></div>
</div>
</li>
<li><p class="first">Get the list of host IDs for the host in the cluster where you are
changing the password. You will need to access the database to
determine these host IDs. For each hostname “h” (or vSphere cluster)
that you are changing the password for, execute:</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="nb">id</span> <span class="n">FROM</span> <span class="n">cloud</span><span class="o">.</span><span class="n">host</span> <span class="n">WHERE</span> <span class="n">name</span> <span class="n">like</span> <span class="s1">&#39;</span><span class="si">%h%</span><span class="s1">&#39;</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">This should return a single ID. Record the set of such IDs for these
hosts. Now retrieve the host_details row id for the host</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">cloud</span><span class="o">.</span><span class="n">host_details</span> <span class="n">WHERE</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password&#39;</span> <span class="n">AND</span> <span class="n">host_id</span><span class="o">=</span><span class="p">{</span><span class="n">previous</span> <span class="n">step</span> <span class="n">ID</span><span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the passwords for the host in the database. In this example,
we change the passwords for hosts with host IDs 5 and 12 and host_details IDs 8 and 22 to
“password”.</p>
<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">UPDATE</span> <span class="n">cloud</span><span class="o">.</span><span class="n">host_details</span> <span class="n">SET</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;password&#39;</span> <span class="n">WHERE</span> <span class="nb">id</span><span class="o">=</span><span class="mi">8</span> <span class="n">OR</span> <span class="nb">id</span><span class="o">=</span><span class="mi">22</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="over-provisioning-and-service-offering-limits">
<h2>Over-Provisioning and Service Offering Limits<a class="headerlink" href="hosts.html#over-provisioning-and-service-offering-limits" title="Permalink to this headline">¶</a></h2>
<p>(Supported for XenServer, KVM, and VMware)</p>
<p>CPU and memory (RAM) over-provisioning factors can be set for each
cluster to change the number of VMs that can run on each host in the
cluster. This helps optimize the use of resources. By increasing the
over-provisioning ratio, more resource capacity will be used. If the
ratio is set to 1, no over-provisioning is done.</p>
<p>The administrator can also set global default over-provisioning ratios
in the cpu.overprovisioning.factor and mem.overprovisioning.factor
global configuration variables. The default value of these variables is
1: over-provisioning is turned off by default.</p>
<p>Over-provisioning ratios are dynamically substituted in CloudStack’s
capacity calculations. For example:</p>
<p>Capacity = 2 GB
Over-provisioning factor = 2
Capacity after over-provisioning = 4 GB</p>
<p>With this configuration, suppose you deploy 3 VMs of 1 GB each:</p>
<p>Used = 3 GB
Free = 1 GB</p>
<p>The administrator can specify a memory over-provisioning ratio, and can
specify both CPU and memory over-provisioning ratios on a per-cluster
basis.</p>
<p>In any given cloud, the optimum number of VMs for each host is affected
by such things as the hypervisor, storage, and hardware configuration.
These may be different for each cluster in the same cloud. A single
global over-provisioning setting can not provide the best utilization
for all the different clusters in the cloud. It has to be set for the
lowest common denominator. The per-cluster setting provides a finer
granularity for better utilization of resources, no matter where the
CloudStack placement algorithm decides to place a VM.</p>
<p>The overprovisioning settings can be used along with dedicated resources
(assigning a specific cluster to an account) to effectively offer
different levels of service to different accounts. For example, an
account paying for a more expensive level of service could be assigned
to a dedicated cluster with an over-provisioning ratio of 1, and a
lower-paying account to a cluster with a ratio of 2.</p>
<p>When a new host is added to a cluster, CloudStack will assume the host
has the capability to perform the CPU and RAM over-provisioning which is
configured for that cluster. It is up to the administrator to be sure
the host is actually suitable for the level of over-provisioning which
has been set.</p>
<div class="section" id="limitations-on-over-provisioning-in-xenserver-and-kvm">
<h3>Limitations on Over-Provisioning in XenServer and KVM<a class="headerlink" href="hosts.html#limitations-on-over-provisioning-in-xenserver-and-kvm" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>In XenServer, due to a constraint of this hypervisor, you can not use
an over-provisioning factor greater than 4.</li>
<li>The KVM hypervisor can not manage memory allocation to VMs
dynamically. CloudStack sets the minimum and maximum amount of memory
that a VM can use. The hypervisor adjusts the memory within the set
limits based on the memory contention.</li>
</ul>
</div>
<div class="section" id="requirements-for-over-provisioning">
<h3>Requirements for Over-Provisioning<a class="headerlink" href="hosts.html#requirements-for-over-provisioning" title="Permalink to this headline">¶</a></h3>
<p>Several prerequisites are required in order for over-provisioning to
function properly. The feature is dependent on the OS type, hypervisor
capabilities, and certain scripts. It is the administrator’s
responsibility to ensure that these requirements are met.</p>
<div class="section" id="balloon-driver">
<h4>Balloon Driver<a class="headerlink" href="hosts.html#balloon-driver" title="Permalink to this headline">¶</a></h4>
<p>All VMs should have a balloon driver installed in them. The hypervisor
communicates with the balloon driver to free up and make the memory
available to a VM.</p>
<div class="section" id="xenserver">
<h5>XenServer<a class="headerlink" href="hosts.html#xenserver" title="Permalink to this headline">¶</a></h5>
<p>The balloon driver can be found as a part of xen pv or PVHVM drivers.
The xen pvhvm drivers are included in upstream linux kernels 2.6.36+.</p>
</div>
<div class="section" id="vmware">
<h5>VMware<a class="headerlink" href="hosts.html#vmware" title="Permalink to this headline">¶</a></h5>
<p>The balloon driver can be found as a part of the VMware tools. All the
VMs that are deployed in a over-provisioned cluster should have the
VMware tools installed.</p>
</div>
<div class="section" id="kvm">
<h5>KVM<a class="headerlink" href="hosts.html#kvm" title="Permalink to this headline">¶</a></h5>
<p>All VMs are required to support the virtio drivers. These drivers are
installed in all Linux kernel versions 2.6.25 and greater. The
administrator must set CONFIG_VIRTIO_BALLOON=y in the virtio
configuration.</p>
</div>
</div>
<div class="section" id="hypervisor-capabilities">
<h4>Hypervisor capabilities<a class="headerlink" href="hosts.html#hypervisor-capabilities" title="Permalink to this headline">¶</a></h4>
<p>The hypervisor must be capable of using the memory ballooning.</p>
<div class="section" id="id3">
<h5>XenServer<a class="headerlink" href="hosts.html#id3" title="Permalink to this headline">¶</a></h5>
<p>The DMC (Dynamic Memory Control) capability of the hypervisor should be
enabled. Only XenServer Advanced and above versions have this feature.</p>
</div>
<div class="section" id="vmware-kvm">
<h5>VMware, KVM<a class="headerlink" href="hosts.html#vmware-kvm" title="Permalink to this headline">¶</a></h5>
<p>Memory ballooning is supported by default.</p>
</div>
</div>
</div>
<div class="section" id="setting-over-provisioning-ratios">
<h3>Setting Over-Provisioning Ratios<a class="headerlink" href="hosts.html#setting-over-provisioning-ratios" title="Permalink to this headline">¶</a></h3>
<p>There are two ways the root admin can set CPU and RAM over-provisioning
ratios. First, the global configuration settings
cpu.overprovisioning.factor and mem.overprovisioning.factor will be
applied when a new cluster is created. Later, the ratios can be modified
for an existing cluster.</p>
<p>Only VMs deployed after the change are affected by the new setting. If
you want VMs deployed before the change to adopt the new
over-provisioning ratio, you must stop and restart the VMs. When this is
done, CloudStack recalculates or scales the used and reserved capacities
based on the new over-provisioning ratios, to ensure that CloudStack is
correctly tracking the amount of free capacity.</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">It is safer not to deploy additional new VMs while the capacity
recalculation is underway, in case the new values for available
capacity are not high enough to accommodate the new VMs. Just wait
for the new used/available values to become available, to be sure
there is room for all the new VMs you want.</p>
</div>
<p>To change the over-provisioning ratios for an existing cluster:</p>
<ol class="arabic">
<li><p class="first">Log in as administrator to the CloudStack UI.</p>
</li>
<li><p class="first">In the left navigation bar, click Infrastructure.</p>
</li>
<li><p class="first">Under Clusters, click View All.</p>
</li>
<li><p class="first">Select the cluster you want to work with, and click the Edit button.</p>
</li>
<li><p class="first">Fill in your desired over-provisioning multipliers in the fields CPU
overcommit ratio and RAM overcommit ratio. The value which is
intially shown in these fields is the default value inherited from
the global configuration settings.</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">In XenServer, due to a constraint of this hypervisor, you can not
use an over-provisioning factor greater than 4.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="service-offering-limits-and-over-provisioning">
<h3>Service Offering Limits and Over-Provisioning<a class="headerlink" href="hosts.html#service-offering-limits-and-over-provisioning" title="Permalink to this headline">¶</a></h3>
<p>Service offering limits (e.g. 1 GHz, 1 core) are strictly enforced for
core count. For example, a guest with a service offering of one core
will have only one core available to it regardless of other activity on
the Host.</p>
<p>Service offering limits for gigahertz are enforced only in the presence
of contention for CPU resources. For example, suppose that a guest was
created with a service offering of 1 GHz on a Host that has 2 GHz cores,
and that guest is the only guest running on the Host. The guest will
have the full 2 GHz available to it. When multiple guests are attempting
to use the CPU a weighting factor is used to schedule CPU resources. The
weight is based on the clock speed in the service offering. Guests
receive a CPU allocation that is proportionate to the GHz in the service
offering. For example, a guest created from a 2 GHz service offering
will receive twice the CPU allocation as a guest created from a 1 GHz
service offering. CloudStack does not perform memory over-provisioning.</p>
</div>
</div>
<div class="section" id="vlan-provisioning">
<h2>VLAN Provisioning<a class="headerlink" href="hosts.html#vlan-provisioning" title="Permalink to this headline">¶</a></h2>
<p>CloudStack automatically creates and destroys interfaces bridged to
VLANs on the hosts. In general the administrator does not need to manage
this process.</p>
<p>CloudStack manages VLANs differently based on hypervisor type. For
XenServer or KVM, the VLANs are created on only the hosts where they
will be used and then they are destroyed when all guests that require
them have been terminated or moved to another host.</p>
<p>For vSphere the VLANs are provisioned on all hosts in the cluster even
if there is no guest running on a particular Host that requires the
VLAN. This allows the administrator to perform live migration and other
functions in vCenter without having to create the VLAN on the
destination Host. Additionally, the VLANs are not removed from the Hosts
when they are no longer needed.</p>
<p>You can use the same VLANs on different physical networks provided that
each physical network has its own underlying layer-2 infrastructure,
such as switches. For example, you can specify VLAN range 500 to 1000
while deploying physical networks A and B in an Advanced zone setup.
This capability allows you to set up an additional layer-2 physical
infrastructure on a different physical NIC and use the same set of VLANs
if you run out of VLANs. Another advantage is that you can use the same
set of IPs for different customers, each one with their own routers and
the guest networks on different physical NICs.</p>
<div class="section" id="vlan-allocation-example">
<h3>VLAN 划分示例<a class="headerlink" href="hosts.html#vlan-allocation-example" title="Permalink to this headline">¶</a></h3>
<p>VLANs are required for public and guest traffic. The following is an
example of a VLAN allocation scheme:</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="12%" />
<col width="20%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VLAN IDs</th>
<th class="head">Traffic type</th>
<th class="head">Scope</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>less than 500</td>
<td>Management traffic.</td>
<td>Reserved for administrative purposes.  CloudStack software can access this, hypervisors, system VMs.</td>
</tr>
<tr class="row-odd"><td>500-599</td>
<td>VLAN carrying public traffic.</td>
<td>CloudStack accounts.</td>
</tr>
<tr class="row-even"><td>600-799</td>
<td>VLANs carrying guest traffic.</td>
<td>CloudStack accounts. Account-specific VLAN is chosen from this pool.</td>
</tr>
<tr class="row-odd"><td>800-899</td>
<td>VLANs carrying guest traffic.</td>
<td>CloudStack accounts. Account-specific VLAN chosen by CloudStack admin to assign to that account.</td>
</tr>
<tr class="row-even"><td>900-999</td>
<td>VLAN carrying guest traffic</td>
<td>CloudStack accounts. Can be scoped by project, domain, or all accounts.</td>
</tr>
<tr class="row-odd"><td>greater than 1000</td>
<td>Reserved for future use</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="adding-non-contiguous-vlan-ranges">
<h3>Adding Non Contiguous VLAN Ranges<a class="headerlink" href="hosts.html#adding-non-contiguous-vlan-ranges" title="Permalink to this headline">¶</a></h3>
<p>CloudStack provides you with the flexibility to add non contiguous VLAN
ranges to your network. The administrator can either update an existing
VLAN range or add multiple non contiguous VLAN ranges while creating a
zone. You can also use the UpdatephysicalNetwork API to extend the VLAN
range.</p>
<ol class="arabic">
<li><p class="first">Log in to the CloudStack UI as an administrator or end user.</p>
</li>
<li><p class="first">Ensure that the VLAN range does not already exist.</p>
</li>
<li><p class="first">In the left navigation, choose Infrastructure.</p>
</li>
<li><p class="first">On Zones, click View More, then click the zone to which you want to
work with.</p>
</li>
<li><p class="first">Click Physical Network.</p>
</li>
<li><p class="first">In the Guest node of the diagram, click Configure.</p>
</li>
<li><p class="first">Click Edit <img alt="button to edit the VLAN range." src="_images/edit-icon.png" />.</p>
<p>The VLAN Ranges field now is editable.</p>
</li>
<li><p class="first">Specify the start and end of the VLAN range in comma-separated list.</p>
<p>Specify all the VLANs you want to use, VLANs not specified will be
removed if you are adding new ranges to the existing list.</p>
</li>
<li><p class="first">Click Apply.</p>
</li>
</ol>
</div>
<div class="section" id="assigning-vlans-to-isolated-networks">
<h3>Assigning VLANs to Isolated Networks<a class="headerlink" href="hosts.html#assigning-vlans-to-isolated-networks" title="Permalink to this headline">¶</a></h3>
<p>CloudStack provides you the ability to control VLAN assignment to
Isolated networks. As a Root admin, you can assign a VLAN ID when a
network is created, just the way it’s done for Shared networks.</p>
<p>The former behaviour also is supported — VLAN is randomly allocated to a
network from the VNET range of the physical network when the network
turns to Implemented state. The VLAN is released back to the VNET pool
when the network shuts down as a part of the Network Garbage Collection.
The VLAN can be re-used either by the same network when it is
implemented again, or by any other network. On each subsequent
implementation of a network, a new VLAN can be assigned.</p>
<p>Only the Root admin can assign VLANs because the regular users or domain
admin are not aware of the physical network topology. They cannot even
view what VLAN is assigned to a network.</p>
<p>To enable you to assign VLANs to Isolated networks,</p>
<ol class="arabic">
<li><p class="first">Create a network offering by specifying the following:</p>
<ul class="simple">
<li><strong>Guest Type</strong>: Select Isolated.</li>
<li><strong>Specify VLAN</strong>: Select the option.</li>
</ul>
<p>For more information, see the CloudStack 安装指南.</p>
</li>
<li><p class="first">Using this network offering, create a network.</p>
<p>You can create a VPC tier or an Isolated network.</p>
</li>
<li><p class="first">Specify the VLAN when you create the network.</p>
<p>When VLAN is specified, a CIDR and gateway are assigned to this
network and the state is changed to Setup. In this state, the network
will not be garbage collected.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">You cannot change a VLAN once it’s assigned to the network. The VLAN
remains with the network for its entire life cycle.</p>
</div>
</div>
</div>
<div class="section" id="out-of-band-management">
<h2>Out-of-band Management<a class="headerlink" href="hosts.html#out-of-band-management" title="Permalink to this headline">¶</a></h2>
<p>CloudStack provides Root admins the ability to configure and use supported
out-of-band management interface (e.g. IPMI, iLO, DRAC, etc.) on a physical
host to manage host power operations such as on, off, reset etc. By default,
IPMI 2.0 baseboard controller are supported out of the box with <cite>IPMITOOL</cite>
out-of-band management driver in CloudStack that uses <cite>ipmitool</cite> for performing
IPMI 2.0 management operations.</p>
<p>Following are some global settings that control various aspects of this feature.</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="23%" />
<col width="17%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Global setting</th>
<th class="head">Default values</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>outofbandmanagement.action.timeout</td>
<td>60</td>
<td>The out of band management action timeout in seconds, configurable per cluster</td>
</tr>
<tr class="row-odd"><td>outofbandmanagement.ipmitool.interface</td>
<td>lanplus</td>
<td>The out of band management IpmiTool driver interface to use. Valid values are: lan, lanplus etc</td>
</tr>
<tr class="row-even"><td>outofbandmanagement.ipmitool.path</td>
<td>/usr/bin/ipmitool</td>
<td>The out of band management ipmitool path used by the IpmiTool driver</td>
</tr>
<tr class="row-odd"><td>outofbandmanagement.ipmitool.retries</td>
<td>1</td>
<td>The out of band management IpmiTool driver retries option -R</td>
</tr>
<tr class="row-even"><td>outofbandmanagement.sync.poolsize</td>
<td>50</td>
<td>The out of band management background sync thread pool size 50</td>
</tr>
</tbody>
</table>
<p>A change in <cite>outofbandmanagement.sync.poolsize</cite> settings requires restarting of
management server(s) as the thread pool and a background (power state) sync
thread are configured during load time when CloudStack management server starts.
Rest of the global settings can be changed without requiring restarting of
management server(s).</p>
<p>The <cite>outofbandmanagement.sync.poolsize</cite> is the maximum number of ipmitool
background power state scanners that can run at a time. Based on the maximum
number of hosts you’ve, you can increase/decrease the value depending on how much
stress your management server host can endure. It will take atmost number of
total out-of-band-management enabled hosts in a round *
<cite>outofbandmanagement.action.timeout</cite> / <cite>outofbandmanagement.sync.poolsize</cite> seconds
to complete a background power-state sync scan in a single round.</p>
<p>In order to use this feature, the Root admin needs to first configure
out-of-band management for a host using either the UI or the
<cite>configureOutOfBandManagement</cite> API. Next, the Root admin needs to enable it.
The feature can be enabled or disabled across a zone or a cluster or a host,</p>
<p>Once out-of-band management is configured and enabled for a host (and provided
not disabled at zone or cluster level), Root admins would be able to issue
power management actions such as on, off, reset, cycle, soft and status.</p>
<p>If a host is in maintenance mode, Root admins are still allowed to perform
power management actions but in the UI a warning is displayed.</p>
</div>
</div>
<div class="section" id="security">
<h1>安全<a class="headerlink" href="hosts.html#security" title="Permalink to this headline">¶</a></h1>
<p>Starting 4.11, CloudStack has an inbuilt certicate authority (CA) framework and
a default ‘root’ CA provider which acts as a self-signed CA. The CA framework
participates in certificate issuance, renewal, revocation, and propagation of
certificates during setup of a host. This framework is primary used to
secure communications between CloudStack management server(s), the
KVM/LXC/SSVM/CPVM agent(s) and peer management server(s).</p>
<p>Following are some global settings that control various aspects of this feature.</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Global setting</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ca.framework.provider.plugin</td>
<td>The configured CA provider plugin</td>
</tr>
<tr class="row-odd"><td>ca.framework.cert.keysize</td>
<td>The key size used for certificate generation</td>
</tr>
<tr class="row-even"><td>ca.framework.cert.signature.algorithm</td>
<td>The certificate signature algorithm</td>
</tr>
<tr class="row-odd"><td>ca.framework.cert.validity.period</td>
<td>Certificate validity in days</td>
</tr>
<tr class="row-even"><td>ca.framework.cert.automatic.renewal</td>
<td>Whether to auto-renew expiring certificate on hosts</td>
</tr>
<tr class="row-odd"><td>ca.framework.background.task.delay</td>
<td>The delay between each CA background task round in seconds</td>
</tr>
<tr class="row-even"><td>ca.framework.cert.expiry.alert.period</td>
<td>The number of days to check and alert expiring certificates</td>
</tr>
<tr class="row-odd"><td>ca.plugin.root.private.key</td>
<td>(hidden/encrypted in database) Auto-generated CA private key</td>
</tr>
<tr class="row-even"><td>ca.plugin.root.public.key</td>
<td>(hidden/encrypted in database) CA public key</td>
</tr>
<tr class="row-odd"><td>ca.plugin.root.ca.certificate</td>
<td>(hidden/encrypted in database) CA certificate</td>
</tr>
<tr class="row-even"><td>ca.plugin.root.issuer.dn</td>
<td>The CA issue distinguished name used by the root CA provider</td>
</tr>
<tr class="row-odd"><td>ca.plugin.root.auth.strictness</td>
<td>Setting to enforce two-way SSL authentication and trust validation</td>
</tr>
<tr class="row-even"><td>ca.plugin.root.allow.expired.cert</td>
<td>Setting to allow clients with expired certificates</td>
</tr>
</tbody>
</table>
<p>A change in <cite>ca.framework.background.task.delay</cite> settings requires restarting of
management server(s) as the thread pool and a background tasks are configured
only when CloudStack management server(s) start.</p>
<p>After upgrade to CloudStack 4.11+, the CA framework will by default use the
<cite>root</cite> CA provider. This CA provider will auto-generate its private/public keys
and CA certificate on first boot post-upgrade. For freshly installed
environments, the <cite>ca.plugin.root.auth.strictness</cite> setting will be <cite>true</cite> to
enforce two-way SSL authentication and trust validation between client and
server components, however, it will be <cite>false</cite> on upgraded environments to
be backward compatible with legacy behaviour of trusting all clients and
servers, and one-way SSL authentication. Upgraded/existing environments can
use the <cite>provisionCertificate</cite> API to renew/setup certificates for already
connected agents/hosts, and once all the agents/hosts are secured they may
enforce authentication and validation strictness by setting
<cite>ca.plugin.root.auth.strictness</cite> to <cite>true</cite> and restarting the management
server(s).</p>
<div class="section" id="server-address-usage">
<h2>Server Address Usage<a class="headerlink" href="hosts.html#server-address-usage" title="Permalink to this headline">¶</a></h2>
<p>Historically, when multiple management servers are used a tcp-LB is used on
port 8250 (default) of the management servers and the VIP/LB-IP is used as the
<cite>host</cite> setting to be used by various CloudStack agents such as the KVM, CPVM,
SSVM agents, who connect to the <cite>host</cite> on port 8250. However, starting
CloudStack 4.11+ the <cite>host</cite> setting can accept comma separated list of
management server IPs to which new CloudStack hosts/agents will get a shuffled
list of the same to which they can cycle reconnections in a round-robin way.</p>
</div>
<div class="section" id="securing-process">
<h2>Securing Process<a class="headerlink" href="hosts.html#securing-process" title="Permalink to this headline">¶</a></h2>
<p>Agents while making connections/reconnections to management server will only
validate server certificate and be able to present client certificate (issued to
them) when <cite>cloud.jks</cite> is accessible to them. On older hosts that are setup
prior to this feature the keystore won’t be available, however, they can still
connect to management server(s) if <cite>ca.plugin.root.auth.strictness</cite> is set to
<cite>false</cite>. Management server(s) will check and setup their own <cite>cloud.jks</cite>
keystore on startup, this keystore will be used for connecting to peer
management server(s).</p>
<p>When a new host is being setup, such as adding a KVM host or starting a systemvm
host, the CA framework kicks in and uses ssh to execute <cite>keystore-setup</cite> to
generate a new keystore file <cite>cloud.jks.new</cite>, save a random passphrase of the
keystore in the agent’s properties file and a CSR <cite>cloud.csr</cite> file. The CSR is
then used to issue certificate for that agent/host and ssh is used to execute
<cite>keystore-cert-import</cite> to import the issued certificate along with the CA
certificate(s), the keystore is that renamed as <cite>cloud.jks</cite> replacing an
previous keystore in-use. During this process, keys and certificates files are
also stored in <cite>cloud.key</cite>, <cite>cloud.crt</cite>, <cite>cloud.ca.crt</cite> in the
agent’s configuration directory.</p>
<p>When hosts are added out-of-band, for example a KVM host that is setup first
outside of CloudStack and added to a cluster, the keystore file will not be
available however the keystore and security could be setup by using keystore
utility scripts manually. The <cite>keystore-setup</cite> can be ran first to generate a
keystore and a CSR, then CloudStack CA can be used to issue certificate by
providing the CSR to the <cite>issueCertificate</cite> API, and finally issued certificate
and CA certificate(s) can be imported to the keystore using <cite>keystore-cert-import</cite>
script.</p>
<p>Following lists the usage of these scripts, when using these script use full
paths, use the final keystore filename as <cite>cloud.jks</cite>, and the certificate/key
content need to be encoded and provided such that newlines are replace with <cite>^</cite>
and space are replaced with <cite>~</cite>:</p>
<blockquote>
<div><p>keystore-setup &lt;properties file&gt; &lt;keystore file&gt; &lt;passphrase&gt; &lt;validity&gt; &lt;csr file&gt;</p>
<p>keystore-cert-import &lt;properties file&gt; &lt;keystore file&gt; &lt;mode: ssh|agent&gt; &lt;cert file&gt; &lt;cert content&gt; &lt;ca-cert file&gt; &lt;ca-cert content&gt; &lt;private-key file&gt; &lt;private key content:optional&gt;</p>
</div></blockquote>
<p>Starting 4.11.1, a KVM host is considered secured when it has its keystore and
certificates setup for both the agent and libvirtd process. A secured host will
only allow and initiate TLS enabled live VM migration. This requires libvirtd
to listen on default port 16514, and the port to be allowed in the firewall
rules. Certificate renewal (using the <cite>provisionCertificate</cite> API) will restart
both the libvirtd process and agent after deploying new certificates.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="hosts.html#">Back to top</a>
          | <a href="templates.html" title="Previous Chapter: 模板"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 模板</span>
          </a>
          | <a href="storage.html" title="Next Chapter: 存储"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">存储 &raquo;</span>
          </a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/hosts.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2016, Apache Software Foundation.<br/>
    </p>
  </div>
</footer>
  </body>
</html>