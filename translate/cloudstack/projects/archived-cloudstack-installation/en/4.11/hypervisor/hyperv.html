<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Hyper-V 安装 &#8212; Apache CloudStack 安装 Documentation 4.11.0.0 documentation</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.2.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="KVM 安装" href="kvm.html" />
    <link rel="prev" title="安装配置 CloudStack " href="../configuration.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="hyperv.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'hypervisor/hyperv'
READTHEDOCS_DATA['source_suffix'] = '.rst'
</script>

<script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          安装指南</a>
        <span class="navbar-text navbar-version pull-left"><b>4.11</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
                <a role="button"
                   id="dLabelGlobalToc"
                   data-toggle="dropdown"
                   data-target="#"
                   href="../index.html">Sections <b class="caret"></b></a>
                <ul class="dropdown-menu globaltoc"
                    role="menu"
                    aria-labelledby="dLabelGlobalToc">
                     <ul>
<li class="toctree-l1"><a class="reference internal" href="../choosing_deployment_architecture.html">架构选型</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../qig.html">快速安装向导 for CentOS 6</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../building_from_source.html">从源码编译安装</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">安装概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="../management-server/index.html">安装管理服务</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">安装配置 CloudStack </a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="hyperv.html#">Hyper-V 安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="kvm.html">KVM 安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="lxc.html">LXC 安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="vsphere.html">VMware vSphere 安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="xenserver.html">Citrix XenServer 安装</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network_setup.html">网络配置</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../storage_setup.html">存储配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage_setup.html#small-scale-setup">Small-Scale Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage_setup.html#large-scale-setup">Large-Scale Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage_setup.html#storage-architecture">存储架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../storage_setup.html#network-configuration-for-storage">Network Configuration For Storage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../optional_installation.html">Additional 安装 Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../encryption.html">密码和加密密钥</a></li>
</ul>


                </ul>
              </li>
              
                
              
            
            
              
                
  <li>
    <a href="../configuration.html" title="Previous Chapter: 安装配置 CloudStack "><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 安装配置 CloudStack </span>
    </a>
  </li>
  <li>
    <a href="kvm.html" title="Next Chapter: KVM 安装"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">KVM 安装 &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="hyperv.html#">Hyper-V 安装</a><ul>
<li><a class="reference internal" href="hyperv.html#system-requirements-for-hyper-v-hypervisor-hosts">System Requirements for Hyper-V Hypervisor Hosts</a><ul>
<li><a class="reference internal" href="hyperv.html#supported-operating-systems-for-hyper-v-hosts">Supported Operating Systems for Hyper-V Hosts</a></li>
<li><a class="reference internal" href="hyperv.html#minimum-system-requirements-for-hyper-v-hosts">Minimum System Requirements for Hyper-V Hosts</a></li>
<li><a class="reference internal" href="hyperv.html#supported-storage">Supported Storage</a></li>
</ul>
</li>
<li><a class="reference internal" href="hyperv.html#preparation-checklist-for-hyper-v">Preparation Checklist for Hyper-V</a></li>
<li><a class="reference internal" href="hyperv.html#hyper-v-installation-steps">Hyper-V 安装 Steps</a></li>
<li><a class="reference internal" href="hyperv.html#installing-the-cloudstack-agent-on-a-hyper-v-host">Installing the CloudStack Agent on a Hyper-V Host</a></li>
<li><a class="reference internal" href="hyperv.html#physical-network-configuration-for-hyper-v">Physical Network Configuration for Hyper-V</a></li>
<li><a class="reference internal" href="hyperv.html#storage-preparation-for-hyper-v-optional">Storage Preparation for Hyper-V (Optional)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9">
      
  <div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>NOTICE: THIS DOCUMENTATION SITE HAS BEEN SUPERSEDED.</p>
<p class="last">For the current documentation site goto: <a class="reference external" href="../../../../../index.html">http://docs.cloudstack.apache.org</a></p>
</div>
<div class="section" id="host-hyper-v-installation">
<h1>Hyper-V 安装<a class="headerlink" href="hyperv.html#host-hyper-v-installation" title="Permalink to this headline">¶</a></h1>
<p>If you want to use Hyper-V hypervisor to run guest virtual machines,
install Hyper-V on the hosts in your cloud. The instructions in this
section doesn’t duplicate Hyper-V 安装 documentation. It
provides the CloudStack-specific steps that are needed to prepare a
Hyper-V host to work with CloudStack.</p>
<div class="section" id="system-requirements-for-hyper-v-hypervisor-hosts">
<h2>System Requirements for Hyper-V Hypervisor Hosts<a class="headerlink" href="hyperv.html#system-requirements-for-hyper-v-hypervisor-hosts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="supported-operating-systems-for-hyper-v-hosts">
<h3>Supported Operating Systems for Hyper-V Hosts<a class="headerlink" href="hyperv.html#supported-operating-systems-for-hyper-v-hosts" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Windows Server 2012 R2 Standard</li>
<li>Windows Server 2012 R2 Datacenter</li>
<li>Hyper-V 2012 R2</li>
</ul>
</div>
<div class="section" id="minimum-system-requirements-for-hyper-v-hosts">
<h3>Minimum System Requirements for Hyper-V Hosts<a class="headerlink" href="hyperv.html#minimum-system-requirements-for-hyper-v-hosts" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>1.4 GHz 64-bit processor with hardware-assisted virtualization.</li>
<li>800 MB of RAM</li>
<li>32 GB of disk space</li>
<li>Gigabit (10/100/1000baseT) Ethernet adapter</li>
</ul>
</div>
<div class="section" id="supported-storage">
<h3>Supported Storage<a class="headerlink" href="hyperv.html#supported-storage" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>主存储: Server Message Block (SMB) Version 3, Local</li>
<li>二级存储: SMB</li>
</ul>
</div>
</div>
<div class="section" id="preparation-checklist-for-hyper-v">
<h2>Preparation Checklist for Hyper-V<a class="headerlink" href="hyperv.html#preparation-checklist-for-hyper-v" title="Permalink to this headline">¶</a></h2>
<p>For a smoother installation, gather the following information before you
start:</p>
<table border="1" class="table-striped table-bordered table-hover docutils">
<colgroup>
<col width="16%" />
<col width="13%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Hyper-V
Requiremen
ts</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Server
Roles</td>
<td>Hyper-V</td>
<td>After the Windows Server 2012 R2 installation,
ensure that Hyper-V is selected from Server Roles.
For more information, see <a class="reference external" href="http://technet.microsoft.com/en-us/library/jj134187.aspx#BKMK_Step2">Installing
Hyper-V</a>.</td>
</tr>
<tr class="row-odd"><td>Share
Location</td>
<td>New
folders
in the
/Share
director
y</td>
<td><p class="first">Ensure that folders are created for Primary and
Secondary storage. The SMB share and the hosts
should be part of the same domain.</p>
<p class="last">If you are using Windows SMB share, the location of
the file share for the Hyper-V deployment will be
the new folder created in the \Shares on the
selected volume. You can create sub-folders for both
PRODUCT Primary and Secondary storage within the
share location. When you select the profile for the
file shares, ensure that you select SMB Share
-Applications. This creates the file shares with
settings appropriate for Hyper-V.</p>
</td>
</tr>
<tr class="row-even"><td>Domain and
Hosts</td>
<td>&#160;</td>
<td>Hosts should be part of the same Active Directory
domain.</td>
</tr>
<tr class="row-odd"><td>Hyper-V
Users</td>
<td>Full
control</td>
<td>Full control on the SMB file share.</td>
</tr>
<tr class="row-even"><td>Virtual
Switch</td>
<td>&#160;</td>
<td><p class="first">If you are using Hyper-V 2012 R2, manually create an
external virtual switch before adding the host to
PRODUCT. If the Hyper-V host is added to the Hyper-V
manager, select the host, then click Virtual Switch
Manager, then New Virtual Switch. In the External
Network, select the desired NIC adapter and click
Apply.</p>
<p class="last">If you are using Windows 2012 R2, virtual switch is
created automatically.</p>
</td>
</tr>
<tr class="row-odd"><td>Virtual
Switch
Name</td>
<td>&#160;</td>
<td>Take a note of the name of the virtual switch. You
need to specify that when configuring PRODUCT
physical network labels.</td>
</tr>
<tr class="row-even"><td>Hyper-V
Domain
Users</td>
<td>&#160;</td>
<td><ul class="first last simple">
<li>Add the Hyper-V domain users to the Hyper-V
Administrators group.</li>
<li>A domain user should have full control on the SMB
share that is exported for primary and secondary
storage.</li>
<li>This domain user should be part of the Hyper-V
Administrators and Local Administrators group on
the Hyper-V hosts that are to be managed by
PRODUCT.</li>
<li>The Hyper-V Agent service runs with the
credentials of this domain user account.</li>
<li>Specify the credential of the domain user while
adding a host to PRODUCT so that it can manage
it.</li>
<li>Specify the credential of the domain user while
adding a shared SMB primary or secondary storage.</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td>Migration</td>
<td>Migratio
n</td>
<td>Enable Migration.</td>
</tr>
<tr class="row-even"><td>Migration</td>
<td>Delegati
on</td>
<td>If you want to use Live Migration, enable
Delegation. Enable the following services of other
hosts participating in Live Migration: CIFS and
Microsoft Virtual System Migration Service.</td>
</tr>
<tr class="row-odd"><td>Migration</td>
<td>Kerberos</td>
<td>Enable Kerberos for Live Migration.</td>
</tr>
<tr class="row-even"><td>Network
Access
Permission
for
Dial-in</td>
<td>Allow
access</td>
<td>Allow access for Dial-in connections.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hyper-v-installation-steps">
<h2>Hyper-V 安装 Steps<a class="headerlink" href="hyperv.html#hyper-v-installation-steps" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Download the operating system from <a class="reference external" href="http://technet.microsoft.com/en-us/windowsserver/hh534429">Windows Server 2012 R2</a>.</li>
<li>Install it on the host as given in <a class="reference external" href="http://technet.microsoft.com/library/hh831620">Install and Deploy Windows Server 2012
R2</a>.</li>
<li>Post installation, ensure that you enable Hyper-V role in the server.</li>
<li>If no Active Directory domain exists in your deployment, create one
and add users to the domain.</li>
<li>In the Active Directory domain, ensure that all the Hyper-v hosts are
added so that all the hosts are part of the domain.</li>
<li>Add the domain user to the following groups on the Hyper-V host:
Hyper-V Administrators and Local Administrators.</li>
</ol>
</div>
<div class="section" id="installing-the-cloudstack-agent-on-a-hyper-v-host">
<h2>Installing the CloudStack Agent on a Hyper-V Host<a class="headerlink" href="hyperv.html#installing-the-cloudstack-agent-on-a-hyper-v-host" title="Permalink to this headline">¶</a></h2>
<p>The Hyper-V Agent helps CloudStack perform operations on the Hyper-V
hosts. This Agent communicates with the 管理服务 and controls
all the instances on the host. Each Hyper-V host must have the Hyper-V
Agent installed on it for successful interaction between the host and
CloudStack. The Hyper-V Agent runs as a Windows service. Install the
Agent on each host using the following steps.</p>
<p>CloudStack 管理服务 communicates with Hyper-V Agent by using
HTTPS. For secure communication between the 管理服务 and the
host, install a self-signed certificate on port 8250.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Agent installer automatically perform this operation. You have not
selected this option during the Agent installation, it can also be done
manually as given in step 1.</p>
</div>
<ol class="arabic">
<li><p class="first">Create and add a self-signed SSL certificate on port 8250:</p>
<ol class="arabic">
<li><p class="first">Create A self-signed SSL certificate:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># New-SelfSignedCertificate -DnsName apachecloudstack -CertStoreLocation Cert:\LocalMachine\My</span>
</pre></div>
</div>
<p>This command creates the self-signed certificate and add that to
the certificate store <code class="docutils literal notranslate"><span class="pre">LocalMachine\My</span></code>.</p>
</li>
<li><p class="first">Add the created certificate to port 8250 for https communication:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>netsh http add sslcert <span class="nv">ipport</span><span class="o">=</span><span class="m">0</span>.0.0.0:8250 <span class="nv">certhash</span><span class="o">=</span>&lt;thumbprint&gt; <span class="nv">appid</span><span class="o">=</span><span class="s2">&quot;{727beb1c-6e7c-49b2-8fbd-f03dbe481b08}&quot;</span>
</pre></div>
</div>
<p>Thumbprint is the thumbprint of the certificate you created.</p>
</li>
</ol>
</li>
<li><p class="first">Build the CloudStack Agent for Hyper-V as given in <a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/Creating+Hyperv+Agent+Installer">Building CloudStack
Hyper-V Agent</a>.</p>
</li>
<li><p class="first">As an administrator, run the installer.</p>
</li>
<li><p class="first">Provide the Hyper-V admin credentials when prompted.</p>
<p>When the agent installation is finished, the agent runs as a service
on the host machine.</p>
</li>
</ol>
</div>
<div class="section" id="physical-network-configuration-for-hyper-v">
<h2>Physical Network Configuration for Hyper-V<a class="headerlink" href="hyperv.html#physical-network-configuration-for-hyper-v" title="Permalink to this headline">¶</a></h2>
<p>You should have a plan for how the hosts will be cabled and which
physical NICs will carry what types of traffic. By default, CloudStack
will use the device that is used for the default route.</p>
<p>If you are using Hyper-V 2012 R2, manually create an external virtual
switch before adding the host to CloudStack. If the Hyper-V host is
added to the Hyper-V manager, select the host, then click Virtual Switch
Manager, then New Virtual Switch. In the External Network, select the
desired NIC adapter and click Apply.</p>
<p>If you are using Windows 2012 R2, virtual switch is created
automatically.</p>
</div>
<div class="section" id="storage-preparation-for-hyper-v-optional">
<h2>Storage Preparation for Hyper-V (Optional)<a class="headerlink" href="hyperv.html#storage-preparation-for-hyper-v-optional" title="Permalink to this headline">¶</a></h2>
<p>CloudStack allows administrators to set up shared 主存储 and
二级存储 that uses SMB.</p>
<ol class="arabic">
<li><p class="first">Create a SMB storage and expose it over SMB Version 3.</p>
<p>For more information, see <a class="reference external" href="http://technet.microsoft.com/en-us/library/jj134187.aspx">Deploying Hyper-V over SMB</a>.</p>
<p>You can also create and export SMB share using Windows. After the
Windows Server 2012 R2 installation, select File and Storage Services
from Server Roles to create an SMB file share. For more information,
see <a class="reference external" href="http://technet.microsoft.com/en-us/library/jj134187.aspx#BKMK_Step3">Creating an SMB File Share Using Server Manager</a>.</p>
</li>
<li><p class="first">Add the SMB share to the Active Directory domain.</p>
<p>The SMB share and the hosts managed by CloudStack need to be in the
same domain. However, the storage should be accessible from the
管理服务 with the domain user privileges.</p>
</li>
<li><p class="first">While adding storage to CloudStack, ensure that the correct domain,
and credentials are supplied. This user should be able to access the
storage from the 管理服务.</p>
</li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="hyperv.html#">Back to top</a>
          | <a href="../configuration.html" title="Previous Chapter: 安装配置 CloudStack "><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 安装配置 CloudStack </span>
          </a>
          | <a href="kvm.html" title="Next Chapter: KVM 安装"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">KVM 安装 &raquo;</span>
          </a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/hypervisor/hyperv.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2018, Apache Software Foundation.<br/>
    </p>
  </div>
</footer>
  </body>
</html>