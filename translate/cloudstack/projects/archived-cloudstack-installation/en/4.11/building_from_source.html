<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>从源码编译安装 &#8212; CloudStack 安装手册 4.11.0.0 documentation</title>
    <link rel="stylesheet" href="static/basic.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="static/bootswatch-3.2.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="static/bootstrap-sphinx.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="static/documentation_options.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="安装概述" href="overview/index.html" />
    <link rel="prev" title="快速入门指南 for CentOS 6" href="qig.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="building_from_source.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'building_from_source'
READTHEDOCS_DATA['source_suffix'] = '.rst'
</script>

<script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          安装指南</a>
        <span class="navbar-text navbar-version pull-left"><b>4.11</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
                <a role="button"
                   id="dLabelGlobalToc"
                   data-toggle="dropdown"
                   data-target="#"
                   href="index.html">Sections <b class="caret"></b></a>
                <ul class="dropdown-menu globaltoc"
                    role="menu"
                    aria-labelledby="dLabelGlobalToc">
                     <ul>
<li class="toctree-l1"><a class="reference internal" href="choosing_deployment_architecture.html">架构选型</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="qig.html">快速入门指南 for CentOS 6</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="building_from_source.html#">从源码编译安装</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview/index.html">安装概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="management-server/index.html">安装管理服务</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">安装配置 CloudStack </a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hypervisor/hyperv.html">Hyper-V 安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypervisor/kvm.html">KVM 安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypervisor/lxc.html">LXC 安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypervisor/vsphere.html">VMware vSphere 安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypervisor/xenserver.html">Citrix XenServer 安装</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="network_setup.html">网络配置</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="storage_setup.html">存储配置</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage_setup.html#small-scale-setup">Small-Scale Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage_setup.html#large-scale-setup">Large-Scale Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage_setup.html#storage-architecture">存储架构</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage_setup.html#network-configuration-for-storage">Network Configuration For Storage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="optional_installation.html">其它安装选项</a></li>
<li class="toctree-l1"><a class="reference internal" href="encryption.html">密码和加密密钥</a></li>
</ul>


                </ul>
              </li>
              
                
              
            
            
              
                
  <li>
    <a href="qig.html" title="Previous Chapter: 快速入门指南 for CentOS 6"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 快速入门指南 for CentOS 6</span>
    </a>
  </li>
  <li>
    <a href="overview/index.html" title="Next Chapter: 安装概述"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">安装概述 &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="building_from_source.html#">从源码编译安装</a><ul>
<li><a class="reference internal" href="building_from_source.html#getting-the-release">Getting the release</a></li>
<li><a class="reference internal" href="building_from_source.html#verifying-the-downloaded-release">验证下载的版本</a><ul>
<li><a class="reference internal" href="building_from_source.html#getting-the-keys">Getting the KEYS</a></li>
<li><a class="reference internal" href="building_from_source.html#gpg">GPG</a></li>
<li><a class="reference internal" href="building_from_source.html#md5">MD5</a></li>
<li><a class="reference internal" href="building_from_source.html#sha512">SHA512</a></li>
</ul>
</li>
<li><a class="reference internal" href="building_from_source.html#prerequisites-for-building-apache-cloudstack">编译 Apache CloudStack 的先决条件</a></li>
<li><a class="reference internal" href="building_from_source.html#extracting-source">解压源码</a></li>
<li><a class="reference internal" href="building_from_source.html#install-new-mysql-connector">安装 MySQL connector</a><ul>
<li><a class="reference internal" href="building_from_source.html#mysql-connector-apt-repository">MySQL connector APT repository</a></li>
<li><a class="reference internal" href="building_from_source.html#mysql-connector-rpm-repository">MySQL connector RPM repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="building_from_source.html#building-deb-packages">打包成 DEB</a><ul>
<li><a class="reference internal" href="building_from_source.html#setting-up-an-apt-repo">Setting up an APT repo</a></li>
<li><a class="reference internal" href="building_from_source.html#configuring-your-machines-to-use-the-apt-repository">Configuring your machines to use the APT repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="building_from_source.html#building-rpms-from-source">打包成 RPM</a><ul>
<li><a class="reference internal" href="building_from_source.html#generating-rpms">Generating RPMS</a><ul>
<li><a class="reference internal" href="building_from_source.html#creating-a-yum-repo">Creating a yum repo</a></li>
<li><a class="reference internal" href="building_from_source.html#configuring-your-systems-to-use-your-new-yum-repository">Configuring your systems to use your new yum repository</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="building_from_source.html#building-non-oss">打包 Non-OSS</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9">
      
  <div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>NOTICE: THIS DOCUMENTATION SITE HAS BEEN SUPERSEDED.</p>
<p class="last">For the current documentation site goto: <a class="reference external" href="../../../../index.html">http://docs.cloudstack.apache.org</a></p>
</div>
<div class="section" id="building-from-source">
<h1>从源码编译安装<a class="headerlink" href="building_from_source.html#building-from-source" title="Permalink to this headline">¶</a></h1>
<p>The official CloudStack release is always in source code form. You will
likely be able to find “convenience binaries,” the source is the
canonical release. In this section, we’ll cover acquiring the source
release and building that so that you can deploy it using Maven or
create Debian packages or RPMs.</p>
<p>Note that building and deploying directly from source is typically not
the most efficient way to deploy an IaaS. However, we will cover that
method as well as building RPMs or Debian packages for deploying
CloudStack.</p>
<p>The instructions here are likely version-specific. That is, the method
for building from source for the 4.7.x series is different from the
4.2.x series.</p>
<p>If you are working with a unreleased version of CloudStack, see the
INSTALL.md file in the top-level directory of the release.</p>
<div class="section" id="getting-the-release">
<h2>Getting the release<a class="headerlink" href="building_from_source.html#getting-the-release" title="Permalink to this headline">¶</a></h2>
<p>You can download the latest CloudStack release from the <a class="reference external" href="http://cloudstack.apache.org/downloads.html">Apache
CloudStack project download page</a>.</p>
<p>Prior releases are available via archive.apache.org as well. See the
downloads page for more information on archived releases.</p>
<p>You’ll notice several links under the ‘Latest release’ section. A link
to a file ending in <code class="docutils literal notranslate"><span class="pre">tar.bz2</span></code>, as well as a PGP/GPG signature, MD5,
and SHA512 file.</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">tar.bz2</span></code> file contains the Bzip2-compressed tarball with the
source code.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">.asc</span></code> file is a detached cryptographic signature that can be
used to help verify the authenticity of the release.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">.md5</span></code> file is an MD5 hash of the release to aid in verify the
validity of the release download.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">.sha</span></code> file is a SHA512 hash of the release to aid in verify
the validity of the release download.</li>
</ul>
</div>
<div class="section" id="verifying-the-downloaded-release">
<h2>验证下载的版本<a class="headerlink" href="building_from_source.html#verifying-the-downloaded-release" title="Permalink to this headline">¶</a></h2>
<p>There are a number of mechanisms to check the authenticity and validity
of a downloaded release.</p>
<div class="section" id="getting-the-keys">
<h3>Getting the KEYS<a class="headerlink" href="building_from_source.html#getting-the-keys" title="Permalink to this headline">¶</a></h3>
<p>To enable you to verify the GPG signature, you will need to download the
<a class="reference external" href="http://www.apache.org/dist/cloudstack/KEYS">KEYS</a> file.</p>
<p>You next need to import those keys, which you can do by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wget http://www.apache.org/dist/cloudstack/KEYS
$ gpg --import KEYS
</pre></div>
</div>
</div>
<div class="section" id="gpg">
<h3>GPG<a class="headerlink" href="building_from_source.html#gpg" title="Permalink to this headline">¶</a></h3>
<p>The CloudStack project provides a detached GPG signature of the release.
To check the signature, run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gpg --verify apache-cloudstack-4.11.1.0-src.tar.bz2.asc
</pre></div>
</div>
<p>If the signature is valid you will see a line of output that contains
‘Good signature’.</p>
</div>
<div class="section" id="md5">
<h3>MD5<a class="headerlink" href="building_from_source.html#md5" title="Permalink to this headline">¶</a></h3>
<p>In addition to the cryptographic signature, CloudStack has an MD5
checksum that you can use to verify the download matches the release.
You can verify this hash by executing the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gpg --print-md MD5 apache-cloudstack-4.11.1.0-src.tar.bz2 <span class="p">|</span> diff - apache-cloudstack-4.11.1.0-src.tar.bz2.md5
</pre></div>
</div>
<p>If this successfully completes you should see no output. If there is any
output from them, then there is a difference between the hash you
generated locally and the hash that has been pulled from the server.</p>
</div>
<div class="section" id="sha512">
<h3>SHA512<a class="headerlink" href="building_from_source.html#sha512" title="Permalink to this headline">¶</a></h3>
<p>In addition to the MD5 hash, the CloudStack project provides a SHA512
cryptographic hash to aid in assurance of the validity of the downloaded
release. You can verify this hash by executing the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gpg --print-md SHA512 apache-cloudstack-4.11.1.0-src.tar.bz2 <span class="p">|</span> diff - apache-cloudstack-4.11.1.0-src.tar.bz2.sha
</pre></div>
</div>
<p>If this command successfully completes you should see no output. If
there is any output from them, then there is a difference between the
hash you generated locally and the hash that has been pulled from the
server.</p>
</div>
</div>
<div class="section" id="prerequisites-for-building-apache-cloudstack">
<h2>编译 Apache CloudStack 的先决条件<a class="headerlink" href="building_from_source.html#prerequisites-for-building-apache-cloudstack" title="Permalink to this headline">¶</a></h2>
<p>There are a number of prerequisites needed to build CloudStack. This
document assumes compilation on a Linux system that uses RPMs or DEBs
for package management.</p>
<p>You will need, at a minimum, the following to compile CloudStack:</p>
<ol class="arabic simple">
<li>Maven (version 3)</li>
<li>Java (Java 8/OpenJDK 1.8)</li>
<li>Apache Web Services Common Utilities (ws-commons-util)</li>
<li>MySQL</li>
<li>MySQLdb (provides Python database API)</li>
<li>genisoimage</li>
<li>rpmbuild or dpkg-dev</li>
</ol>
</div>
<div class="section" id="extracting-source">
<h2>解压源码<a class="headerlink" href="building_from_source.html#extracting-source" title="Permalink to this headline">¶</a></h2>
<p>Extracting the CloudStack release is relatively simple and can be done
with a single command as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tar -jxvf apache-cloudstack-4.11.1.0-src.tar.bz2
</pre></div>
</div>
<p>You can now move into the directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ./apache-cloudstack-4.11.1.0-src
</pre></div>
</div>
</div>
<div class="section" id="install-new-mysql-connector">
<h2>安装 MySQL connector<a class="headerlink" href="building_from_source.html#install-new-mysql-connector" title="Permalink to this headline">¶</a></h2>
<p>Install Python MySQL connector using the official MySQL packages repository.</p>
<div class="section" id="mysql-connector-apt-repository">
<h3>MySQL connector APT repository<a class="headerlink" href="building_from_source.html#mysql-connector-apt-repository" title="Permalink to this headline">¶</a></h3>
<p>Install the following package provided by MySQL to enable official repositories:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget http://dev.mysql.com/get/mysql-apt-config_0.7.3-1_all.deb
sudo dpkg -i mysql-apt-config_0.7.3-1_all.deb
</pre></div>
</div>
<p>Make sure to activate the repository for MySQL connectors.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get install mysql-connector-python
</pre></div>
</div>
</div>
<div class="section" id="mysql-connector-rpm-repository">
<h3>MySQL connector RPM repository<a class="headerlink" href="building_from_source.html#mysql-connector-rpm-repository" title="Permalink to this headline">¶</a></h3>
<p>Add a new yum repo <code class="docutils literal notranslate"><span class="pre">/etc/yum.repos.d/mysql.repo</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>mysql-community<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>MySQL Community connectors
<span class="nv">baseurl</span><span class="o">=</span>http://repo.mysql.com/yum/mysql-connectors-community/el/<span class="nv">$releasever</span>/<span class="nv">$basearch</span>/
<span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>Import GPG public key from MySQL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rpm --import http://repo.mysql.com/RPM-GPG-KEY-mysql
</pre></div>
</div>
<p>Install mysql-connector</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>yum install mysql-connector-python
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-deb-packages">
<h2>打包成 DEB<a class="headerlink" href="building_from_source.html#building-deb-packages" title="Permalink to this headline">¶</a></h2>
<p>In addition to the bootstrap dependencies, you’ll also need to install
several other dependencies. Note that we recommend using Maven 3.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get install python-software-properties
$ sudo apt-get update
$ sudo apt-get install debhelper openjdk-8-jdk libws-commons-util-java genisoimage libcommons-codec-java libcommons-httpclient-java liblog4j1.2-java maven
</pre></div>
</div>
<p>While we have defined, and you have presumably already installed the
bootstrap prerequisites, there are a number of build time prerequisites
that need to be resolved. CloudStack uses maven for dependency
resolution. You can resolve the buildtime depdencies for CloudStack by
running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mvn -P deps
</pre></div>
</div>
<p>Now that we have resolved the dependencies we can move on to building
CloudStack and packaging them into DEBs by issuing the following
command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ dpkg-buildpackage -uc -us
</pre></div>
</div>
<p>This command will build the following debian packages. You should have
all of the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cloudstack-common-4.11.0.0.amd64.deb
cloudstack-management-4.11.0.0.amd64.deb
cloudstack-agent-4.11.0.0.amd64.deb
cloudstack-usage-4.11.0.0.amd64.deb
cloudstack-cli-4.11.0.0.amd64.deb
</pre></div>
</div>
<div class="section" id="setting-up-an-apt-repo">
<h3>Setting up an APT repo<a class="headerlink" href="building_from_source.html#setting-up-an-apt-repo" title="Permalink to this headline">¶</a></h3>
<p>After you’ve created the packages, you’ll want to copy them to a system
where you can serve the packages over HTTP. You’ll create a directory
for the packages and then use <code class="docutils literal notranslate"><span class="pre">dpkg-scanpackages</span></code> to create
<code class="docutils literal notranslate"><span class="pre">Packages.gz</span></code>, which holds information about the archive structure.
Finally, you’ll add the repository to your system(s) so you can install
the packages using APT.</p>
<p>The first step is to make sure that you have the <strong>dpkg-dev</strong> package
installed. This should have been installed when you pulled in the
<strong>debhelper</strong> application previously, but if you’re generating
<code class="docutils literal notranslate"><span class="pre">Packages.gz</span></code> on a different system, be sure that it’s installed there
as well.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install dpkg-dev
</pre></div>
</div>
<p>The next step is to copy the DEBs to the directory where they can be
served over HTTP. We’ll use <code class="docutils literal notranslate"><span class="pre">/var/www/cloudstack/repo</span></code> in the
examples, but change the directory to whatever works for you.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo mkdir -p /var/www/cloudstack/repo/binary
$ sudo cp *.deb /var/www/cloudstack/repo/binary
$ <span class="nb">cd</span> /var/www/cloudstack/repo/binary
$ sudo sh -c <span class="s1">&#39;dpkg-scanpackages . /dev/null | tee Packages | gzip -9 &gt; Packages.gz&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">You can safely ignore the 警告 about a missing override file.</p>
</div>
<p>Now you should have all of the DEB packages and <code class="docutils literal notranslate"><span class="pre">Packages.gz</span></code> in the
<code class="docutils literal notranslate"><span class="pre">binary</span></code> directory and available over HTTP. (You may want to use
<code class="docutils literal notranslate"><span class="pre">wget</span></code> or <code class="docutils literal notranslate"><span class="pre">curl</span></code> to test this before moving on to the next step.)</p>
</div>
<div class="section" id="configuring-your-machines-to-use-the-apt-repository">
<h3>Configuring your machines to use the APT repository<a class="headerlink" href="building_from_source.html#configuring-your-machines-to-use-the-apt-repository" title="Permalink to this headline">¶</a></h3>
<p>Now that we have created the repository, you need to configure your
machine to make use of the APT repository. You can do this by adding a
repository file under <code class="docutils literal notranslate"><span class="pre">/etc/apt/sources.list.d</span></code>. Use your preferred
editor to create <code class="docutils literal notranslate"><span class="pre">/etc/apt/sources.list.d/cloudstack.list</span></code> with this
line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>deb http://server.url/cloudstack/repo/binary ./
</pre></div>
</div>
<p>Now that you have the repository info in place, you’ll want to run
another update so that APT knows where to find the CloudStack packages.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update
</pre></div>
</div>
<p>You can now move on to the instructions under Install on Ubuntu.</p>
</div>
</div>
<div class="section" id="building-rpms-from-source">
<h2>打包成 RPM<a class="headerlink" href="building_from_source.html#building-rpms-from-source" title="Permalink to this headline">¶</a></h2>
<p>As mentioned previously in <a class="reference external" href="building_from_source.html#prerequisites-for-building-apache-cloudstack">“编译 Apache CloudStack 的先决条件”</a>, you will need to install
several prerequisites before you can build packages for CloudStack. Here we’ll
assume you’re working with a 64-bit build of CentOS or Red Hat Enterprise
Linux.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum groupinstall &quot;Development Tools&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># yum install java-1.8.0-openjdk-devel.x86_64 genisoimage mysql mysql-server ws-commons-util MySQL-python createrepo</span>
</pre></div>
</div>
<p>Next, you’ll need to install build-time dependencies for CloudStack with
Maven. We’re using Maven 3, so you’ll want to grab <a class="reference external" href="http://maven.apache.org/download.cgi">Maven 3.0.5 (Binary tar.gz)</a> and uncompress it in
your home directory (or whatever location you prefer):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~
$ tar zxvf apache-maven-3.0.5-bin.tar.gz
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>~/apache-maven-3.0.5/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>Maven also needs to know where Java is, and expects the JAVA_HOME
environment variable to be set:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/lib/jvm/java-1.8.0-openjdk.x86_64
</pre></div>
</div>
<p>Verify that Maven is installed correctly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mvn --version
</pre></div>
</div>
<p>You probably want to ensure that your environment variables will survive
a logout/reboot. Be sure to update <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> with the PATH and
JAVA_HOME variables.</p>
<p>Building RPMs for CloudStack is fairly simple. Assuming you already have
the source downloaded and have uncompressed the tarball into a local
directory, you’re going to be able to generate packages in just a few
minutes.</p>
<div class="admonition note">
<p class="first admonition-title">提示</p>
<p class="last">Packaging has Changed. If you’ve created packages for CloudStack
previously, you should be aware that the process has changed considerably
since the project has moved to using Apache Maven. Please be sure to follow
the steps in this section closely.</p>
</div>
<div class="section" id="generating-rpms">
<h3>Generating RPMS<a class="headerlink" href="building_from_source.html#generating-rpms" title="Permalink to this headline">¶</a></h3>
<p>Now that we have the prerequisites and source, you will cd to the
<cite>packaging/</cite> directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> packaging/
</pre></div>
</div>
<p>Generating RPMs is done using the <code class="docutils literal notranslate"><span class="pre">package.sh</span></code> script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./package.sh -d centos63
</pre></div>
</div>
<p>For other supported options(like centos7), run <code class="docutils literal notranslate"><span class="pre">./package.sh</span> <span class="pre">--help</span></code></p>
<p>That will run for a bit and then place the finished packages in
<code class="docutils literal notranslate"><span class="pre">dist/rpmbuild/RPMS/x86_64/</span></code>.</p>
<p>You should see the following RPMs in that directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cloudstack-agent-4.11.0.0.el6.x86_64.rpm
cloudstack-cli-4.11.0.0.el6.x86_64.rpm
cloudstack-common-4.11.0.0.el6.x86_64.rpm
cloudstack-management-4.11.0.0.el6.x86_64.rpm
cloudstack-usage-4.11.0.0.el6.x86_64.rpm
</pre></div>
</div>
<div class="section" id="creating-a-yum-repo">
<h4>Creating a yum repo<a class="headerlink" href="building_from_source.html#creating-a-yum-repo" title="Permalink to this headline">¶</a></h4>
<p>While RPMs is a useful packaging format - it’s most easily consumed from
Yum repositories over a network. The next step is to create a Yum Repo
with the finished packages:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mkdir -p ~/tmp/repo
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ../..
$ cp dist/rpmbuild/RPMS/x86_64/*rpm ~/tmp/repo/
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ createrepo ~/tmp/repo
</pre></div>
</div>
<p>The files and directories within <code class="docutils literal notranslate"><span class="pre">~/tmp/repo</span></code> can now be uploaded to a
web server and serve as a yum repository.</p>
</div>
<div class="section" id="configuring-your-systems-to-use-your-new-yum-repository">
<h4>Configuring your systems to use your new yum repository<a class="headerlink" href="building_from_source.html#configuring-your-systems-to-use-your-new-yum-repository" title="Permalink to this headline">¶</a></h4>
<p>Now that your yum repository is populated with RPMs and metadata we need
to configure the machines that need to install CloudStack. Create a file
named <code class="docutils literal notranslate"><span class="pre">/etc/yum.repos.d/cloudstack.repo</span></code> with this information:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>apache-cloudstack<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>Apache CloudStack
<span class="nv">baseurl</span><span class="o">=</span>http://webserver.tld/path/to/repo
<span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>Completing this step will allow you to easily install CloudStack on a
number of machines across the network.</p>
</div>
</div>
</div>
<div class="section" id="building-non-oss">
<h2>打包 Non-OSS<a class="headerlink" href="building_from_source.html#building-non-oss" title="Permalink to this headline">¶</a></h2>
<p>If you need support for the VMware, NetApp, F5, NetScaler, SRX, or any
other non-Open Source Software (nonoss) plugins, you’ll need to download
a few components on your own and follow a slightly different procedure
to build from source.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">Some of the plugins supported by CloudStack cannot be distributed with
CloudStack for licensing reasons. In some cases, some of the required
libraries/JARs are under a proprietary license. In other cases, the
required libraries may be under a license that’s not compatible with
<a class="reference external" href="http://www.apache.org/legal/resolved.html#category-x">Apache’s licensing guidelines for third-party products</a>.</p>
</div>
<ol class="arabic">
<li><p class="first">To build the Non-OSS plugins, you’ll need to have the requisite JARs
installed under the <code class="docutils literal notranslate"><span class="pre">deps</span></code> directory.</p>
<p>Because these modules require dependencies that can’t be distributed
with CloudStack you’ll need to download them yourself. Links to the
most recent dependencies are listed on the <a class="reference external" href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/How+to+build+CloudStack">*How to build CloudStack*</a>
page on the wiki.</p>
</li>
<li><p class="first">You may also need to download
<a class="reference external" href="http://download.cloud.com.s3.amazonaws.com/tools/vhd-util">vhd-util</a>,
which was removed due to licensing issues. You’ll copy vhd-util to
the <code class="docutils literal notranslate"><span class="pre">scripts/vm/hypervisor/xenserver/</span></code> directory.</p>
</li>
<li><p class="first">Once you have all the dependencies copied over, you’ll be able to
build CloudStack with the <code class="docutils literal notranslate"><span class="pre">noredist</span></code> option:</p>
</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mvn clean
$ mvn install -Dnoredist
</pre></div>
</div>
<ol class="arabic simple">
<li>Once you’ve built CloudStack with the <code class="docutils literal notranslate"><span class="pre">noredist</span></code> profile, you can
package it using the <a class="reference external" href="building_from_source.html#building-rpms-from-source">“打包成 RPM”</a>
or <a class="reference external" href="building_from_source.html#building-deb-packages">“打包成 DEB”</a> instructions.</li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="building_from_source.html#">Back to top</a>
          | <a href="qig.html" title="Previous Chapter: 快速入门指南 for CentOS 6"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 快速入门指南 for CentOS 6</span>
          </a>
          | <a href="overview/index.html" title="Next Chapter: 安装概述"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">安装概述 &raquo;</span>
          </a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/building_from_source.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2018, Apache Software Foundation.<br/>
    </p>
  </div>
</footer>
  </body>
</html>